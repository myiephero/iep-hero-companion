import{j as e}from"./chunk-DsWtD-um.js";import{r as s}from"./chunk--CdJ9rTh.js";import{a,C as t,d as i,e as r,f as l,h as n,B as d,r as c,t as o,v as m,w as x}from"../assets/index-BO9uTDme.js";import{B as h}from"./chunk-qxwVooB6.js";import{S as p,a as u,b as g,c as j,d as y}from"./chunk-BJKDjCst.js";import{D as b}from"./chunk-N8_dqq3A.js";import{S as f}from"./chunk-DIZ_Na9Q.js";import{C as v}from"./chunk-nudLLAGO.js";import{a as N}from"./chunk-CbYvpwVq.js";import{B as w,X as k,aV as S,ad as A,aN as C,aW as I,as as z,aJ as D,av as _,au as $,f as T,ab as R,N as E,y as O,T as J}from"./chunk-CIO6T0Sb.js";import"./chunk-DiCKXT8z.js";import"./chunk--P05M-BP.js";import"./chunk-Csgv8Z6q.js";import"./chunk-D0h9MBRh.js";import"./chunk-DMdvVhpo.js";import"./chunk-Bjjg2cVV.js";import"./chunk-6doDp4ox.js";const P=[{value:"iep",label:"IEP Document Review",description:"Comprehensive analysis of IEP documents"},{value:"accommodation",label:"Accommodation Analysis",description:"Review accommodation effectiveness"},{value:"meeting_prep",label:"Meeting Preparation",description:"Prepare for IEP meetings"},{value:"goal_analysis",label:"Goal Analysis",description:"Analyze IEP goals and progress"},{value:"compliance_check",label:"Compliance Check",description:"Check legal compliance requirements"}];function F(){const[F,U]=s.useState([]),[V,B]=s.useState(""),[L,M]=s.useState("iep"),[W,q]=s.useState(!1),[G,K]=s.useState({}),[X,Y]=s.useState(""),[Z,H]=s.useState([]),[Q,ee]=s.useState(new Set),[se,ae]=s.useState(!1),{toast:te}=a(),ie=e=>e.documentName?e.documentName:e.parsedAnalysis?.document_title?e.parsedAnalysis.document_title:e.parsedAnalysis?.title?e.parsedAnalysis.title:"Document Review";s.useEffect(()=>{re()},[]);const re=async()=>{try{const e=await N.getStudents();if(H(e),V){const s=e.find(e=>e.id===V);s&&Y(s.full_name)}}catch(e){console.error("Error fetching students:",e)}},le=async e=>{try{q(!0);const s={documentTitle:ie(e),reviewType:e.reviewType,timestamp:e.timestamp,studentId:e.studentId,analysis:e.parsedAnalysis||{summary:"string"==typeof e.analysis?e.analysis:JSON.stringify(e.analysis),recommendations:[],areas_of_concern:[],strengths:[],action_items:[]},rawAnalysis:e.analysis},a={title:`${e.reviewType.toUpperCase()} Analysis - ${ie(e)}`,description:`AI analysis completed on ${new Date(e.timestamp).toLocaleDateString()}`,file_name:`${ie(e).replace(/[^a-zA-Z0-9]/g,"")}.json`,file_path:`vault/ai-reviews/${e.id}.json`,file_type:"application/json",file_size:JSON.stringify(s).length,category:"AI Analysis",tags:["ai-analysis",e.reviewType],student_id:e.studentId};a.content=JSON.stringify(s),await N.createDocument(a),te({title:"Saved to Vault",description:"Analysis saved successfully to document vault."}),U(s=>s.filter(s=>s.id!==e.id))}catch(s){console.error("Error saving to vault:",s),te({title:"Save Failed",description:"Failed to save analysis to vault. Please try again.",variant:"destructive"})}finally{q(!1)}},ne=e=>{const s=JSON.stringify(e,null,2),a="data:application/json;charset=utf-8,"+encodeURIComponent(s),t=`ai-review-${ie(e)}-${(new Date).toISOString().split("T")[0]}.json`,i=document.createElement("a");i.setAttribute("href",a),i.setAttribute("download",t),i.click()},de=(s,a,t,i,r)=>{if(!t||Array.isArray(t)&&0===t.length)return null;const l=r,n=(d=s.id,G[`${d}-${a}`]||!1);var d;return e.jsxs("div",{className:`border rounded-lg overflow-hidden ${i}`,children:[e.jsxs("button",{onClick:()=>((e,s)=>{const a=`${e}-${s}`;K(e=>({...e,[a]:!e[a]}))})(s.id,a),className:"w-full p-4 text-left flex items-center justify-between hover:bg-opacity-80 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:"h-5 w-5"}),e.jsx("h4",{className:"font-semibold",children:a})]}),n?e.jsx(_,{className:"h-4 w-4"}):e.jsx($,{className:"h-4 w-4"})]}),!n&&e.jsx("div",{className:"p-4 pt-0",children:Array.isArray(t)?e.jsx("ul",{className:"space-y-2",children:t.map((s,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-sm opacity-70",children:"•"}),e.jsx("span",{className:"text-sm",children:"string"==typeof s?s:JSON.stringify(s)})]},a))}):e.jsx("p",{className:"text-sm",children:"string"==typeof t?t:JSON.stringify(t)})})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"AI IEP Review"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Upload and analyze IEP documents with AI-powered insights"})]}),e.jsxs(t,{children:[e.jsxs(i,{children:[e.jsx(r,{children:"Document Analysis"}),e.jsx(l,{children:"Configure your analysis settings and upload documents for AI-powered review. The analysis results will appear below after processing."})]}),e.jsxs(n,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Student (Optional)"}),e.jsx(f,{selectedStudent:V,onStudentChange:e=>{B(e);const s=Z.find(s=>s.id===e);Y(s?.full_name||"")}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Review Type"}),e.jsxs(p,{value:L,onValueChange:M,children:[e.jsx(u,{children:e.jsx(g,{placeholder:"Select review type"})}),e.jsx(j,{children:P.map(s=>e.jsx(y,{value:s.value,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]})},s.value))})]})]})]}),e.jsx(b,{onAnalysisComplete:e=>{e.documentId&&e.documentName&&((e,s,a)=>{const t={id:`temp-${Date.now()}-${Math.random()}`,documentId:s,studentId:V,reviewType:L,analysis:e.content,parsedAnalysis:e.parsedAnalysis,timestamp:(new Date).toISOString(),documentName:a};U(e=>[t,...e]),te({title:"Analysis Complete",description:`${L.toUpperCase()} analysis ready for review.`})})(e,e.documentId,e.documentName)}})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(w,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"AI Review Results"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Temporary analysis results - choose what to save"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"secondary",className:"text-sm font-medium",children:[F.length," Review",1!==F.length?"s":""]}),F.length>0&&e.jsx(d,{variant:"outline",size:"sm",onClick:()=>ae(!se),className:"flex items-center gap-2",children:se?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4"}),"Cancel"]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4"}),"Select Multiple"]})})]})]}),se&&Q.size>0&&e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:[Q.size," of ",F.length," selected"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>{const e=F.map(e=>e.id);ee(new Set(e))},className:"text-blue-700 dark:text-blue-300 hover:text-blue-900 dark:hover:text-blue-100",children:"Select All"}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>{ee(new Set)},className:"text-blue-700 dark:text-blue-300 hover:text-blue-900 dark:hover:text-blue-100",children:"Deselect All"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{onClick:async()=>{const e=F.filter(e=>Q.has(e.id));for(const s of e)await le(s);ee(new Set),ae(!1)},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white",size:"sm",children:[e.jsx(A,{className:"h-4 w-4"}),"Save to Vault (",Q.size,")"]}),e.jsxs(d,{onClick:()=>{F.filter(e=>Q.has(e.id)).forEach(e=>ne(e))},variant:"outline",className:"flex items-center gap-2",size:"sm",children:[e.jsx(C,{className:"h-4 w-4"}),"Download (",Q.size,")"]}),e.jsxs(d,{onClick:()=>{const e=F.filter(e=>Q.has(e.id)).map(e=>({title:ie(e),timestamp:e.timestamp,analysis:e.analysis}));navigator.clipboard.writeText(JSON.stringify(e,null,2)),te({title:"Copied to Clipboard",description:`${Q.size} reviews copied to clipboard.`})},variant:"outline",className:"flex items-center gap-2",size:"sm",children:[e.jsx(I,{className:"h-4 w-4"}),"Share (",Q.size,")"]}),e.jsxs(d,{onClick:()=>{U(e=>e.filter(e=>!Q.has(e.id))),ee(new Set),ae(!1),te({title:"Reviews Deleted",description:`${Q.size} temporary reviews removed.`})},variant:"destructive",className:"flex items-center gap-2",size:"sm",children:[e.jsx(z,{className:"h-4 w-4"}),"Delete (",Q.size,")"]})]})]}),e.jsx("div",{className:"space-y-6",children:0===F.length?e.jsx(t,{className:"border-dashed",children:e.jsxs(n,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(w,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Reviews Yet"}),e.jsx("p",{className:"text-muted-foreground text-center max-w-md",children:"Upload and analyze documents above to see AI-powered insights here."})]})}):e.jsx("div",{className:"space-y-4",children:F.map(s=>e.jsx(t,{className:"border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900",children:e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[se&&e.jsx(v,{checked:Q.has(s.id),onCheckedChange:e=>{ee(e?e=>new Set([...e,s.id]):e=>{const a=new Set(e);return a.delete(s.id),a})}}),e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(w,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:ie(s)}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[new Date(s.timestamp).toLocaleDateString()," • ",s.reviewType," Review"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{onClick:()=>le(s),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white",size:"sm",disabled:W,children:[e.jsx(A,{className:"h-4 w-4"}),"Save to Vault"]}),e.jsxs(c,{children:[e.jsx(o,{asChild:!0,children:e.jsx(d,{variant:"outline",size:"sm",children:e.jsx(D,{className:"h-4 w-4"})})}),e.jsxs(m,{align:"end",children:[e.jsxs(x,{onClick:()=>ne(s),children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Download"]}),e.jsxs(x,{onClick:()=>(e=>{navigator.clipboard.writeText(JSON.stringify(e,null,2)),te({title:"Copied to Clipboard",description:"Review data copied to clipboard for sharing."})})(s),children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Share"]}),e.jsxs(x,{onClick:()=>{return e=s.id,U(s=>s.filter(s=>s.id!==e)),void te({title:"Review Deleted",description:"Temporary review removed."});var e},className:"text-red-600",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:s.parsedAnalysis?e.jsxs(e.Fragment,{children:[de(s,"Summary",s.parsedAnalysis.summary,"bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800 text-blue-900 dark:text-blue-100",T),de(s,"Recommendations",s.parsedAnalysis.recommendations,"bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-800 text-green-900 dark:text-green-100",R),de(s,"Areas of Concern",s.parsedAnalysis.areas_of_concern,"bg-orange-50 dark:bg-orange-950/30 border-orange-200 dark:border-orange-800 text-orange-900 dark:text-orange-100",E),de(s,"Strengths",s.parsedAnalysis.strengths,"bg-emerald-50 dark:bg-emerald-950/30 border-emerald-200 dark:border-emerald-800 text-emerald-900 dark:text-emerald-100",O),de(s,"Action Items",s.parsedAnalysis.action_items,"bg-purple-50 dark:bg-purple-950/30 border-purple-200 dark:border-purple-800 text-purple-900 dark:text-purple-100",J)]}):e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"string"==typeof s.analysis?s.analysis:JSON.stringify(s.analysis,null,2)})})})]})},s.id))})})]})]})}export{F as default};
