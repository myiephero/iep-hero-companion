import{j as e}from"./chunk-DsWtD-um.js";import{r as s,d as a,L as t}from"./chunk--CdJ9rTh.js";import{u as r,a as i,m as n,D as l,B as c,L as d,I as o,C as m,d as x,e as h,f as u,h as g,p,r as j,t as f,v as N,w as v}from"../assets/index-2BchvXuI.js";import{B as b}from"./chunk-g-Fdx7Wh.js";import{P as y}from"./chunk-DoUlYkqf.js";import{D as w,e as C,a as S,b as k,c as P,d as _}from"./chunk-gc4Qg77s.js";import{A as E,a as A}from"./chunk-C5PCvCMA.js";import{T as I,a as $,b as F,c as G}from"./chunk-DvatESFC.js";import{P as T}from"./chunk-NENDS_-e.js";import{a as D}from"./chunk-CWxgGY0F.js";import{u as U}from"./chunk-CKxibhWI.js";import{ac as L,aw as q,a4 as M,e as O,U as R,n as Y,G as z,ap as V,a6 as B,av as J,f as H,T as W,an as K,y as Q,I as X,k as Z,Y as ee,a5 as se,ax as ae}from"./chunk-CIO6T0Sb.js";import"./chunk-DiCKXT8z.js";function te({parentId:a,parentName:t}){const[r,l]=s.useState(!1),[o,m]=s.useState(""),[x,h]=s.useState(""),[u,g]=s.useState([]),[p,y]=s.useState(!1),[E,A]=s.useState("active"),{toast:I}=i(),$=[{value:"active",label:"Active",color:"text-green-700",bgColor:"hover:bg-green-50",badgeColor:"bg-green-100 text-green-800 border-green-200",icon:Q,description:"Case is actively being worked on"},{value:"pending",label:"Pending",color:"text-amber-700",bgColor:"hover:bg-amber-50",badgeColor:"bg-amber-100 text-amber-800 border-amber-200",icon:ee,description:"Case is waiting for action or review"},{value:"closed",label:"Closed",color:"text-slate-600",bgColor:"hover:bg-slate-50",badgeColor:"bg-slate-100 text-slate-800 border-slate-200",icon:se,description:"Case has been completed or resolved"},{value:"inactive",label:"Inactive",color:"text-red-700",bgColor:"hover:bg-red-50",badgeColor:"bg-red-100 text-red-800 border-red-200",icon:ae,description:"Case is on hold or suspended"}];s.useEffect(()=>{if(r&&a){(async()=>{try{const e=await n("GET","/api/students"),s=await e.json(),t=Array.isArray(s)?s.filter(e=>e.user_id===a||e.parent_id===a):[];g(t)}catch(e){console.error("Error fetching students:",e),g([])}})()}},[r,a]);const F=$.find(e=>e.value===E);return e.jsx(e.Fragment,{children:e.jsxs(w,{open:r,onOpenChange:l,children:[e.jsx(C,{asChild:!0,children:e.jsxs(j,{children:[e.jsx(f,{asChild:!0,children:e.jsxs(c,{size:"sm",className:"w-full","data-testid":"button-create-case",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Create Case",e.jsx(J,{className:"h-4 w-4 ml-2"})]})}),e.jsxs(N,{align:"end",className:"w-72 p-2",children:[e.jsx("div",{className:"px-2 py-1.5 mb-2",children:e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Choose case status"})}),$.map(s=>{const a=s.icon;return e.jsx(v,{onSelect:()=>{A(s.value),l(!0)},"data-testid":`menu-item-${s.value}`,className:`p-3 cursor-pointer rounded-lg transition-all duration-200 ${s.bgColor} border border-transparent hover:border-border`,children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("div",{className:"p-3 rounded-full flex items-center justify-center "+("active"===s.value?"bg-green-500":"pending"===s.value?"bg-amber-500":"closed"===s.value?"bg-slate-500":"bg-red-500"),children:e.jsx(a,{className:"h-5 w-5 text-white font-bold"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${s.color}`,children:["Create ",s.label," Case"]}),e.jsx(b,{variant:"outline",className:`text-xs ${s.badgeColor}`,children:s.label})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:s.description})]})]})},s.value)})]})]})}),e.jsxs(S,{children:[e.jsxs(k,{children:[e.jsx(P,{children:"Create New Advocacy Case"}),e.jsxs(_,{children:["Create a new ",e.jsx("span",{className:F?.color,children:F?.label.toLowerCase()})," advocacy case for ",t,"."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"student-select",children:"Select Student"}),e.jsxs("select",{id:"student-select",className:"w-full p-2 border rounded-md bg-background",value:o,onChange:e=>m(e.target.value),"data-testid":"select-student",children:[e.jsx("option",{value:"",children:"Choose a student..."}),u.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," ",s.grade_level?`(Grade ${s.grade_level})`:""]},s.id))]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"case-status",children:"Case Status"}),e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-md bg-muted",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{className:`font-medium ${F?.color}`,children:F?.label})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"case-description",children:"Case Description"}),e.jsx("textarea",{id:"case-description",placeholder:"Describe the advocacy needs and goals for this case...",className:"w-full p-2 border rounded-md bg-background min-h-[100px]",value:x,onChange:e=>h(e.target.value),"data-testid":"input-case-description"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(c,{variant:"outline",onClick:()=>l(!1),"data-testid":"button-cancel-case",children:"Cancel"}),e.jsx(c,{onClick:async()=>{if(o)if(x.trim()){y(!0);try{const e=u.find(e=>e.id===o),s={student_id:o,title:`IEP Support for ${e?.full_name||"Student"}`,description:x.trim(),status:E};if(!(await n("POST","/api/cases",s)).ok)throw new Error("Failed to create case");I({title:"Case created successfully!",description:`New advocacy case created for ${e?.full_name}`}),m(""),h(""),A("active"),l(!1),window.location.reload()}catch(e){console.error("Error creating case:",e),I({title:"Error creating case",description:"There was an issue creating the case. Please try again.",variant:"destructive"})}finally{y(!1)}}else I({title:"Please provide a description",description:"You must provide a case description.",variant:"destructive"});else I({title:"Please select a student",description:"You must select a student for this case.",variant:"destructive"})},disabled:p,"data-testid":"button-submit-case",children:p?"Creating...":"Create Case"})]})]})]})]})})}function re({parentId:a}){const[l,o]=s.useState([]),[p,j]=s.useState(null),[f,N]=s.useState("overview"),[v,w]=s.useState([]),[C,S]=s.useState([]),[k,P]=s.useState([]),[_,I]=s.useState(!0),{user:$}=r(),{toast:F}=i();s.useEffect(()=>{a&&$&&(async()=>{try{console.log(`🔍 Fetching students for parent: ${a}`);const e=await n("GET","/api/students"),s=await e.json();console.log("🔍 All students:",s);const t=Array.isArray(s)?s.filter(e=>e.parent_id===a):[];o(t),t.length>0&&!p&&j(t[0].id)}catch(e){console.error("❌ Error fetching students for parent:",e),o([])}finally{I(!1)}})()},[a,$]),s.useEffect(()=>{(async()=>{if(p)try{const e=await n("GET","/api/goals"),s=await e.json(),a=Array.isArray(s)?s.filter(e=>e.student_id===p):[];w(a);const t=await n("GET","/api/services"),r=await t.json(),i=Array.isArray(r)?r.filter(e=>e.student_id===p):[];S(i);const l=await n("GET","/api/accommodations"),c=await l.json(),d=Array.isArray(c)?c.filter(e=>e.student_id===p):[];P(d)}catch(e){console.error("Error fetching student data:",e),w([]),S([]),P([])}})()},[p]);const G=e=>{if(!e)return"bg-muted text-muted-foreground";switch(e.toLowerCase()){case"active":return"bg-success text-success-foreground";case"developing":return"bg-warning text-warning-foreground";case"inactive":return"bg-destructive text-destructive-foreground";default:return"bg-muted text-muted-foreground"}};if(_)return e.jsx("div",{className:"text-center py-4",children:"Loading students..."});if(0===l.length)return e.jsxs("div",{className:"text-center py-6",children:[e.jsx(z,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"No students found for this parent."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Students will appear here once they are properly linked."})]});const T=p?l.find(e=>String(e.id)===String(p)):null;return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx("div",{className:"space-y-2",children:l.map(s=>e.jsx("div",{className:"p-3 rounded-lg border cursor-pointer transition-all hover:bg-muted/50 "+(String(p)===String(s.id)?"bg-primary/5 border-primary":"border-border"),onClick:()=>j(String(s.id)),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"h-10 w-10",children:e.jsx(A,{className:"bg-primary/10 text-primary font-semibold",children:s.full_name.split(" ").map(e=>e[0]).join("").toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:s.full_name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.grade_level?`Grade ${s.grade_level}`:"Grade not specified"," • ",s.school_name||"School not specified"]})]}),e.jsx(b,{className:`text-xs ${G(s.iep_status)}`,children:s.iep_status||"Not Set"})]})},s.id))})}),e.jsx("div",{className:"lg:col-span-4",children:T?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"premium-card mb-6",children:e.jsx(x,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(E,{className:"h-16 w-16",children:e.jsx(A,{className:"text-lg bg-gradient-primary text-primary-foreground",children:T.full_name.split(" ").map(e=>e[0]).join("")})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(h,{className:"text-2xl text-gradient",children:T.full_name}),e.jsxs(u,{children:[e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsx("span",{children:T.grade_level?`Grade ${T.grade_level}`:"Grade not specified"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:T.school_name||"School not specified"}),e.jsx("span",{children:"•"}),e.jsxs(b,{className:G(T.iep_status),children:["IEP: ",T.iep_status||"Not Set"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsxs("span",{className:"text-sm",children:["Student: ",T.full_name]}),e.jsx(c,{asChild:!0,variant:"outline",size:"sm",children:e.jsxs(t,{to:`/advocate/messages?student=${T.id}`,children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),"Message Parent"]})})]})]})]})]})})}),e.jsx("div",{className:"w-full mb-8",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 p-1 rounded-2xl shadow-lg",children:e.jsxs("div",{className:"flex bg-white dark:bg-gray-900 rounded-xl p-2 gap-1",children:[e.jsxs("button",{onClick:()=>N("overview"),className:"flex items-center gap-2 px-3 py-3 rounded-lg font-medium transition-all duration-200 flex-1 justify-center "+("overview"===f?"bg-gradient-to-r from-slate-500 to-slate-600 text-white shadow-md":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden lg:inline",children:"Overview"})]}),e.jsxs("button",{onClick:()=>N("goals"),className:"flex items-center gap-2 px-3 py-3 rounded-lg font-medium transition-all duration-200 flex-1 justify-center "+("goals"===f?"bg-gradient-to-r from-green-500 to-green-600 text-white shadow-md":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden lg:inline",children:"Goals"}),e.jsxs("span",{className:"lg:hidden",children:["(",v.length,")"]}),e.jsxs("span",{className:"hidden lg:inline",children:["(",v.length,")"]})]}),e.jsxs("button",{onClick:()=>N("services"),className:"flex items-center gap-2 px-3 py-3 rounded-lg font-medium transition-all duration-200 flex-1 justify-center "+("services"===f?"bg-gradient-to-r from-teal-500 to-teal-600 text-white shadow-md":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden lg:inline",children:"Services"}),e.jsxs("span",{className:"lg:hidden",children:["(",C.length,")"]}),e.jsxs("span",{className:"hidden lg:inline",children:["(",C.length,")"]})]}),e.jsxs("button",{onClick:()=>N("accommodations"),className:"flex items-center gap-2 px-3 py-3 rounded-lg font-medium transition-all duration-200 flex-1 justify-center "+("accommodations"===f?"bg-gradient-to-r from-purple-500 to-purple-600 text-white shadow-md":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden lg:inline",children:"Accommodations"}),e.jsxs("span",{className:"lg:hidden",children:["(",k.length,")"]}),e.jsxs("span",{className:"hidden lg:inline",children:["(",k.length,")"]})]}),e.jsxs("button",{onClick:()=>N("emotions"),className:"flex items-center gap-2 px-3 py-3 rounded-lg font-medium transition-all duration-200 flex-1 justify-center "+("emotions"===f?"bg-gradient-to-r from-pink-500 to-pink-600 text-white shadow-md":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden lg:inline",children:"Emotions"})]}),e.jsxs("button",{onClick:()=>N("gifted"),className:"flex items-center gap-2 px-3 py-3 rounded-lg font-medium transition-all duration-200 flex-1 justify-center "+("gifted"===f?"bg-gradient-to-r from-yellow-500 to-yellow-600 text-white shadow-md":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx("span",{className:"text-lg",children:"🎓"}),e.jsx("span",{className:"hidden lg:inline",children:"Gifted"})]})]})})}),"overview"===f&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(m,{className:"premium-card",children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center",children:[e.jsx(H,{className:"h-5 w-5 mr-2"}),"IEP Status"]})}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:G(T.iep_status),children:T.iep_status||"Not Set"}),T.iep_date&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["IEP Date: ",new Date(T.iep_date).toLocaleDateString()]}),T.next_review_date&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Next Review: ",new Date(T.next_review_date).toLocaleDateString()]})]})})]}),e.jsxs(m,{className:"premium-card",children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center",children:[e.jsx(W,{className:"h-5 w-5 mr-2"}),"Goals Progress"]})}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Completed Goals"}),e.jsxs("span",{children:[v.filter(e=>"completed"===e.status).length,"/",v.length]})]}),e.jsx(y,{value:v.length>0?v.filter(e=>"completed"===e.status).length/v.length*100:0,className:"h-2"})]})})]}),e.jsxs(m,{className:"premium-card",children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center",children:[e.jsx(K,{className:"h-5 w-5 mr-2"}),"School Info"]})}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:T.school_name||"Not specified"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"School"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:T.district||"Not specified"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"District"})]})]})})]})]})}),"goals"===f&&e.jsx("div",{className:"space-y-6",children:e.jsxs(m,{className:"premium-card",children:[e.jsxs(x,{children:[e.jsx(h,{children:"IEP Goals"}),e.jsx(u,{children:"Track progress on individualized education program goals"})]}),e.jsx(g,{children:0===v.length?e.jsx("p",{className:"text-muted-foreground",children:"No goals have been set for this student yet."}):e.jsx("div",{className:"space-y-4",children:v.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold",children:s.title}),e.jsx(b,{className:G(s.status),children:s.status})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[s.current_progress,"%"]})]}),e.jsx(y,{value:s.current_progress,className:"h-2"})]})]},s.id))})})]})}),"services"===f&&e.jsx("div",{className:"space-y-6",children:e.jsxs(m,{className:"premium-card",children:[e.jsxs(x,{children:[e.jsx(h,{children:"Support Services"}),e.jsx(u,{children:"Special education and related services provided to the student"})]}),e.jsx(g,{children:0===C.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(K,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Services Documented"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"IEP services and support will appear here once they are documented."})]}):e.jsx("div",{className:"space-y-4",children:C.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold",children:s.service_type}),e.jsx(b,{className:G(s.status),children:s.status})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Frequency:"})," ",s.frequency||"Not specified"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Duration:"})," ",s.duration?`${s.duration} minutes`:"Not specified"]})]})]},s.id))})})]})}),"accommodations"===f&&e.jsx("div",{className:"space-y-6",children:e.jsxs(m,{className:"premium-card",children:[e.jsxs(x,{children:[e.jsx(h,{children:"IEP Accommodations"}),e.jsx(u,{children:"Documented accommodations and modifications for this student"})]}),e.jsx(g,{children:0===k.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Accommodations Documented"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"IEP accommodations and modifications will appear here once they are documented."})]}):e.jsx("div",{className:"space-y-4",children:k.map(s=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded",children:s.category})}),e.jsx("h4",{className:"font-semibold mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),s.implementation_notes&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[e.jsx("strong",{children:"Implementation:"})," ",s.implementation_notes]})]}),e.jsx(b,{className:"active"===s.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:s.status})]})},s.id))})})]})}),"emotions"===f&&e.jsx("div",{className:"space-y-6",children:e.jsxs(m,{className:"premium-card",children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center",children:[e.jsx(X,{className:"h-5 w-5 mr-2 text-pink-500"}),"Emotional Tracking"]}),e.jsx(u,{children:"Track and record emotional observations for this student"})]}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium",children:"Current Emotional State"}),e.jsx("div",{className:"grid grid-cols-5 gap-2 mt-2",children:[{emoji:"😊",label:"Happy",color:"bg-green-100 hover:bg-green-200"},{emoji:"😐",label:"Neutral",color:"bg-blue-100 hover:bg-blue-200"},{emoji:"😟",label:"Anxious",color:"bg-yellow-100 hover:bg-yellow-200"},{emoji:"😠",label:"Frustrated",color:"bg-orange-100 hover:bg-orange-200"},{emoji:"😢",label:"Distressed",color:"bg-red-100 hover:bg-red-200"}].map(s=>e.jsxs(c,{variant:"outline",className:`h-12 flex-col gap-1 ${s.color}`,onClick:()=>{},children:[e.jsx("span",{className:"text-lg",children:s.emoji}),e.jsx("span",{className:"text-xs",children:s.label})]},s.label))})]}),e.jsxs(c,{className:"w-full bg-pink-500 hover:bg-pink-600",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Record Emotional Observation"]})]})})]})}),"gifted"===f&&e.jsx("div",{className:"space-y-6",children:e.jsxs(m,{className:"premium-card",children:[e.jsxs(x,{children:[e.jsx(h,{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-2xl mr-2",children:"🎓"}),"Gifted & Twice-Exceptional Support"]})}),e.jsx(u,{children:"Advanced learning assessments and support for gifted and 2E learners"})]}),e.jsx(g,{children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-4 mt-6",children:[{id:"cognitive",title:"Cognitive Assessment",description:"Track intellectual abilities and learning patterns",icon:"🧠",color:"text-blue-600"},{id:"enrichment",title:"Enrichment Needs",description:"Document advanced learning opportunities",icon:"⚡",color:"text-green-600"},{id:"twice_exceptional",title:"2E Support",description:"Address unique twice-exceptional needs",icon:"🎯",color:"text-purple-600"},{id:"ai_insights",title:"AI Insights",description:"Get intelligent analysis and recommendations",icon:"🤖",color:"text-indigo-600"}].map(s=>e.jsxs("button",{onClick:()=>{F(p?{title:"Feature Coming Soon",description:`${s.title} tools will be available soon.`}:{title:"Student Required",description:"Please select a student first.",variant:"destructive"})},className:("ai_insights"===s.id?"bg-gradient-to-r from-indigo-100 to-purple-100 dark:from-indigo-900 dark:to-purple-900":"bg-muted/30")+" p-4 rounded-lg border hover:bg-muted/50 transition-colors text-left group cursor-pointer",children:[e.jsx("div",{className:`${s.color} mb-2 text-xl group-hover:scale-110 transition-transform`,children:s.icon}),e.jsx("h4",{className:"font-medium mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),"ai_insights"===s.id&&e.jsx(b,{variant:"secondary",className:"mt-2 text-xs",children:"NEW"})]},s.id))})})]})})]}):e.jsx("div",{className:"flex items-center justify-center h-64 text-center",children:e.jsxs("div",{children:[e.jsx(Z,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Select a Student"}),e.jsx("p",{className:"text-muted-foreground",children:"Choose a student from the list to view their detailed information and tools."})]})})})]})}function ie(){const[j,f]=s.useState([]),[N,v]=s.useState(null),[y,B]=s.useState(!0),[J,H]=s.useState(!1),[W,K]=s.useState(!1),{user:Q}=r(),{toast:X}=i(),Z=a(),{create:ee,creating:se}=U(),ae=async e=>{try{if(!Q?.id)return void X({title:"Error",description:"You must be logged in to send messages.",variant:"destructive"});const s=await ee(Q.id,e.id,void 0);if(!s)throw new Error("Failed to create conversation");X({title:"Conversation Created!",description:`Ready to message ${e.full_name}. Redirecting to Messages...`}),Z("/advocate/messages",{state:{conversationId:s.id,newMessage:{advocateId:Q.id,parentId:e.id,parentName:e.full_name}}})}catch(s){console.error("Error creating conversation:",s),X({title:"Error",description:"Failed to create conversation. Please try again.",variant:"destructive"})}},[ie,ne]=s.useState({email:"",firstName:"",lastName:"",phone:"",address:""});s.useEffect(()=>{console.log("🔍 AdvocateParents useEffect triggered with user:",Q),console.log("🔍 User role:",Q?.role,"Email:",Q?.email),Q&&"advocate"===Q.role?(console.log("✅ Advocate user found, calling fetchParents..."),le()):Q&&"advocate"!==Q.role?console.log("❌ User is not an advocate, role:",Q.role):console.log("❌ No user found, skipping fetchParents")},[Q]);const le=async()=>{if(console.log("🚀 fetchParents called"),!Q)return void console.log("❌ fetchParents: No user, returning early");if("advocate"!==Q.role)return void console.log("❌ fetchParents: User is not advocate, role:",Q.role);const e=localStorage.getItem("authToken");console.log("🔍 fetchParents - Auth token present:",!!e),e&&console.log("🔍 fetchParents - Token preview:",`${e.substring(0,20)}...`),console.log("🔍 fetchParents - User object:",JSON.stringify(Q,null,2));try{console.log("📡 Making authenticated API call to /api/parents with apiRequest...");const e=await n("GET","/api/parents");console.log("✅ fetchParents - API response received successfully"),console.log("📡 fetchParents - Response status:",e.status);const s=await e.json();console.log("✅ Fetched parent clients raw data:",s);let a=[];Array.isArray(s)?(a=s,console.log("✅ Using direct array response with",s.length,"clients")):s&&Array.isArray(s.clients)?(a=s.clients,console.log("✅ Using wrapped response with",s.clients.length,"clients")):s&&Array.isArray(s.parents)?(a=s.parents,console.log("✅ Using wrapped response with",s.parents.length,"clients")):(console.log("⚠️ Unknown API response format:",s),a=[]),f(a)}catch(s){console.error("❌ Error fetching parents:",s),s.message&&s.message.includes("401")&&console.log("🔄 Authentication failed - apiRequest already handled token cleanup"),f([])}finally{console.log("🏁 fetchParents completed, setting loading to false"),B(!1)}},ce=(e,s)=>{ne(a=>({...a,[e]:s}))},de=N?j.find(e=>e.id===N):null;return Q?e.jsx(l,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"My Parent Clients"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your client relationships and view parent accounts you've created"})]}),e.jsxs(w,{open:W,onOpenChange:K,children:[e.jsx(C,{asChild:!0,children:e.jsxs(c,{className:"button-premium",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Create New Parent"]})}),e.jsxs(S,{className:"max-w-2xl",children:[e.jsxs(k,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Create New Parent Account"]}),e.jsx(_,{children:"Create a new parent account and establish them as your client. They will receive an email to set their password."})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),H(!0);try{await D.inviteParent(ie.email,ie.firstName,ie.lastName);X({title:"Success!",description:"Invitation sent to the parent. They'll set up their account via email."}),ne({email:"",firstName:"",lastName:"",phone:"",address:""}),K(!1),le()}catch(s){console.error("Error creating parent:",s),X({title:"Error",description:s.message||"Failed to create parent account. Please try again.",variant:"destructive"})}finally{H(!1)}},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"firstName",className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"First Name *"]}),e.jsx(o,{id:"firstName",type:"text",value:ie.firstName,onChange:e=>ce("firstName",e.target.value),placeholder:"Enter first name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"lastName",children:"Last Name *"}),e.jsx(o,{id:"lastName",type:"text",value:ie.lastName,onChange:e=>ce("lastName",e.target.value),placeholder:"Enter last name",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"email",className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Email Address *"]}),e.jsx(o,{id:"email",type:"email",value:ie.email,onChange:e=>ce("email",e.target.value),placeholder:"parent@example.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"phone",className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"Phone Number (Optional)"]}),e.jsx(o,{id:"phone",type:"tel",value:ie.phone,onChange:e=>ce("phone",e.target.value),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>K(!1),disabled:J,children:"Cancel"}),e.jsx(c,{type:"submit",className:"button-premium",disabled:J,children:J?"Creating...":"Create Parent Account"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(m,{className:"premium-card",children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Parent Clients (",j.length,")"]}),e.jsx(u,{children:"Select a parent to view details"})]}),e.jsxs(g,{className:"p-4",children:[e.jsx(T,{parents:j,loading:y,onMessage:ae,onEdit:e=>v(e.id),onViewStudents:e=>v(e.id)}),!y&&0===j.length&&e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(R,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Parent Clients Yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"You haven't created any parent accounts yet. Get started by inviting your first client."}),e.jsxs(c,{onClick:()=>K(!0),className:"button-premium",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Create Your First Parent Client"]})]})]})]})}),e.jsx("div",{className:"lg:col-span-4",children:de?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"premium-card",children:e.jsx(x,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(E,{className:"h-16 w-16",children:e.jsx(A,{className:"text-lg bg-gradient-primary text-primary-foreground",children:de.full_name?.split(" ").map(e=>e[0]).join("")||"NA"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(h,{className:"text-2xl text-gradient",children:de.full_name}),e.jsxs(u,{className:"flex items-center space-x-4 mt-2",children:[e.jsx("span",{children:de.email}),e.jsx("span",{children:"•"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{className:`text-xs ${p("developing")}`,children:["IEP: ","developing".charAt(0).toUpperCase()+"developing".slice(1)]}),e.jsxs(b,{className:`text-xs ${(e=>{switch(e?.toLowerCase()){case"active":return"bg-success text-success-foreground";case"pending":case"invited":return"bg-warning text-warning-foreground";case"closed":return"bg-destructive text-destructive-foreground";default:return"bg-muted text-muted-foreground"}})(de.status)}`,children:["Case Status: ",de.status||"Pending"]})]})]})]})]})})}),e.jsxs(I,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs($,{className:"grid w-full grid-cols-1 sm:grid-cols-3 premium-card",children:[e.jsx(F,{value:"overview",children:"Overview"}),e.jsx(F,{value:"students",children:"Students"}),e.jsx(F,{value:"communication",children:"Communication"})]}),e.jsx(G,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(m,{className:"premium-card",children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center",children:[e.jsx(M,{className:"h-5 w-5 mr-2"}),"Contact Information"]})}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium",children:"Email"}),e.jsx("p",{className:"text-muted-foreground",children:de.email})]}),de.phone&&e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium",children:"Phone"}),e.jsx("p",{className:"text-muted-foreground",children:de.phone})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium",children:"Client Since"}),e.jsx("p",{className:"text-muted-foreground",children:(e=>{try{return new Date(e).toLocaleDateString()}catch{return"N/A"}})(de.created_at)})]})]})})]}),e.jsxs(m,{className:"premium-card",children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center",children:[e.jsx(z,{className:"h-5 w-5 mr-2"}),"Student Summary"]})}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Total Students"}),e.jsx("span",{className:"font-semibold",children:de.students_count||0})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",asChild:!0,className:"w-full",children:e.jsx(t,{to:`/advocate/students?parent=${de.id}`,children:"View All Students"})}),e.jsx(te,{parentId:de.id,parentName:de.full_name})]})]})})]})]})}),e.jsx(G,{value:"students",className:"space-y-6",children:e.jsxs(m,{className:"premium-card",children:[e.jsxs(x,{children:[e.jsx(h,{children:"Students"}),e.jsx(u,{children:"All students associated with this parent client"})]}),e.jsx(g,{children:e.jsx(re,{parentId:de.id})})]})}),e.jsx(G,{value:"communication",className:"space-y-6",children:e.jsxs(m,{className:"premium-card",children:[e.jsxs(x,{children:[e.jsx(h,{children:"Communication"}),e.jsx(u,{children:"Send messages and view communication history with this parent"})]}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{asChild:!0,className:"flex-1",children:e.jsxs(t,{to:`/advocate/messages?parent=${de.id}`,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Open Messages"]})}),e.jsxs(c,{variant:"outline",onClick:()=>ae(de),disabled:se,"data-testid":"button-send-message",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),se?"Creating...":"Send Message"]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"View all conversations and send secure messages to this parent about their child's IEP needs."})]})})]})})]})]}):e.jsx(m,{className:"premium-card",children:e.jsxs(g,{className:"p-8 text-center",children:[e.jsx(Y,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Select a Parent Client"}),e.jsx("p",{className:"text-muted-foreground",children:"Choose a parent from the list to view their details, students, and communication history."})]})})})]})]})}):e.jsx("div",{children:"Please log in to view your clients."})}export{ie as default};
