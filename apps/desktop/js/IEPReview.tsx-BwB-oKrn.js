import{j as e}from"./chunk-DsWtD-um.js";import{r as s}from"./chunk--CdJ9rTh.js";import{M as a,C as t,P as r}from"./chunk-BCnyNuml.js";import{a as l,u as i,B as n,c,L as d,I as o}from"../assets/index-BO9uTDme.js";import{S as x}from"./chunk-_ehLlnDZ.js";import{P as m}from"./chunk-AZ65KXW4.js";import{D as h,e as g,a as u,b as p,c as j,d as v}from"./chunk-Bjjg2cVV.js";import{B as f}from"./chunk-qxwVooB6.js";import{P as y}from"./chunk-D0h9MBRh.js";import{T as N,a as b,b as k,c as w}from"./chunk-BxqMa7bc.js";import{T as S}from"./chunk-BZjdROIr.js";import{S as C,a as D,b as A,c as _,d as q}from"./chunk-BJKDjCst.js";import{a as F}from"./chunk-CbYvpwVq.js";import{aU as P,o as E,B as I,T as z,x as R,f as T,Y as U,y as G,w as M,b as O,a2 as $,C as L,ab as B,M as X,aN as Q}from"./chunk-CIO6T0Sb.js";import"./chunk-DiCKXT8z.js";function V(){const[d,o]=s.useState([]),[S,C]=s.useState(null),[D,A]=s.useState([]),[_,q]=s.useState(null),[V,Y]=s.useState([]),[J,K]=s.useState(!1),[W,Z]=s.useState("idle"),[ee,se]=s.useState("idle"),[ae,te]=s.useState(!1),[re,le]=s.useState("upload"),{toast:ie}=l(),{user:ne}=i();s.useEffect(()=>{ne&&ce()},[ne]);const ce=async()=>{try{const e=await F.getDocuments();o(e.map(e=>({id:e.id,title:e.title,storage_path:e.file_path,uploaded_at:e.created_at||(new Date).toISOString()})))}catch(e){console.error("Error fetching documents:",e),ie({title:"Error",description:"Failed to load documents",variant:"destructive"})}},de=async e=>{if(S){se("processing");try{await F.analyzeIEP(S.id,e,"");se("completed"),await(async e=>{try{const s=await F.getAIReviews(e);A(s.map(s=>{const a=s.ai_analysis||{},t="string"==typeof a?a:a.content||"",r=t.toLowerCase().includes("concern")?[{where:"Goal Section",notes:"Some goals may need refinement",type:"moderate"}]:[];return{id:s.id,doc_id:e,kind:s.review_type,version:1,summary:t,scores:{overall:85,goal_quality:80,service_alignment:90,compliance:85},flags:r,recommendations:[{title:"Enhance Goal Specificity",suggestion:"Consider making goals more specific and measurable"},{title:"Service Alignment",suggestion:"Ensure services directly support stated goals"}],created_at:s.created_at||(new Date).toISOString(),model:"gpt-5"}}))}catch(s){console.error("Error fetching analyses:",s),ie({title:"Error",description:"Failed to load analyses",variant:"destructive"})}})(S.id),le("report"),ie({title:"Analysis complete",description:"Document analysis completed successfully."})}catch(s){se("error"),ie({title:"Analysis failed",description:s.message,variant:"destructive"})}}};return e.jsxs(a,{children:[e.jsx(m,{title:"AI IEP Review & Compliance",subtitle:"AI-powered quality and compliance analysis",showBack:!0}),e.jsx(x,{children:e.jsxs(t,{className:"space-y-6 pb-8","data-testid":"iep-review-container",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-2",children:[e.jsxs(f,{variant:"upload"===re?"default":"secondary",className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),"Upload"]}),e.jsx(E,{className:"h-4 w-4 text-gray-400"}),e.jsxs(f,{variant:"ingest"===re?"default":S?"secondary":"outline",className:"flex items-center gap-1",children:[e.jsx(I,{className:"h-3 w-3"}),"Process"]}),e.jsx(E,{className:"h-4 w-4 text-gray-400"}),e.jsxs(f,{variant:"analyze"===re?"default":"completed"===W?"secondary":"outline",className:"flex items-center gap-1",children:[e.jsx(z,{className:"h-3 w-3"}),"Analyze"]}),e.jsx(E,{className:"h-4 w-4 text-gray-400"}),e.jsxs(f,{variant:"report"===re?"default":D.length>0?"secondary":"outline",className:"flex items-center gap-1",children:[e.jsx(R,{className:"h-3 w-3"}),"Report"]})]}),e.jsxs(N,{value:re,onValueChange:le,className:"space-y-6",children:[e.jsx("div",{className:"hidden",children:e.jsxs(b,{className:"grid w-full grid-cols-2 sm:grid-cols-4",children:[e.jsx(k,{value:"upload",children:"Upload"}),e.jsx(k,{value:"ingest",disabled:!S,children:"Ingest"}),e.jsx(k,{value:"analyze",disabled:"completed"!==W,children:"Analyze"}),e.jsx(k,{value:"report",disabled:0===D.length,children:"Report"})]})}),e.jsx(w,{value:"upload",className:"space-y-6",children:e.jsx(r,{variant:"glass",className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950 dark:to-blue-900 flex items-center justify-center",children:e.jsx(P,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Upload IEP Document"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Upload PDF, DOCX, or TXT files for AI analysis"})]})]}),e.jsxs("div",{className:"border-2 border-dashed border-blue-200 dark:border-blue-800 rounded-2xl p-8 text-center hover:border-blue-300 dark:hover:border-blue-700 transition-all duration-200 bg-gradient-to-br from-blue-50/30 to-transparent dark:from-blue-950/30",children:[e.jsx("input",{type:"file",accept:".pdf,.docx,.txt",onChange:async e=>{const s=e.target.files?.[0];if(s&&ne){K(!0);try{await(e=>new Promise((s,a)=>{const t=new FileReader;t.onload=e=>{const a=e.target?.result;s(a||"")},t.onerror=()=>a(new Error("Failed to read file")),t.readAsText(e)}))(s);const e=await F.createDocument({title:s.name.split(".")[0],file_name:s.name,file_path:`uploads/${Date.now()}-${s.name}`,file_type:s.type,file_size:s.size}),a={id:e.id,title:e.title,storage_path:e.file_path,uploaded_at:e.created_at||(new Date).toISOString()};await ce(),C(a),le("ingest"),ie({title:"Upload successful",description:"Document uploaded successfully. Ready for processing."})}catch(a){ie({title:"Upload failed",description:a.message,variant:"destructive"})}finally{K(!1)}}},className:"hidden",id:"file-upload",disabled:J,"data-testid":"file-input-upload"}),e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer block "+(J?"opacity-50 cursor-not-allowed":""),children:[e.jsx(T,{className:"mx-auto h-16 w-16 text-blue-500 dark:text-blue-400 mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(n,{variant:J?"outline":"default",disabled:J,className:"pointer-events-none h-12 px-8","data-testid":"button-choose-file",children:J?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 mr-2 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Choose Document"]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"PDF, DOCX, or TXT up to 10MB"})]})]})]}),d.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Recent Documents"}),e.jsx(f,{variant:"secondary",className:"text-xs",children:d.length})]}),e.jsx("div",{className:"space-y-3",children:d.map(s=>e.jsx(r,{variant:S?.id===s.id?"interactive":"default",onClick:()=>C(s),className:c("p-4 transition-all duration-200",S?.id===s.id?"ring-2 ring-blue-500 ring-offset-2 bg-blue-50 dark:bg-blue-950/30":"hover:shadow-md"),"data-testid":`card-document-${s.id}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700 flex items-center justify-center",children:e.jsx(T,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Uploaded ",new Date(s.uploaded_at).toLocaleDateString()]})]}),S?.id===s.id&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),e.jsx(f,{variant:"default",className:"text-xs",children:"Selected"})]})]})},s.id))})]})]})})}),e.jsx(w,{value:"ingest",className:"space-y-6",children:e.jsx(r,{variant:"elevated",className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-950 dark:to-purple-900 flex items-center justify-center",children:e.jsx(I,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Document Processing"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Extract and chunk text for AI analysis"})]})]}),S&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{variant:"glass",className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-100 to-blue-200 dark:from-blue-800 dark:to-blue-700 flex items-center justify-center",children:e.jsx(T,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100",children:S.title}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"idle"===W?"Ready for processing":"processing"===W?"Processing...":"completed"===W?"Processing complete":"Processing failed"})]})]}),e.jsx(n,{onClick:async()=>{if(S){Z("processing");try{await F.ingestIEP(S.id);Z("completed"),le("analyze"),ie({title:"Processing complete",description:"Document processing completed successfully."})}catch(e){Z("error"),ie({title:"Ingestion failed",description:e.message,variant:"destructive"})}}},disabled:"processing"===W||"completed"===W,className:"flex items-center gap-2 h-12 px-6",variant:"completed"===W?"outline":"default","data-testid":"button-start-ingest",children:"processing"===W?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 animate-spin"}),"Processing..."]}):"completed"===W?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4"}),"Completed"]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4"}),"Start Processing"]})})]})}),"processing"===W&&e.jsx(r,{variant:"glass",className:"p-4 bg-blue-50/50 dark:bg-blue-950/20",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4 animate-spin text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Processing document..."})]}),e.jsx(y,{value:void 0,className:"h-2 bg-blue-100 dark:bg-blue-800"}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"This may take a few moments"})]})}),"completed"===W&&e.jsx(r,{variant:"glass",className:"p-4 bg-green-50/50 dark:bg-green-950/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 dark:bg-green-800 flex items-center justify-center",children:e.jsx(G,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-green-900 dark:text-green-100",children:"Processing completed successfully"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Document is ready for AI analysis"})]})]})}),"error"===W&&e.jsx(r,{variant:"glass",className:"p-4 bg-red-50/50 dark:bg-red-950/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 dark:bg-red-800 flex items-center justify-center",children:e.jsx(M,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-red-900 dark:text-red-100",children:"Processing failed"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:"Please try again or contact support"})]})]})})]})]})})}),e.jsxs(w,{value:"analyze",className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-1 lg:grid-cols-2",children:[e.jsxs(r,{variant:"interactive",onClick:()=>"processing"!==ee&&de("quality"),disabled:"processing"===ee,className:"p-6 relative overflow-hidden","data-testid":"card-quality-analysis",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-green-50/50 to-transparent dark:from-green-950/20 rounded-full transform translate-x-16 -translate-y-16"}),e.jsxs("div",{className:"relative z-10 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-green-50 to-green-100 dark:from-green-950 dark:to-green-900 flex items-center justify-center",children:e.jsx(z,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Quality Analysis"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"IEP quality, goal effectiveness, and service alignment"})]})]}),e.jsx(n,{onClick:()=>de("quality"),disabled:"processing"===ee,className:"w-full h-12 flex items-center gap-2","data-testid":"button-run-quality-analysis",children:"processing"===ee?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4"}),"Run Quality Analysis"]})})]})]}),e.jsxs(r,{variant:"interactive",onClick:()=>"processing"!==ee&&de("compliance"),disabled:"processing"===ee,className:"p-6 relative overflow-hidden","data-testid":"card-compliance-check",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-blue-50/50 to-transparent dark:from-blue-950/20 rounded-full transform translate-x-16 -translate-y-16"}),e.jsxs("div",{className:"relative z-10 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950 dark:to-blue-900 flex items-center justify-center",children:e.jsx($,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Compliance Check"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"IDEA compliance, timelines, and procedural requirements"})]})]}),e.jsx(n,{onClick:()=>de("compliance"),disabled:"processing"===ee,className:"w-full h-12 flex items-center gap-2",variant:"outline","data-testid":"button-run-compliance-check",children:"processing"===ee?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4"}),"Run Compliance Check"]})})]})]})]}),"processing"===ee&&e.jsx(r,{variant:"glass",className:"p-6 bg-purple-50/30 dark:bg-purple-950/20",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-100 to-purple-200 dark:from-purple-800 dark:to-purple-700 flex items-center justify-center",children:e.jsx(I,{className:"h-6 w-6 text-purple-600 dark:text-purple-400 animate-pulse"})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:"AI analysis in progress..."}),e.jsx(y,{value:void 0,className:"h-3 bg-purple-100 dark:bg-purple-800"}),e.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-300",children:"This may take a few minutes depending on document size"})]})]})})]}),e.jsx(w,{value:"report",className:"space-y-6",children:D.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Analysis Reports"}),e.jsx(f,{variant:"secondary",className:"text-xs",children:D.length})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2",children:D.map(s=>e.jsxs(n,{variant:_?.id===s.id?"default":"outline",onClick:()=>q(s),className:"capitalize whitespace-nowrap h-12 px-6 flex items-center gap-2","data-testid":`button-select-${s.kind}-analysis`,children:["quality"===s.kind?e.jsx(z,{className:"h-4 w-4"}):e.jsx($,{className:"h-4 w-4"}),s.kind," Analysis",e.jsxs(f,{variant:"secondary",className:"text-xs ml-1",children:["v",s.version]})]},s.id))})]}),_&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-4",children:Object.entries(_.scores).map(([s,a])=>{return"overall"!==s&&e.jsx("div",{"data-testid":`score-card-${s}`,children:(t=s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),l=a,i=`${s} assessment score`,e.jsx(r,{variant:"elevated",className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(y,{value:l,className:"h-3 bg-gray-100 dark:bg-gray-800"})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:l})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:i})]})}))},s);var t,l,i})}),e.jsx(r,{variant:"elevated",className:"p-6 bg-gradient-to-br from-blue-50/50 to-purple-50/50 dark:from-blue-950/20 dark:to-purple-950/20",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-100 to-purple-100 dark:from-blue-800 dark:to-purple-800 flex items-center justify-center",children:e.jsx(L,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:["Overall ",_.kind.charAt(0).toUpperCase()+_.kind.slice(1)," Score"]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Comprehensive ",_.kind," assessment"]})]})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"text-5xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:[_.scores.overall,"/100"]}),e.jsx(y,{value:_.scores.overall,className:"h-4 bg-gray-100 dark:bg-gray-800","data-testid":"progress-overall-score"}),e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[_.scores.overall>=80?e.jsx(G,{className:"h-5 w-5 text-green-500"}):_.scores.overall>=60?e.jsx(M,{className:"h-5 w-5 text-yellow-500"}):e.jsx(M,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:_.scores.overall>=80?"Excellent":_.scores.overall>=60?"Good":"Needs Improvement"})]})})]})]})}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsx(r,{variant:"elevated",className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-yellow-100 to-orange-100 dark:from-yellow-800 dark:to-orange-800 flex items-center justify-center",children:e.jsx(M,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Flags & Concerns"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[_.flags.length," issues identified"]})]})]}),e.jsx("div",{className:"space-y-3",children:_.flags.length>0?_.flags.map((s,a)=>e.jsx(r,{variant:"glass",className:"p-4 bg-yellow-50/50 dark:bg-yellow-950/20","data-testid":`flag-item-${a}`,children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h4",{className:"font-medium text-yellow-900 dark:text-yellow-100",children:s.where}),s.type&&e.jsx(f,{variant:"outline",className:"text-xs",children:s.type})]}),e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:s.notes})]})},a)):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-2 text-green-500"}),e.jsx("p",{children:"No concerns identified"})]})})]})}),e.jsx(r,{variant:"elevated",className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-green-100 to-blue-100 dark:from-green-800 dark:to-blue-800 flex items-center justify-center",children:e.jsx(B,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Recommendations"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[_.recommendations.length," improvement suggestions"]})]})]}),e.jsx("div",{className:"space-y-3",children:_.recommendations.map((s,a)=>e.jsx(r,{variant:"glass",className:"p-4 bg-blue-50/50 dark:bg-blue-950/20","data-testid":`recommendation-item-${a}`,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100",children:s.title}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:s.suggestion})]})},a))})]})})]}),e.jsx(r,{variant:"elevated",className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-50 to-purple-100 dark:from-indigo-950 dark:to-purple-900 flex items-center justify-center",children:e.jsx(X,{className:"h-6 w-6 text-indigo-600 dark:text-indigo-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Generate Action Drafts"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Create letter drafts based on analysis findings"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs(h,{open:ae,onOpenChange:te,children:[e.jsx(g,{asChild:!0,children:e.jsxs(n,{className:"h-12 px-6 flex items-center gap-2","data-testid":"button-generate-draft",children:[e.jsx(O,{className:"h-4 w-4"}),"Generate Letter Draft"]})}),e.jsxs(u,{className:"max-w-2xl",children:[e.jsxs(p,{children:[e.jsx(j,{children:"Generate Action Draft"}),e.jsx(v,{children:"Create a letter draft based on the analysis findings"})]}),e.jsx(H,{onSubmit:async(e,s)=>{if(_)try{const a=await F.createActionDraft(_.id,e,s),t={id:a.draftId,title:a.title,body:a.body,created_at:(new Date).toISOString()};Y([t,...V]),te(!1),ie({title:"Action draft generated",description:"Letter draft created successfully."})}catch(a){ie({title:"Draft generation failed",description:a.message,variant:"destructive"})}}})]})]}),e.jsxs(n,{variant:"outline",className:"h-12 px-6 flex items-center gap-2","data-testid":"button-download-report",children:[e.jsx(Q,{className:"h-4 w-4"}),"Download Report"]})]}),V.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Generated Drafts"}),e.jsx(f,{variant:"secondary",className:"text-xs",children:V.length})]}),e.jsx("div",{className:"space-y-3",children:V.map(s=>e.jsx(r,{variant:"glass",className:"p-4","data-testid":`draft-item-${s.id}`,children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s.title}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap max-h-40 overflow-y-auto bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:s.body}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(n,{size:"sm",variant:"outline",className:"h-9 px-4",children:"Edit"}),e.jsx(n,{size:"sm",variant:"outline",className:"h-9 px-4",children:"Copy"}),e.jsx(n,{size:"sm",variant:"outline",className:"h-9 px-4",children:"Download"})]})]})},s.id))})]})]})})]})]})})]})]})})]})}function H({onSubmit:a}){const[t,r]=s.useState("goal_revision_request"),[l,i]=s.useState({studentName:"",parentName:"",caseManager:"",currentSituation:"",requestedServices:"",evaluationAreas:""});return e.jsxs("form",{onSubmit:e=>{e.preventDefault(),a(t,l)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"templateType",children:"Letter Type"}),e.jsxs(C,{value:t,onValueChange:r,children:[e.jsx(D,{children:e.jsx(A,{})}),e.jsxs(_,{children:[e.jsx(q,{value:"goal_revision_request",children:"Goal Revision Request"}),e.jsx(q,{value:"service_request",children:"Service Request"}),e.jsx(q,{value:"evaluation_request",children:"Evaluation Request"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"studentName",children:"Student Name"}),e.jsx(o,{id:"studentName",value:l.studentName,onChange:e=>i({...l,studentName:e.target.value}),placeholder:"Enter student name"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"parentName",children:"Parent Name"}),e.jsx(o,{id:"parentName",value:l.parentName,onChange:e=>i({...l,parentName:e.target.value}),placeholder:"Enter parent name"})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"caseManager",children:"Case Manager"}),e.jsx(o,{id:"caseManager",value:l.caseManager,onChange:e=>i({...l,caseManager:e.target.value}),placeholder:"Enter case manager name"})]}),"goal_revision_request"===t&&e.jsxs("div",{children:[e.jsx(d,{htmlFor:"currentSituation",children:"Current Situation"}),e.jsx(S,{id:"currentSituation",value:l.currentSituation,onChange:e=>i({...l,currentSituation:e.target.value}),placeholder:"Describe the current situation..."})]}),"service_request"===t&&e.jsxs("div",{children:[e.jsx(d,{htmlFor:"requestedServices",children:"Requested Services"}),e.jsx(S,{id:"requestedServices",value:l.requestedServices,onChange:e=>i({...l,requestedServices:e.target.value}),placeholder:"Describe the requested services..."})]}),"evaluation_request"===t&&e.jsxs("div",{children:[e.jsx(d,{htmlFor:"evaluationAreas",children:"Evaluation Areas"}),e.jsx(S,{id:"evaluationAreas",value:l.evaluationAreas,onChange:e=>i({...l,evaluationAreas:e.target.value}),placeholder:"Specify areas for evaluation..."})]}),e.jsx(n,{type:"submit",className:"w-full",children:"Generate Draft"})]})}export{V as default};
