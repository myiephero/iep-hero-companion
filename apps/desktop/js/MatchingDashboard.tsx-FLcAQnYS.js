import{j as e}from"./chunk-DsWtD-um.js";import{r as s,d as a}from"./chunk--CdJ9rTh.js";import{u as t,a as l,D as i,B as c,C as n,h as r,d,e as o,f as m,L as h,I as x,m as u}from"../assets/index-4xq_U8Za.js";import{B as p}from"./chunk-dWvI_tCU.js";import{T as j,a as v,b as f,c as N}from"./chunk-D2svoMR0.js";import{D as y,e as g,a as w,b,c as _,d as S}from"./chunk-DtPYXc3G.js";import{S as C,a as q,b as A,c as M,d as k}from"./chunk-C503eIeV.js";import{A as P,b as I,a as E}from"./chunk-XC33JK1E.js";import{P as F}from"./chunk-CeDn3LK_.js";import{b as L,u as D,c as T}from"./chunk-DiCKXT8z.js";import{U as R,M as z,Y,aC as G,aA as K,ae as $,aO as B,D as O,e as Q}from"./chunk-CIO6T0Sb.js";function V(){const{user:V}=t(),[H,J]=s.useState(null),[U,W]=s.useState(""),[X,Z]=s.useState("all"),[ee,se]=s.useState("browse"),{toast:ae}=l(),te=L(),le=a(),ie=window.location.pathname.includes("/advocate/"),ce=V?.role||"parent",{data:ne=[],isLoading:re}=D({queryKey:["students"],queryFn:async()=>{const e=await u("GET","/api/students");return await e.json()},enabled:!ie}),{data:de=[],isLoading:oe}=D({queryKey:["advocates"],queryFn:async()=>{const e=await u("GET","/api/advocates");return await e.json()},enabled:!ie}),{data:me,isLoading:he}=D({queryKey:["match-proposals",ce],queryFn:async()=>{const e=ie?"/api/match/advocate-proposals":"/api/match",s=await u("GET",e);return await s.json()}}),xe=Array.isArray(me?.proposals)?me.proposals:[],ue=de.filter(e=>{const s=e.full_name.toLowerCase().includes(U.toLowerCase())||(e.bio||"").toLowerCase().includes(U.toLowerCase())||(e.specializations||[]).some(e=>e.toLowerCase().includes(U.toLowerCase())),a="all"===X||(e.specializations||[]).includes(X);return s&&a}),pe=T({mutationFn:async({studentId:e,advocateIds:s})=>{const a=await u("POST","/api/match/propose",{student_id:e,advocate_ids:s,manual_match:!0});return await a.json()},onSuccess:()=>{te.invalidateQueries({queryKey:["match-proposals"]}),ae({title:"Match Proposal Sent",description:"Your proposal has been sent to the advocate for review."}),se("proposals")},onError:()=>{ae({title:"Error",description:"Failed to create match proposal. Please try again.",variant:"destructive"})}}),je=T({mutationFn:async({proposalId:e,notes:s})=>{const a=await u("POST",`/api/match/${e}/intro`,{notes:s});return await a.json()},onSuccess:()=>{te.invalidateQueries({queryKey:["match-proposals"]}),ae({title:"Intro Call Requested",description:"The advocate has been notified of your intro call request."})},onError:()=>{ae({title:"Error",description:"Failed to request intro call.",variant:"destructive"})}}),ve=T({mutationFn:async e=>{const s=await u("POST",`/api/match/${e}/accept`);return await s.json()},onSuccess:()=>{te.invalidateQueries({queryKey:["match-proposals",ce]}),ae({title:"Proposal Accepted",description:"You've accepted this match proposal. The family will be notified."})},onError:()=>{ae({title:"Error",description:"Failed to accept proposal.",variant:"destructive"})}}),fe=T({mutationFn:async({proposalId:e,reason:s})=>{const a=await u("POST",`/api/match/${e}/decline`,{reason:s});return await a.json()},onSuccess:()=>{te.invalidateQueries({queryKey:["match-proposals",ce]}),ae({title:"Proposal Declined",description:"You've declined this match proposal."})},onError:()=>{ae({title:"Error",description:"Failed to decline proposal.",variant:"destructive"})}});return ie?e.jsx(i,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Client Matching"}),e.jsx("p",{className:"text-muted-foreground",children:"Review incoming match proposals and connect with new families"})]}),e.jsxs(j,{value:ee,onValueChange:se,className:"w-full",children:[e.jsxs(v,{className:"grid w-full grid-cols-3",children:[e.jsx(f,{value:"incoming",children:"Incoming Proposals"}),e.jsx(f,{value:"active",children:"Active Matches"}),e.jsx(f,{value:"history",children:"Match History"})]}),e.jsxs(N,{value:"incoming",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"New Match Proposals"}),e.jsx(c,{onClick:()=>{},variant:"outline",children:"Refresh"})]}),0===xe.filter(e=>"pending"===e.status).length?e.jsx(n,{children:e.jsxs(r,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(R,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No New Proposals"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md",children:"You don't have any new match proposals at the moment. New families will appear here when they're interested in working with you."})]})}):e.jsx("div",{className:"grid gap-4",children:xe.filter(e=>"pending"===e.status).map(s=>e.jsxs(n,{className:"hover:shadow-md transition-shadow",children:[e.jsx(d,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(o,{className:"text-lg",children:["Match Request from ",s.student?.full_name,"'s Family"]}),e.jsxs(m,{children:[s.student?.grade_level," • ",s.student?.disability_category||"Special Education Support"]})]}),e.jsxs(p,{variant:"secondary",children:[s.score,"% Match"]})]})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"font-medium",children:"Student Background"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.student?.notes||"No additional notes provided"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.student?.disability_category&&e.jsx(p,{variant:"outline",children:s.student.disability_category}),e.jsx(p,{variant:"outline",children:s.student?.grade_level}),e.jsx(p,{variant:"outline",children:s.student?.school_name})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Received ",new Date(s.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(c,{variant:"outline",onClick:()=>{return e=s.id,void fe.mutate({proposalId:e,reason:"Not a good fit at this time"});var e},children:"Decline"}),e.jsx(c,{variant:"secondary",onClick:()=>(e=>{const s={advocateId:e.advocate_id,studentId:e.student_id,studentName:e.student?.full_name,proposalId:e.id,parentId:e.student?.user_id||V?.id,studentGrade:e.student?.grade_level,studentSchool:"N/A"};le("/advocate/messages",{state:{newMessage:s}})})(s),children:"Send Message"}),e.jsx(c,{onClick:()=>{return e=s.id,void ve.mutate(e);var e},children:"Accept Match"})]})]})]})]},s.id))})]}),e.jsx(N,{value:"active",className:"space-y-4",children:e.jsx(n,{children:e.jsxs(r,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(z,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Active Matches Coming Soon"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md",children:"Your accepted matches and ongoing cases will appear here."})]})})}),e.jsx(N,{value:"history",className:"space-y-4",children:e.jsx(n,{children:e.jsxs(r,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Y,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Match History"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md",children:"Your previous matches and completed cases will be shown here."})]})})})]})]})}):e.jsx(i,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Find Advocates"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect with certified advocates who specialize in your child's needs"})]}),e.jsxs(j,{value:ee,onValueChange:se,className:"w-full",children:[e.jsxs(v,{className:"grid w-full grid-cols-3",children:[e.jsx(f,{value:"browse",children:"Browse Advocates"}),e.jsx(f,{value:"proposals",children:"My Proposals"}),e.jsx(f,{value:"matches",children:"Active Matches"})]}),e.jsxs(N,{value:"browse",className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search advocates...",value:U,onChange:e=>W(e.target.value),className:"pl-8","data-testid":"input-search-advocates"})]})}),e.jsxs(C,{value:X,onValueChange:Z,children:[e.jsxs(q,{className:"w-[200px]","data-testid":"select-specialty-filter",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),e.jsx(A,{placeholder:"Filter by specialty"})]}),e.jsxs(M,{children:[e.jsx(k,{value:"all",children:"All Specialties"}),e.jsx(k,{value:"autism",children:"Autism"}),e.jsx(k,{value:"adhd",children:"ADHD"}),e.jsx(k,{value:"gifted",children:"Gifted"}),e.jsx(k,{value:"behavioral",children:"Behavioral"}),e.jsx(k,{value:"speech",children:"Speech"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(h,{htmlFor:"student-select",className:"text-sm font-medium",children:"Select Student for Matching"}),e.jsxs(C,{value:H?.id||"",onValueChange:e=>{const s=ne.find(s=>s.id===e);J(s||null)},children:[e.jsx(q,{className:"w-full mt-1","data-testid":"select-student",children:e.jsx(A,{placeholder:"Choose a student..."})}),e.jsx(M,{children:ne.map(s=>e.jsxs(k,{value:s.id,children:[s.full_name," (Grade ",s.grade_level,")"]},s.id))})]})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:ue.map(s=>e.jsxs(n,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsxs(P,{className:"h-12 w-12",children:[e.jsx(I,{src:""}),e.jsx(E,{children:s.full_name.split(" ").map(e=>e[0]).join("")})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(o,{className:"text-lg",children:s.full_name}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx($,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),e.jsx("span",{className:"text-sm font-medium ml-1",children:s.rating||5})]}),e.jsx("span",{className:"text-sm text-gray-500",children:"•"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.years_experience||0," years"]})]})]})]})}),e.jsxs(r,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3",children:s.bio||"Experienced special education advocate."}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),s.location||"Location not specified"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"$",s.rate_per_hour||150,"/hour"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Available for new cases"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(s.specializations||[]).slice(0,4).map(s=>e.jsx(p,{variant:"secondary",className:"text-xs",children:s.replace("_"," ")},s)),(s.specializations||[]).length>4&&e.jsxs(p,{variant:"outline",className:"text-xs",children:["+",(s.specializations||[]).length-4," more"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Availability"}),e.jsx(F,{value:80,className:"h-2"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Available for new cases"})]}),e.jsxs(y,{children:[e.jsx(g,{asChild:!0,children:e.jsx(c,{className:"w-full","data-testid":`button-request-match-${s.id}`,children:"Request Match"})}),e.jsxs(w,{className:"sm:max-w-[425px]",children:[e.jsxs(b,{children:[e.jsxs(_,{children:["Request Match with ",s.full_name]}),e.jsx(S,{children:"Review the match details and send your request."})]}),H?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"font-medium",children:"Student"}),e.jsxs("p",{className:"text-sm",children:[H.full_name," (Grade ",H.grade_level,")"]})]}),e.jsxs("div",{children:[e.jsx(h,{className:"font-medium",children:"Advocate"}),e.jsx("p",{className:"text-sm",children:s.full_name})]}),e.jsxs("div",{children:[e.jsx(h,{className:"font-medium",children:"Student Needs"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(H.special_needs||[]).map(s=>e.jsx(p,{variant:"outline",className:"text-xs",children:s.replace("_"," ")},s))})]}),e.jsxs("div",{children:[e.jsx(h,{className:"font-medium",children:"Advocate Specializations"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(s.specializations||[]).map(s=>e.jsxs(p,{variant:(H.special_needs||[]).includes(s)?"default":"secondary",className:"text-xs",children:[s.replace("_"," "),(H.special_needs||[]).includes(s)&&" ✓"]},s))})]}),e.jsx(c,{onClick:()=>(async e=>{H?pe.mutate({studentId:H.id,advocateIds:[e]}):ae({title:"Error",description:"Please select a student first",variant:"destructive"})})(s.id),disabled:pe.isPending,"data-testid":"button-send-match-request",children:pe.isPending?"Sending...":"Send Match Request"})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Please select a student first to request a match."})})]})]})]})]},s.id))})]}),e.jsxs(N,{value:"proposals",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Match Proposals"}),e.jsx(c,{onClick:()=>{},variant:"outline",children:"Refresh"})]}),0===xe.length?e.jsx(n,{children:e.jsxs(r,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(z,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Proposals Yet"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md",children:"Your match proposals will appear here. Start by browsing advocates and sending match requests."})]})}):e.jsx("div",{className:"grid gap-4",children:xe.map(s=>e.jsxs(n,{className:"hover:shadow-md transition-shadow",children:[e.jsx(d,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[s.student?.name," × ",s.advocate?.name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Sent ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsx(p,{variant:"accepted"===s.status?"default":"declined"===s.status?"destructive":"intro_requested"===s.status?"secondary":"outline",children:s.status.replace("_"," ")})]})}),e.jsxs(r,{children:["pending"===s.status&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(c,{onClick:()=>(async e=>{je.mutate({proposalId:e,notes:"Looking forward to discussing this match opportunity"})})(s.id),variant:"outline",size:"sm","data-testid":`button-request-intro-${s.id}`,children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Request Intro Call"]})}),"accepted"===s.status&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-green-600 font-medium",children:"Match Accepted!"}),e.jsx("p",{className:"text-sm text-gray-600",children:"The advocate will contact you to schedule an initial consultation."})]}),"declined"===s.status&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-red-600 font-medium",children:"Match Declined"}),e.jsx("p",{className:"text-sm text-gray-600",children:"This advocate is not available for new matches at this time."})]})]})]},s.id))})]}),e.jsx(N,{value:"matches",className:"space-y-4",children:e.jsx(n,{children:e.jsxs(r,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(R,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Active Matches"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md",children:"Your active advocate matches will appear here once proposals are accepted."})]})})})]})]})})}export{V as default};
