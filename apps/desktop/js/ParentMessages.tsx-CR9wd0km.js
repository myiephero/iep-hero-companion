import{j as e}from"./chunk-DsWtD-um.js";import{c as t,B as n,r as o,t as r,v as s,w as i,x as l,a,D as c,C as u,I as d}from"../assets/index-DmH44GAo.js";import{C as m}from"./chunk-BmP5u1pH.js";import{r as h,R as f,b as g}from"./chunk--CdJ9rTh.js";import{d as p,s as x,b as v,e as w}from"./chunk-DOEim8d1.js";import{b as I,c as b}from"./chunk-DiCKXT8z.js";import{h as T,i as C,j as y,f as S,g as j,M as k}from"./chunk-l0G_Z9GI.js";import{A as R,b as N,a as H}from"./chunk-BHg6aLBB.js";import{v as z,M as E,aG as B,Y as M,N as L,aH as A,p as O,X as F,aD as P,ap as W,a1 as D,aI as V,e as _,aC as U,aJ as G}from"./chunk-CIO6T0Sb.js";import{a as $,b as K,S as q}from"./chunk-4cBoI0QY.js";import{B as Y}from"./chunk-0mWKUDnJ.js";import"./chunk--P05M-BP.js";import"./chunk-Csgv8Z6q.js";import"./chunk-Cc1_LcYd.js";import"./chunk-CSUAnfQx.js";function X(e){return()=>e}function J(e){e()}function Z(e,t){return n=>e(t(n))}function Q(e,t){return()=>e(t)}function ee(e){return void 0!==e}function te(){}function ne(e,t){return t(e),e}function oe(e,t){return t(e)}function re(...e){return e}function se(e,t){return e(1,t)}function ie(e,t){e(0,t)}function le(e){e(2)}function ae(e){return e(4)}function ce(e,t){return se(e,function(e,t){return n=>e(t,n)}(t,0))}function ue(e,t){const n=e(1,e=>{n(),t(e)});return n}function de(e){let t,n;return o=>r=>{t=r,n&&clearTimeout(n),n=setTimeout(()=>{o(t)},e)}}function me(e,t){return e===t}function he(e=me){let t;return n=>o=>{e(t,o)||(t=o,n(o))}}function fe(e){return t=>n=>{e(n)&&t(n)}}function ge(e){return t=>Z(t,e)}function pe(e){return t=>()=>{t(e)}}function xe(e,...t){const n=function(...e){return t=>e.reduceRight(oe,t)}(...t);return(t,o)=>{switch(t){case 2:return void le(e);case 1:return se(e,n(o))}}}function ve(e,t){return n=>o=>{n(t=e(t,o))}}function we(e){return t=>n=>{e>0?e--:t(n)}}function Ie(e){let t,n=null;return o=>r=>{n=r,!t&&(t=setTimeout(()=>{t=void 0,o(n)},e))}}function be(...e){const t=new Array(e.length);let n=0,o=null;const r=Math.pow(2,e.length)-1;return e.forEach((e,s)=>{const i=Math.pow(2,s);se(e,e=>{const l=n;n|=i,t[s]=e,l!==r&&n===r&&o&&(o(),o=null)})}),e=>s=>{const i=()=>{e([s].concat(t))};n===r?i():o=i}}function Te(e){let t=e;const n=ye();return(e,o)=>{switch(e){case 0:t=o;break;case 1:o(t);break;case 4:return t}return n(e,o)}}function Ce(e,t){return ne(Te(t),t=>ce(e,t))}function ye(){const e=[];return(t,n)=>{switch(t){case 0:return void e.slice().forEach(e=>{e(n)});case 2:return void e.splice(0,e.length);case 1:return e.push(n),()=>{const t=e.indexOf(n);t>-1&&e.splice(t,1)}}}}function Se(e){return ne(ye(),t=>ce(e,t))}function je(e,t=[],{singleton:n}={singleton:!0}){return{constructor:e,dependencies:t,id:ke(),singleton:n}}const ke=()=>Symbol();function Re(...e){const t=ye(),n=new Array(e.length);let o=0;const r=Math.pow(2,e.length)-1;return e.forEach((e,s)=>{const i=Math.pow(2,s);se(e,e=>{n[s]=e,o|=i,o===r&&ie(t,n)})}),function(e,s){switch(e){case 2:return void le(t);case 1:return o===r&&s(n),se(t,s)}}}function Ne(e,t=me){return xe(e,he(t))}function He(...e){return function(t,n){switch(t){case 2:return;case 1:return function(...e){return()=>{e.map(J)}}(...e.map(e=>se(e,n)))}}}var ze=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e))(ze||{});const Ee={0:"debug",3:"error",1:"log",2:"warn"},Be=je(()=>{const e=Te(3);return{log:Te((t,n,o=1)=>{var r;o>=(null!=(r=(typeof globalThis>"u"?window:globalThis).VIRTUOSO_LOG_LEVEL)?r:ae(e))&&console[Ee[o]]("%creact-virtuoso: %c%s %o","color: #0253b3; font-weight: bold","color: initial",t,n)}),logLevel:e}},[],{singleton:!0});function Me(e,t,n){return Le(e,t,n).callbackRef}function Le(e,t,n){const o=f.useRef(null);let r=e=>{};const s=f.useMemo(()=>typeof ResizeObserver<"u"?new ResizeObserver(t=>{const o=()=>{const n=t[0].target;null!==n.offsetParent&&e(n)};n?o():requestAnimationFrame(o)}):null,[e,n]);return r=e=>{e&&t?(null==s||s.observe(e),o.current=e):(o.current&&(null==s||s.unobserve(o.current)),o.current=null)},{callbackRef:r,ref:o}}function Ae(e,t,n,o,r,s,i,l,a){const c=f.useCallback(n=>{const a=function(e,t,n,o){const r=e.length;if(0===r)return null;const s=[];for(let i=0;i<r;i++){const r=e.item(i);if(void 0===r.dataset.index)continue;const l=parseInt(r.dataset.index),a=parseFloat(r.dataset.knownSize),c=t(r,n);if(0===c&&o("Zero-sized element, this should not happen",{child:r},ze.ERROR),c===a)continue;const u=s[s.length-1];0===s.length||u.size!==c||u.endIndex!==l-1?s.push({endIndex:l,size:c,startIndex:l}):s[s.length-1].endIndex++}return s}(n.children,t,l?"offsetWidth":"offsetHeight",r);let c=n.parentElement;for(;!c.dataset.virtuosoScroller;)c=c.parentElement;const u="window"===c.lastElementChild.dataset.viewportType;let d;u&&(d=c.ownerDocument.defaultView);const m=i?l?i.scrollLeft:i.scrollTop:u?l?d.scrollX||d.document.documentElement.scrollLeft:d.scrollY||d.document.documentElement.scrollTop:l?c.scrollLeft:c.scrollTop,h=i?l?i.scrollWidth:i.scrollHeight:u?l?d.document.documentElement.scrollWidth:d.document.documentElement.scrollHeight:l?c.scrollWidth:c.scrollHeight,f=i?l?i.offsetWidth:i.offsetHeight:u?l?d.innerWidth:d.innerHeight:l?c.offsetWidth:c.offsetHeight;o({scrollHeight:h,scrollTop:Math.max(m,0),viewportHeight:f}),null==s||s(l?Oe("column-gap",getComputedStyle(n).columnGap,r):Oe("row-gap",getComputedStyle(n).rowGap,r)),null!==a&&e(a)},[e,t,r,s,i,o,l]);return Le(c,n,a)}function Oe(e,t,n){return"normal"!==t&&!(null!=t&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,ze.WARN),"normal"===t?0:parseInt(null!=t?t:"0",10)}function Fe(e,t,n){const o=f.useRef(null),r=f.useCallback(n=>{if(null==n||!n.offsetParent)return;const r=n.getBoundingClientRect(),s=r.width;let l,a;if(t){const e=t.getBoundingClientRect(),n=r.top-e.top;a=e.height-Math.max(0,n),l=n+t.scrollTop}else{const e=i.current.ownerDocument.defaultView;a=e.innerHeight-Math.max(0,r.top),l=r.top+e.scrollY}o.current={offsetTop:l,visibleHeight:a,visibleWidth:s},e(o.current)},[e,t]),{callbackRef:s,ref:i}=Le(r,!0,n),l=f.useCallback(()=>{r(i.current)},[r,i]);return f.useEffect(()=>{var e;if(t){t.addEventListener("scroll",l);const e=new ResizeObserver(()=>{requestAnimationFrame(l)});return e.observe(t),()=>{t.removeEventListener("scroll",l),e.unobserve(t)}}{const t=null==(e=i.current)?void 0:e.ownerDocument.defaultView;return null==t||t.addEventListener("scroll",l),null==t||t.addEventListener("resize",l),()=>{null==t||t.removeEventListener("scroll",l),null==t||t.removeEventListener("resize",l)}}},[l,t,i]),s}const Pe=je(()=>{const e=ye(),t=ye(),n=Te(0),o=ye(),r=Te(0),s=ye(),i=ye(),l=Te(0),a=Te(0),c=Te(0),u=Te(0),d=ye(),m=ye(),h=Te(!1),f=Te(!1),g=Te(!1);return ce(xe(e,ge(({scrollTop:e})=>e)),t),ce(xe(e,ge(({scrollHeight:e})=>e)),i),ce(t,r),{deviation:n,fixedFooterHeight:c,fixedHeaderHeight:a,footerHeight:u,headerHeight:l,horizontalDirection:f,scrollBy:m,scrollContainerState:e,scrollHeight:i,scrollingInProgress:h,scrollTo:d,scrollTop:t,skipAnimationFrameInResizeObserver:g,smoothScrollTargetReached:o,statefulScrollTop:r,viewportHeight:s}},[],{singleton:!0}),We={lvl:0};function De(e,t){const n=e.length;if(0===n)return[];let{index:o,value:r}=t(e[0]);const s=[];for(let i=1;i<n;i++){const{index:n,value:l}=t(e[i]);s.push({end:n-1,start:o,value:r}),o=n,r=l}return s.push({end:1/0,start:o,value:r}),s}function Ve(e){return e===We}function _e(e,t){if(!Ve(e))return t===e.k?e.v:t<e.k?_e(e.l,t):_e(e.r,t)}function Ue(e,t,n="k"){if(Ve(e))return[-1/0,void 0];if(Number(e[n])===t)return[e.k,e.v];if(Number(e[n])<t){const o=Ue(e.r,t,n);return o[0]===-1/0?[e.k,e.v]:o}return Ue(e.l,t,n)}function Ge(e,t,n){return Ve(e)?nt(t,n,1):t===e.k?Ze(e,{k:t,v:n}):t<e.k?ot(Ze(e,{l:Ge(e.l,t,n)})):ot(Ze(e,{r:Ge(e.r,t,n)}))}function $e(){return We}function Ke(e,t,n){if(Ve(e))return[];return function(e){return De(e,({k:e,v:t})=>({index:e,value:t}))}(Xe(e,Ue(e,t)[0],n))}function qe(e,t){if(Ve(e))return We;const{k:n,l:o,r:r}=e;if(t===n){if(Ve(o))return r;if(Ve(r))return o;{const[t,n]=tt(o);return Je(Ze(e,{k:t,l:Qe(o),v:n}))}}return Je(Ze(e,t<n?{l:qe(o,t)}:{r:qe(r,t)}))}function Ye(e){return Ve(e)?[]:[...Ye(e.l),{k:e.k,v:e.v},...Ye(e.r)]}function Xe(e,t,n){if(Ve(e))return[];const{k:o,l:r,r:s,v:i}=e;let l=[];return o>t&&(l=l.concat(Xe(r,t,n))),o>=t&&o<=n&&l.push({k:o,v:i}),o<=n&&(l=l.concat(Xe(s,t,n))),l}function Je(e){const{l:t,lvl:n,r:o}=e;if(o.lvl>=n-1&&t.lvl>=n-1)return e;if(n>o.lvl+1){if(et(t))return rt(Ze(e,{lvl:n-1}));if(!Ve(t)&&!Ve(t.r))return Ze(t.r,{l:Ze(t,{r:t.r.l}),lvl:n,r:Ze(e,{l:t.r.r,lvl:n-1})});throw new Error("Unexpected empty nodes")}if(et(e))return st(Ze(e,{lvl:n-1}));if(Ve(o)||Ve(o.l))throw new Error("Unexpected empty nodes");{const t=o.l,r=et(t)?o.lvl-1:o.lvl;return Ze(t,{l:Ze(e,{lvl:n-1,r:t.l}),lvl:t.lvl+1,r:st(Ze(o,{l:t.r,lvl:r}))})}}function Ze(e,t){return nt(void 0!==t.k?t.k:e.k,void 0!==t.v?t.v:e.v,void 0!==t.lvl?t.lvl:e.lvl,void 0!==t.l?t.l:e.l,void 0!==t.r?t.r:e.r)}function Qe(e){return Ve(e.r)?e.l:Je(Ze(e,{r:Qe(e.r)}))}function et(e){return Ve(e)||e.lvl>e.r.lvl}function tt(e){return Ve(e.r)?[e.k,e.v]:tt(e.r)}function nt(e,t,n,o=We,r=We){return{k:e,l:o,lvl:n,r:r,v:t}}function ot(e){return st(rt(e))}function rt(e){const{l:t}=e;return Ve(t)||t.lvl!==e.lvl?e:Ze(t,{r:Ze(e,{l:t.r})})}function st(e){const{lvl:t,r:n}=e;return Ve(n)||Ve(n.r)||n.lvl!==t||n.r.lvl!==t?e:Ze(n,{l:Ze(e,{r:n.l}),lvl:t+1})}function it(e,t){return!(!e||e.startIndex!==t.startIndex||e.endIndex!==t.endIndex)}function lt(e,t){return!(!e||e[0]!==t[0]||e[1]!==t[1])}const at=je(()=>({recalcInProgress:Te(!1)}),[],{singleton:!0});function ct(e,t,n){return e[ut(e,t,n)]}function ut(e,t,n,o=0){let r=e.length-1;for(;o<=r;){const s=Math.floor((o+r)/2),i=n(e[s],t);if(0===i)return s;if(-1===i){if(r-o<2)return s-1;r=s-1}else{if(r===o)return s;o=s+1}}throw new Error(`Failed binary finding record in array - ${e.join(",")}, searched for ${t}`)}function dt(e,t){return Math.round(e.getBoundingClientRect()[t])}function mt(e){return!Ve(e.groupOffsetTree)}function ht({index:e},t){return t===e?0:t<e?-1:1}function ft({offset:e},t){return t===e?0:t<e?-1:1}function gt(e,t,n){if(0===t.length)return 0;const{index:o,offset:r,size:s}=ct(t,e,ht),i=e-o,l=s*i+(i-1)*n+r;return l>0?l+n:l}function pt(e,t){if(!mt(t))return e;let n=0;for(;t.groupIndices[n]<=e+n;)n++;return e+n}function xt(e,t,n){if(function(e){return typeof e.groupIndex<"u"}(e))return t.groupIndices[e.groupIndex]+1;{let o=pt("LAST"===e.index?n:e.index,t);return o=Math.max(0,o,Math.min(n,o)),o}}function vt(e,t,n,o=0){return o>0&&(t=Math.max(t,ct(e,o,ht).offset)),De(function(e,t,n,o){const r=ut(e,t,o),s=ut(e,n,o,r);return e.slice(r,s+1)}(e,t,n,ft),Tt)}function wt(e,[t,n,o,r]){t.length>0&&o("received item sizes",t,ze.DEBUG);const s=e.sizeTree;let i=s,l=0;if(n.length>0&&Ve(s)&&2===t.length){const e=t[0].size,o=t[1].size;i=n.reduce((t,n)=>Ge(Ge(t,n,e),n+1,o),i)}else[i,l]=function(e,t){let n=Ve(e)?0:1/0;for(const o of t){const{endIndex:t,size:r,startIndex:s}=o;if(n=Math.min(n,s),Ve(e)){e=Ge(e,0,r);continue}const i=Ke(e,s-1,t+1);if(i.some(Ct(o)))continue;let l=!1,a=!1;for(const{end:n,start:o,value:c}of i)l?(t>=o||r===c)&&(e=qe(e,o)):(a=c!==r,l=!0),n>t&&t>=o&&c!==r&&(e=Ge(e,t+1,c));a&&(e=Ge(e,s,r))}return[e,n]}(i,t);if(i===s)return e;const{lastIndex:a,lastOffset:c,lastSize:u,offsetTree:d}=bt(e.offsetTree,l,i,r);return{groupIndices:n,groupOffsetTree:n.reduce((e,t)=>Ge(e,t,gt(t,d,r)),$e()),lastIndex:a,lastOffset:c,lastSize:u,offsetTree:d,sizeTree:i}}function It(e,t){let n=0,o=0;for(;n<e;)n+=t[o+1]-t[o]-1,o++;return o-(n===e?0:1)}function bt(e,t,n,o){let r=e,s=0,i=0,l=0,a=0;if(0!==t){a=ut(r,t-1,ht),l=r[a].offset;const e=Ue(n,t-1);s=e[0],i=e[1],r.length&&r[a].size===Ue(n,t)[1]&&(a-=1),r=r.slice(0,a+1)}else r=[];for(const{start:c,value:u}of Ke(n,t,1/0)){const e=c-s,t=e*i+l+e*o;r.push({index:c,offset:t,size:u}),s=c,l=t,i=u}return{lastIndex:s,lastOffset:l,lastSize:i,offsetTree:r}}function Tt(e){return{index:e.index,value:e}}function Ct(e){const{endIndex:t,size:n,startIndex:o}=e;return e=>e.start===o&&(e.end===t||e.end===1/0)&&e.value===n}const yt={offsetHeight:"height",offsetWidth:"width"},St=je(([{log:e},{recalcInProgress:t}])=>{const n=ye(),o=ye(),r=Ce(o,0),s=ye(),i=ye(),l=Te(0),a=Te([]),c=Te(void 0),u=Te(void 0),d=Te((e,t)=>dt(e,yt[t])),m=Te(void 0),h=Te(0),f={groupIndices:[],groupOffsetTree:$e(),lastIndex:0,lastOffset:0,lastSize:0,offsetTree:[],sizeTree:$e()},g=Ce(xe(n,be(a,e,h),ve(wt,f),he()),f),p=Ce(xe(a,he(),ve((e,t)=>({current:t,prev:e.current}),{current:[],prev:[]}),ge(({prev:e})=>e)),[]);ce(xe(a,fe(e=>e.length>0),be(g,h),ge(([e,t,n])=>{const o=e.reduce((e,o,r)=>Ge(e,o,gt(o,t.offsetTree,n)||r),$e());return{...t,groupIndices:e,groupOffsetTree:o}})),g),ce(xe(o,be(g),fe(([e,{lastIndex:t}])=>e<t),ge(([e,{lastIndex:t,lastSize:n}])=>[{endIndex:t,size:n,startIndex:e}])),n),ce(c,u);const x=Ce(xe(c,ge(e=>void 0===e)),!0);ce(xe(u,fe(e=>void 0!==e&&Ve(ae(g).sizeTree)),ge(e=>[{endIndex:0,size:e,startIndex:0}])),n);const v=Se(xe(n,be(g),ve(({sizes:e},[t,n])=>({changed:n!==e,sizes:n}),{changed:!1,sizes:f}),ge(e=>e.changed)));se(xe(l,ve((e,t)=>({diff:e.prev-t,prev:t}),{diff:0,prev:0}),ge(e=>e.diff)),e=>{const{groupIndices:n}=ae(g);if(e>0)ie(t,!0),ie(s,e+It(e,n));else if(e<0){const t=ae(p);t.length>0&&(e-=It(-e,t)),ie(i,e)}}),se(xe(l,be(e)),([e,t])=>{e<0&&t("`firstItemIndex` prop should not be set to less than zero. If you don't know the total count, just use a very high value",{firstItemIndex:l},ze.ERROR)});const w=Se(s);ce(xe(s,be(g),ge(([e,t])=>{const n=t.groupIndices.length>0,o=[],r=t.lastSize;if(n){const n=_e(t.sizeTree,0);let s=0,i=0;for(;s<e;){const e=t.groupIndices[i],l=t.groupIndices.length===i+1?1/0:t.groupIndices[i+1]-e-1;o.push({endIndex:e,size:n,startIndex:e}),o.push({endIndex:e+1+l-1,size:r,startIndex:e+1}),i++,s+=l+1}const l=Ye(t.sizeTree);return s!==e&&l.shift(),l.reduce((t,{k:n,v:o})=>{let r=t.ranges;return 0!==t.prevSize&&(r=[...t.ranges,{endIndex:n+e-1,size:t.prevSize,startIndex:t.prevIndex}]),{prevIndex:n+e,prevSize:o,ranges:r}},{prevIndex:e,prevSize:0,ranges:o}).ranges}return Ye(t.sizeTree).reduce((t,{k:n,v:o})=>({prevIndex:n+e,prevSize:o,ranges:[...t.ranges,{endIndex:n+e-1,size:t.prevSize,startIndex:t.prevIndex}]}),{prevIndex:0,prevSize:r,ranges:[]}).ranges})),n);const I=Se(xe(i,be(g,h),ge(([e,{offsetTree:t},n])=>gt(-e,t,n))));return ce(xe(i,be(g,h),ge(([e,t,n])=>{if(t.groupIndices.length>0){if(Ve(t.sizeTree))return t;let o=$e();const r=ae(p);let s=0,i=0,l=0;for(;s<-e;){l=r[i];const e=r[i+1]-l-1;i++,s+=e+1}if(o=Ye(t.sizeTree).reduce((t,{k:n,v:o})=>Ge(t,Math.max(0,n+e),o),o),s!==-e){o=Ge(o,0,_e(t.sizeTree,l));o=Ge(o,1,Ue(t.sizeTree,1-e)[1])}return{...t,sizeTree:o,...bt(t.offsetTree,0,o,n)}}{const o=Ye(t.sizeTree).reduce((t,{k:n,v:o})=>Ge(t,Math.max(0,n+e),o),$e());return{...t,sizeTree:o,...bt(t.offsetTree,0,o,n)}}})),g),{beforeUnshiftWith:w,data:m,defaultItemSize:u,firstItemIndex:l,fixedItemSize:c,gap:h,groupIndices:a,itemSize:d,listRefresh:v,shiftWith:i,shiftWithOffset:I,sizeRanges:n,sizes:g,statefulTotalCount:r,totalCount:o,trackItemSizes:x,unshiftWith:s}},re(Be,at),{singleton:!0});function jt(e){return e.reduce((e,t)=>(e.groupIndices.push(e.totalCount),e.totalCount+=t+1,e),{groupIndices:[],totalCount:0})}const kt=je(([{groupIndices:e,sizes:t,totalCount:n},{headerHeight:o,scrollTop:r}])=>{const s=ye(),i=ye(),l=Se(xe(s,ge(jt)));return ce(xe(l,ge(e=>e.totalCount)),n),ce(xe(l,ge(e=>e.groupIndices)),e),ce(xe(Re(r,t,o),fe(([e,t])=>mt(t)),ge(([e,t,n])=>Ue(t.groupOffsetTree,Math.max(e-n,0),"v")[0]),he(),ge(e=>[e])),i),{groupCounts:s,topItemsIndexes:i}},re(St,Pe)),Rt=je(([{log:e}])=>{const t=Te(!1),n=Se(xe(t,fe(e=>e),he()));return se(t,t=>{t&&ae(e)("props updated",{},ze.DEBUG)}),{didMount:n,propsReady:t}},re(Be),{singleton:!0}),Nt=typeof document<"u"&&"scrollBehavior"in document.documentElement.style;function Ht(e){const t="number"==typeof e?{index:e}:e;return t.align||(t.align="start"),(!t.behavior||!Nt)&&(t.behavior="auto"),t.offset||(t.offset=0),t}const zt=je(([{gap:e,listRefresh:t,sizes:n,totalCount:o},{fixedFooterHeight:r,fixedHeaderHeight:s,footerHeight:i,headerHeight:l,scrollingInProgress:a,scrollTo:c,smoothScrollTargetReached:u,viewportHeight:d},{log:m}])=>{const h=ye(),f=ye(),g=Te(0);let p=null,x=null,v=null;function w(){p&&(p(),p=null),v&&(v(),v=null),x&&(clearTimeout(x),x=null),ie(a,!1)}return ce(xe(h,be(n,d,o,g,l,i,m),be(e,s,r),ge(([[e,n,o,r,s,i,l,c],d,m,g])=>{const I=Ht(e),{align:b,behavior:T,offset:C}=I,y=r-1,S=xt(I,n,y);let j=gt(S,n.offsetTree,d)+i;"end"===b?(j+=m+Ue(n.sizeTree,S)[1]-o+g,S===y&&(j+=l)):"center"===b?j+=(m+Ue(n.sizeTree,S)[1]-o+g)/2:j-=s,C&&(j+=C);const k=t=>{w(),t?(c("retrying to scroll to",{location:e},ze.DEBUG),ie(h,e)):(ie(f,!0),c("list did not change, scroll successful",{},ze.DEBUG))};if(w(),"smooth"===T){let e=!1;v=se(t,t=>{e=e||t}),p=ue(u,()=>{k(e)})}else p=ue(xe(t,function(e){return t=>{const n=setTimeout(()=>{t(!1)},e);return e=>{e&&(t(!0),clearTimeout(n))}}}(150)),k);return x=setTimeout(()=>{w()},1200),ie(a,!0),c("scrolling from index to",{behavior:T,index:S,top:j},ze.DEBUG),{behavior:T,top:j}})),c),{scrollTargetReached:f,scrollToIndex:h,topListHeight:g}},re(St,Pe,Be),{singleton:!0});function Et(e,t){0==e?t():requestAnimationFrame(()=>{Et(e-1,t)})}function Bt(e,t){const n=t-1;return"number"==typeof e?e:"LAST"===e.index?n:e.index}const Mt=je(([{defaultItemSize:e,listRefresh:t,sizes:n},{scrollTop:o},{scrollTargetReached:r,scrollToIndex:s},{didMount:i}])=>{const l=Te(!0),a=Te(0),c=Te(!0);return ce(xe(i,be(a),fe(([e,t])=>!!t),pe(!1)),l),ce(xe(i,be(a),fe(([e,t])=>!!t),pe(!1)),c),se(xe(Re(t,i),be(l,n,e,c),fe(([[,e],t,{sizeTree:n},o,r])=>e&&(!Ve(n)||ee(o))&&!t&&!r),be(a)),([,e])=>{ue(r,()=>{ie(c,!0)}),Et(4,()=>{ue(o,()=>{ie(l,!0)}),ie(s,e)})}),{initialItemFinalLocationReached:c,initialTopMostItemIndex:a,scrolledToInitialItem:l}},re(St,Pe,zt,Rt),{singleton:!0});function Lt(e,t){return Math.abs(e-t)<1.01}const At="up",Ot="down",Ft={atBottom:!1,notAtBottomBecause:"NOT_SHOWING_LAST_ITEM",state:{offsetBottom:0,scrollHeight:0,scrollTop:0,viewportHeight:0}},Pt=je(([{footerHeight:e,headerHeight:t,scrollBy:n,scrollContainerState:o,scrollTop:r,viewportHeight:s}])=>{const i=Te(!1),l=Te(!0),a=ye(),c=ye(),u=Te(4),d=Te(0),m=Ce(xe(He(xe(Ne(r),we(1),pe(!0)),xe(Ne(r),we(1),pe(!1),de(100))),he()),!1),h=Ce(xe(He(xe(n,pe(!0)),xe(n,pe(!1),de(200))),he()),!1);ce(xe(Re(Ne(r),Ne(d)),ge(([e,t])=>e<=t),he()),l),ce(xe(l,Ie(50)),c);const f=Se(xe(Re(o,Ne(s),Ne(t),Ne(e),Ne(u)),ve((e,[{scrollHeight:t,scrollTop:n},o,r,s,i])=>{const l={scrollHeight:t,scrollTop:n,viewportHeight:o};if(n+o-t>-i){let t,o;return n>e.state.scrollTop?(t="SCROLLED_DOWN",o=e.state.scrollTop-n):(t="SIZE_DECREASED",o=e.state.scrollTop-n||e.scrollTopDelta),{atBottom:!0,atBottomBecause:t,scrollTopDelta:o,state:l}}let a;return a=l.scrollHeight>e.state.scrollHeight?"SIZE_INCREASED":o<e.state.viewportHeight?"VIEWPORT_HEIGHT_DECREASING":n<e.state.scrollTop?"SCROLLING_UPWARDS":"NOT_FULLY_SCROLLED_TO_LAST_ITEM_BOTTOM",{atBottom:!1,notAtBottomBecause:a,state:l}},Ft),he((e,t)=>e&&e.atBottom===t.atBottom))),g=Ce(xe(o,ve((e,{scrollHeight:t,scrollTop:n,viewportHeight:o})=>{if(Lt(e.scrollHeight,t))return{changed:!1,jump:0,scrollHeight:t,scrollTop:n};{const r=t-(n+o)<1;return e.scrollTop!==n&&r?{changed:!0,jump:e.scrollTop-n,scrollHeight:t,scrollTop:n}:{changed:!0,jump:0,scrollHeight:t,scrollTop:n}}},{changed:!1,jump:0,scrollHeight:0,scrollTop:0}),fe(e=>e.changed),ge(e=>e.jump)),0);ce(xe(f,ge(e=>e.atBottom)),i),ce(xe(i,Ie(50)),a);const p=Te(Ot);ce(xe(o,ge(({scrollTop:e})=>e),he(),ve((e,t)=>ae(h)?{direction:e.direction,prevScrollTop:t}:{direction:t<e.prevScrollTop?At:Ot,prevScrollTop:t},{direction:Ot,prevScrollTop:0}),ge(e=>e.direction)),p),ce(xe(o,Ie(50),pe("none")),p);const x=Te(0);return ce(xe(m,fe(e=>!e),pe(0)),x),ce(xe(r,Ie(100),be(m),fe(([e,t])=>!!t),ve(([e,t],[n])=>[t,n],[0,0]),ge(([e,t])=>t-e)),x),{atBottomState:f,atBottomStateChange:a,atBottomThreshold:u,atTopStateChange:c,atTopThreshold:d,isAtBottom:i,isAtTop:l,isScrolling:m,lastJumpDueToItemResize:g,scrollDirection:p,scrollVelocity:x}},re(Pe)),Wt="top",Dt="bottom",Vt="none";function _t(e,t,n){return"number"==typeof e?n===At&&t===Wt||n===Ot&&t===Dt?e:0:n===At?t===Wt?e.main:e.reverse:t===Dt?e.main:e.reverse}function Ut(e,t){var n;return"number"==typeof e?e:null!=(n=e[t])?n:0}const Gt=je(([{deviation:e,fixedHeaderHeight:t,headerHeight:n,scrollTop:o,viewportHeight:r}])=>{const s=ye(),i=Te(0),l=Te(0),a=Te(0);return{increaseViewportBy:l,listBoundary:s,overscan:a,topListHeight:i,visibleRange:Ce(xe(Re(Ne(o),Ne(r),Ne(n),Ne(s,lt),Ne(a),Ne(i),Ne(t),Ne(e),Ne(l)),ge(([e,t,n,[o,r],s,i,l,a,c])=>{const u=e-a,d=i+l,m=Math.max(n-u,0);let h=Vt;const f=Ut(c,Wt),g=Ut(c,Dt);return o-=a,r+=n+l,(o+=n+l)>e+d-f&&(h=At),(r-=a)<e-m+t+g&&(h=Ot),h!==Vt?[Math.max(u-n-_t(s,Wt,h)-f,0),u-m-l+t+_t(s,Dt,h)+g]:null}),fe(e=>null!=e),he(lt)),[0,0])}},re(Pe),{singleton:!0});const $t={bottom:0,firstItemIndex:0,items:[],offsetBottom:0,offsetTop:0,top:0,topItems:[],topListHeight:0,totalCount:0};function Kt(e,t,n,o,r,s){const{lastIndex:i,lastOffset:l,lastSize:a}=r;let c=0,u=0;if(e.length>0){c=e[0].offset;const t=e[e.length-1];u=t.offset+t.size}const d=n-i,m=c,h=l+d*a+(d-1)*o-u;return{bottom:u,firstItemIndex:s,items:Yt(e,r,s),offsetBottom:h,offsetTop:c,top:m,topItems:Yt(t,r,s),topListHeight:t.reduce((e,t)=>t.size+e,0),totalCount:n}}function qt(e,t,n,o,r,s){let i=0;if(n.groupIndices.length>0)for(const c of n.groupIndices){if(c-i>=e)break;i++}const l=e+i,a=Bt(t,l);return Kt(Array.from({length:l}).map((e,t)=>({data:s[t+a],index:t+a,offset:0,size:0})),[],l,r,n,o)}function Yt(e,t,n){if(0===e.length)return[];if(!mt(t))return e.map(e=>({...e,index:e.index+n,originalIndex:e.index}));const o=e[0].index,r=e[e.length-1].index,s=[],i=Ke(t.groupOffsetTree,o,r);let l,a=0;for(const c of e){let e;(!l||l.end<c.index)&&(l=i.shift(),a=t.groupIndices.indexOf(l.start)),e=c.index===l.start?{index:a,type:"group"}:{groupIndex:a,index:c.index-(a+1)+n},s.push({...e,data:c.data,offset:c.offset,originalIndex:c.index,size:c.size})}return s}const Xt=je(([{data:e,firstItemIndex:t,gap:n,sizes:o,totalCount:r},s,{listBoundary:i,topListHeight:l,visibleRange:a},{initialTopMostItemIndex:c,scrolledToInitialItem:u},{topListHeight:d},m,{didMount:h},{recalcInProgress:f}])=>{const g=Te([]),p=Te(0),x=ye();ce(s.topItemsIndexes,g);const v=Ce(xe(Re(h,f,Ne(a,lt),Ne(r),Ne(o),Ne(c),u,Ne(g),Ne(t),Ne(n),e),fe(([e,t,,n,,,,,,,o])=>{const r=o&&o.length!==n;return e&&!t&&!r}),ge(([,,[e,t],n,o,r,s,i,l,a,c])=>{const u=o,{offsetTree:d,sizeTree:m}=u,h=ae(p);if(0===n)return{...$t,totalCount:n};if(0===e&&0===t)return 0===h?{...$t,totalCount:n}:qt(h,r,o,l,a,c||[]);if(Ve(m))return h>0?null:Kt(function(e,t,n){if(mt(t)){const o=pt(e,t);return[{index:Ue(t.groupOffsetTree,o)[0],offset:0,size:0},{data:null==n?void 0:n[0],index:o,offset:0,size:0}]}return[{data:null==n?void 0:n[0],index:e,offset:0,size:0}]}(Bt(r,n),u,c),[],n,a,u,l);const f=[];if(i.length>0){const e=i[0],t=i[i.length-1];let n=0;for(const o of Ke(m,e,t)){const r=o.value,s=Math.max(o.start,e),i=Math.min(o.end,t);for(let e=s;e<=i;e++)f.push({data:null==c?void 0:c[e],index:e,offset:n,size:r}),n+=r}}if(!s)return Kt([],f,n,a,u,l);const g=i.length>0?i[i.length-1]+1:0,x=vt(d,e,t,g);if(0===x.length)return null;const v=n-1;return Kt(ne([],n=>{for(const o of x){const r=o.value;let s=r.offset,i=o.start;const l=r.size;if(r.offset<e){i+=Math.floor((e-r.offset+a)/(l+a));const t=i-o.start;s+=t*l+t*a}i<g&&(s+=(g-i)*l,i=g);const u=Math.min(o.end,v);for(let e=i;e<=u&&!(s>=t);e++)n.push({data:null==c?void 0:c[e],index:e,offset:s,size:l}),s+=l+a}}),f,n,a,u,l)}),fe(e=>null!==e),he()),$t);ce(xe(e,fe(ee),ge(e=>null==e?void 0:e.length)),r),ce(xe(v,ge(e=>e.topListHeight)),d),ce(d,l),ce(xe(v,ge(e=>[e.top,e.bottom])),i),ce(xe(v,ge(e=>e.items)),x);const w=Se(xe(v,fe(({items:e})=>e.length>0),be(r,e),fe(([{items:e},t])=>e[e.length-1].originalIndex===t-1),ge(([,e,t])=>[e-1,t]),he(lt),ge(([e])=>e))),I=Se(xe(v,Ie(200),fe(({items:e,topItems:t})=>e.length>0&&e[0].originalIndex===t.length),ge(({items:e})=>e[0].index),he())),b=Se(xe(v,fe(({items:e})=>e.length>0),ge(({items:e})=>{let t=0,n=e.length-1;for(;"group"===e[t].type&&t<n;)t++;for(;"group"===e[n].type&&n>t;)n--;return{endIndex:e[n].index,startIndex:e[t].index}}),he(it)));return{endReached:w,initialItemCount:p,itemsRendered:x,listState:v,rangeChanged:b,startReached:I,topItemsIndexes:g,...m}},re(St,kt,Gt,Mt,zt,Pt,Rt,at),{singleton:!0}),Jt=je(([{fixedFooterHeight:e,fixedHeaderHeight:t,footerHeight:n,headerHeight:o},{listState:r}])=>{const s=ye(),i=Ce(xe(Re(n,e,o,t,r),ge(([e,t,n,o,r])=>e+t+n+o+r.offsetBottom+r.bottom)),0);return ce(Ne(i),s),{totalListHeight:i,totalListHeightChanged:s}},re(Pe,Xt),{singleton:!0}),Zt=je(([{viewportHeight:e},{totalListHeight:t}])=>{const n=Te(!1);return{alignToBottom:n,paddingTopAddition:Ce(xe(Re(n,e,t),fe(([e])=>e),ge(([,e,t])=>Math.max(0,e-t)),Ie(0),he()),0)}},re(Pe,Jt),{singleton:!0}),Qt=je(()=>({context:Te(null)})),en=({itemBottom:e,itemTop:t,locationParams:{align:n,behavior:o,...r},viewportBottom:s,viewportTop:i})=>t<i?{...r,align:null!=n?n:"start",behavior:o}:e>s?{...r,align:null!=n?n:"end",behavior:o}:null,tn=je(([{gap:e,sizes:t,totalCount:n},{fixedFooterHeight:o,fixedHeaderHeight:r,headerHeight:s,scrollingInProgress:i,scrollTop:l,viewportHeight:a},{scrollToIndex:c}])=>{const u=ye();return ce(xe(u,be(t,a,n,s,r,o,l),be(e),ge(([[e,t,n,o,r,s,l,a],c])=>{const{align:u,behavior:d,calculateViewLocation:m=en,done:h,...f}=e,g=xt(e,t,o-1),p=gt(g,t.offsetTree,c)+r+s,x=m({itemBottom:p+Ue(t.sizeTree,g)[1],itemTop:p,locationParams:{align:u,behavior:d,...f},viewportBottom:a+n-l,viewportTop:a+s});return x?h&&ue(xe(i,fe(e=>!e),we(ae(i)?1:2)),h):h&&h(),x}),fe(e=>null!==e)),c),{scrollIntoView:u}},re(St,Pe,zt,Xt,Be),{singleton:!0});function nn(e){return!!e&&("smooth"===e?"smooth":"auto")}const on=je(([{listRefresh:e,totalCount:t,fixedItemSize:n,data:o},{atBottomState:r,isAtBottom:s},{scrollToIndex:i},{scrolledToInitialItem:l},{didMount:a,propsReady:c},{log:u},{scrollingInProgress:d},{context:m},{scrollIntoView:h}])=>{const f=Te(!1),g=ye();let p=null;function x(e){ie(i,{align:"end",behavior:e,index:"LAST"})}function v(e){const t=ue(r,t=>{e&&!t.atBottom&&"SIZE_INCREASED"===t.notAtBottomBecause&&!p&&(ae(u)("scrolling to bottom due to increased size",{},ze.DEBUG),x("auto"))});setTimeout(t,100)}se(xe(Re(xe(Ne(t),we(1)),a),be(Ne(f),s,l,d),ge(([[e,t],n,o,r,s])=>{let i=t&&r,l="auto";return i&&(l=((e,t)=>"function"==typeof e?nn(e(t)):t&&nn(e))(n,o||s),i=i&&!!l),{followOutputBehavior:l,shouldFollow:i,totalCount:e}}),fe(({shouldFollow:e})=>e)),({followOutputBehavior:t,totalCount:o})=>{p&&(p(),p=null),ae(n)?requestAnimationFrame(()=>{ae(u)("following output to ",{totalCount:o},ze.DEBUG),x(t)}):p=ue(e,()=>{ae(u)("following output to ",{totalCount:o},ze.DEBUG),x(t),p=null})}),se(xe(Re(Ne(f),t,c),fe(([e,,t])=>e&&t),ve(({value:e},[,t])=>({refreshed:e===t,value:t}),{refreshed:!1,value:0}),fe(({refreshed:e})=>e),be(f,t)),([,e])=>{ae(l)&&v(!1!==e)}),se(g,()=>{v(!1!==ae(f))}),se(Re(Ne(f),r),([e,t])=>{e&&!t.atBottom&&"VIEWPORT_HEIGHT_DECREASING"===t.notAtBottomBecause&&x("auto")});const w=Te(null),I=ye();return ce(He(xe(Ne(o),ge(e=>{var t;return null!=(t=null==e?void 0:e.length)?t:0})),xe(Ne(t))),I),se(xe(Re(xe(I,we(1)),a),be(Ne(w),l,d,m),ge(([[e,t],n,o,r,s])=>t&&o&&(null==n?void 0:n({context:s,totalCount:e,scrollingInProgress:r}))),fe(e=>!!e),Ie(0)),t=>{p&&(p(),p=null),ae(n)?requestAnimationFrame(()=>{ae(u)("scrolling into view",{}),ie(h,t)}):p=ue(e,()=>{ae(u)("scrolling into view",{}),ie(h,t),p=null})}),{autoscrollToBottom:g,followOutput:f,scrollIntoViewOnChange:w}},re(St,Pt,zt,Mt,Rt,Be,Pe,Qt,tn)),rn=je(([{data:e,firstItemIndex:t,gap:n,sizes:o},{initialTopMostItemIndex:r},{initialItemCount:s,listState:i},{didMount:l}])=>(ce(xe(l,be(s),fe(([,e])=>0!==e),be(r,o,t,n,e),ge(([[,e],t,n,o,r,s=[]])=>qt(e,t,n,o,r,s))),i),{}),re(St,Mt,Xt,Rt),{singleton:!0}),sn=je(([{didMount:e},{scrollTo:t},{listState:n}])=>{const o=Te(0);return se(xe(e,be(o),fe(([,e])=>0!==e),ge(([,e])=>({top:e}))),e=>{ue(xe(n,we(1),fe(e=>e.items.length>1)),()=>{requestAnimationFrame(()=>{ie(t,e)})})}),{initialScrollTop:o}},re(Rt,Pe,Xt),{singleton:!0}),ln=je(([{scrollVelocity:e}])=>{const t=Te(!1),n=ye(),o=Te(!1);return ce(xe(e,be(o,t,n),fe(([e,t])=>!!t),ge(([e,t,n,o])=>{const{enter:r,exit:s}=t;if(n){if(s(e,o))return!1}else if(r(e,o))return!0;return n}),he()),t),se(xe(Re(t,e,n),be(o)),([[e,t,n],o])=>{e&&o&&o.change&&o.change(t,n)}),{isSeeking:t,scrollSeekConfiguration:o,scrollSeekRangeChanged:n,scrollVelocity:e}},re(Pt),{singleton:!0}),an=je(([{scrollContainerState:e,scrollTo:t}])=>{const n=ye(),o=ye(),r=ye(),s=Te(!1),i=Te(void 0);return ce(xe(Re(n,o),ge(([{scrollHeight:e,scrollTop:t,viewportHeight:n},{offsetTop:o}])=>({scrollHeight:e,scrollTop:Math.max(0,t-o),viewportHeight:n}))),e),ce(xe(t,be(o),ge(([e,{offsetTop:t}])=>({...e,top:e.top+t}))),r),{customScrollParent:i,useWindowScroll:s,windowScrollContainerState:n,windowScrollTo:r,windowViewportRect:o}},re(Pe)),cn=je(([{sizeRanges:e,sizes:t},{headerHeight:n,scrollTop:o},{initialTopMostItemIndex:r},{didMount:s},{useWindowScroll:i,windowScrollContainerState:l,windowViewportRect:a}])=>{const c=ye(),u=Te(void 0),d=Te(null),m=Te(null);return ce(l,d),ce(a,m),se(xe(c,be(t,o,i,d,m,n)),([e,t,n,o,r,s,i])=>{const l=function(e){return Ye(e).map(({k:e,v:t},n,o)=>{const r=o[n+1];return{endIndex:r?r.k-1:1/0,size:t,startIndex:e}})}(t.sizeTree);o&&null!==r&&null!==s&&(n=r.scrollTop-s.offsetTop),e({ranges:l,scrollTop:n-=i})}),ce(xe(u,fe(ee),ge(un)),r),ce(xe(s,be(u),fe(([,e])=>void 0!==e),he(),ge(([,e])=>e.ranges)),e),{getState:c,restoreStateFrom:u}},re(St,Pe,Mt,Rt,an));function un(e){return{align:"start",index:0,offset:e.scrollTop}}const dn=je(([{topItemsIndexes:e}])=>{const t=Te(0);return ce(xe(t,fe(e=>e>=0),ge(e=>Array.from({length:e}).map((e,t)=>t))),e),{topItemCount:t}},re(Xt));function mn(e){let t,n=!1;return()=>(n||(n=!0,t=e()),t)}const hn=mn(()=>/iP(ad|od|hone)/i.test(navigator.userAgent)&&/WebKit/i.test(navigator.userAgent)),fn=je(([{deviation:e,scrollBy:t,scrollingInProgress:n,scrollTop:o},{isAtBottom:r,isScrolling:s,lastJumpDueToItemResize:i,scrollDirection:l},{listState:a},{beforeUnshiftWith:c,gap:u,shiftWithOffset:d,sizes:m},{log:h},{recalcInProgress:f}])=>{const g=Se(xe(a,be(i),ve(([,e,t,n],[{bottom:o,items:r,offsetBottom:s,totalCount:i},l])=>{const a=o+s;let c=0;return t===i&&e.length>0&&r.length>0&&(0===r[0].originalIndex&&0===e[0].originalIndex||(c=a-n,0!==c&&(c+=l))),[c,r,i,a]},[0,[],0,0]),fe(([e])=>0!==e),be(o,l,n,r,h,f),fe(([,e,t,n,,,o])=>!o&&!n&&0!==e&&t===At),ge(([[e],,,,,t])=>(t("Upward scrolling compensation",{amount:e},ze.DEBUG),e))));function p(n){n>0?(ie(t,{behavior:"auto",top:-n}),ie(e,0)):(ie(e,0),ie(t,{behavior:"auto",top:-n}))}return se(xe(g,be(e,s)),([t,n,o])=>{o&&hn()?ie(e,n-t):p(-t)}),se(xe(Re(Ce(s,!1),e,f),fe(([e,t,n])=>!e&&!n&&0!==t),ge(([e,t])=>t),Ie(1)),p),ce(xe(d,ge(e=>({top:-e}))),t),se(xe(c,be(m,u),ge(([e,{groupIndices:t,lastSize:n,sizeTree:o},r])=>{function s(e){return e*(n+r)}if(0===t.length)return s(e);{let n=0;const r=_e(o,0);let i=0,l=0;for(;i<e;){i++,n+=r;let o=t.length===l+1?1/0:t[l+1]-t[l]-1;i+o>e&&(n-=r,o=e-i+1),i+=o,n+=s(o),l++}return n}})),n=>{ie(e,n),requestAnimationFrame(()=>{ie(t,{top:n}),requestAnimationFrame(()=>{ie(e,0),ie(f,!1)})})}),{deviation:e}},re(Pe,Pt,Xt,St,Be,at)),gn=je(([e,t,n,o,r,s,i,l,a,c,u])=>({...e,...t,...n,...o,...r,...s,...i,...l,...a,...c,...u}),re(Gt,rn,Rt,ln,Jt,sn,Zt,an,tn,Be,Qt)),pn=je(([{data:e,defaultItemSize:t,firstItemIndex:n,fixedItemSize:o,gap:r,groupIndices:s,itemSize:i,sizeRanges:l,sizes:a,statefulTotalCount:c,totalCount:u,trackItemSizes:d},{initialItemFinalLocationReached:m,initialTopMostItemIndex:h,scrolledToInitialItem:f},g,p,x,{listState:v,topItemsIndexes:w,...I},{scrollToIndex:b},T,{topItemCount:C},{groupCounts:y},S])=>(ce(I.rangeChanged,S.scrollSeekRangeChanged),ce(xe(S.windowViewportRect,ge(e=>e.visibleHeight)),g.viewportHeight),{data:e,defaultItemHeight:t,firstItemIndex:n,fixedItemHeight:o,gap:r,groupCounts:y,initialItemFinalLocationReached:m,initialTopMostItemIndex:h,scrolledToInitialItem:f,sizeRanges:l,topItemCount:C,topItemsIndexes:w,totalCount:u,...x,groupIndices:s,itemSize:i,listState:v,scrollToIndex:b,statefulTotalCount:c,trackItemSizes:d,...I,...S,...g,sizes:a,...p}),re(St,Mt,Pe,cn,on,Xt,zt,fn,dn,kt,gn));function xn(e,t){const n={},o={};let r=0;const s=e.length;for(;r<s;)o[e[r]]=1,r+=1;for(const i in t)Object.hasOwn(o,i)||(n[i]=t[i]);return n}const vn=typeof document<"u"?f.useLayoutEffect:f.useEffect;function wn(t,n,o){const r=Object.keys(n.required||{}),s=Object.keys(n.optional||{}),i=Object.keys(n.methods||{}),l=Object.keys(n.events||{}),a=f.createContext({});function c(e,t){e.propsReady&&ie(e.propsReady,!1);for(const o of r){ie(e[n.required[o]],t[o])}for(const o of s)if(o in t){ie(e[n.optional[o]],t[o])}e.propsReady&&ie(e.propsReady,!0)}function u(e){return l.reduce((t,o)=>(t[o]=function(e){let t,n;const o=()=>null==t?void 0:t();return function(r,s){switch(r){case 1:return s?n===s?void 0:(o(),n=s,t=se(e,s),t):(o(),te);case 2:return o(),void(n=null)}}}(e[n.events[o]]),t),{})}const d=f.forwardRef((d,m)=>{const{children:h,...g}=d,[p]=f.useState(()=>ne(function(e){const t=new Map,n=({constructor:e,dependencies:o,id:r,singleton:s})=>{if(s&&t.has(r))return t.get(r);const i=e(o.map(e=>n(e)));return s&&t.set(r,i),i};return n(e)}(t),e=>{c(e,g)})),[x]=f.useState(Q(u,p));vn(()=>{for(const e of l)e in g&&se(x[e],g[e]);return()=>{Object.values(x).map(le)}},[g,x,p]),vn(()=>{c(p,g)}),f.useImperativeHandle(m,X(function(e){return i.reduce((t,o)=>(t[o]=t=>{ie(e[n.methods[o]],t)},t),{})}(p)));const v=o;return e.jsx(a.Provider,{value:p,children:o?e.jsx(v,{...xn([...r,...s,...l],g),children:h}):h})});return{Component:d,useEmitter:(e,t)=>{const n=f.useContext(a)[e];vn(()=>se(n,t),[t,n])},useEmitterValue:f.version.startsWith("18")?e=>{const t=f.useContext(a)[e],n=f.useCallback(e=>se(t,e),[t]);return f.useSyncExternalStore(n,()=>ae(t),()=>ae(t))}:e=>{const t=f.useContext(a)[e],[n,o]=f.useState(Q(ae,t));return vn(()=>se(t,e=>{e!==n&&o(X(e))}),[t,n]),n},usePublisher:e=>{const t=f.useContext(a);return f.useCallback(n=>{ie(t[e],n)},[t,e])}}}const In=f.createContext(void 0),bn=f.createContext(void 0),Tn=typeof document<"u"?f.useLayoutEffect:f.useEffect;function Cn(e){return"self"in e}function yn(e,t,n,o=te,r,s){const i=f.useRef(null),l=f.useRef(null),a=f.useRef(null),c=f.useCallback(n=>{let o,r,i;const c=n.target;if(function(e){return"body"in e}(c)||Cn(c)){const e=Cn(c)?c:c.defaultView;i=s?e.scrollX:e.scrollY,o=s?e.document.documentElement.scrollWidth:e.document.documentElement.scrollHeight,r=s?e.innerWidth:e.innerHeight}else i=s?c.scrollLeft:c.scrollTop,o=s?c.scrollWidth:c.scrollHeight,r=s?c.offsetWidth:c.offsetHeight;const u=()=>{e({scrollHeight:o,scrollTop:Math.max(i,0),viewportHeight:r})};n.suppressFlushSync?u():g.flushSync(u),null!==l.current&&(i===l.current||i<=0||i===o-r)&&(l.current=null,t(!0),a.current&&(clearTimeout(a.current),a.current=null))},[e,t,s]);return f.useEffect(()=>{const e=r||i.current;return o(r||i.current),c({suppressFlushSync:!0,target:e}),e.addEventListener("scroll",c,{passive:!0}),()=>{o(null),e.removeEventListener("scroll",c)}},[i,c,n,o,r]),{scrollByCallback:function(e){s&&(e={behavior:e.behavior,left:e.top}),i.current.scrollBy(e)},scrollerRef:i,scrollToCallback:function(n){const o=i.current;if(!o||(s?"offsetWidth"in o&&0===o.offsetWidth:"offsetHeight"in o&&0===o.offsetHeight))return;const r="smooth"===n.behavior;let c,u,d;Cn(o)?(u=Math.max(dt(o.document.documentElement,s?"width":"height"),s?o.document.documentElement.scrollWidth:o.document.documentElement.scrollHeight),c=s?o.innerWidth:o.innerHeight,d=s?window.scrollX:window.scrollY):(u=o[s?"scrollWidth":"scrollHeight"],c=dt(o,s?"width":"height"),d=o[s?"scrollLeft":"scrollTop"]);const m=u-c;if(n.top=Math.ceil(Math.max(Math.min(m,n.top),0)),Lt(c,u)||n.top===d)return e({scrollHeight:u,scrollTop:d,viewportHeight:c}),void(r&&t(!0));r?(l.current=n.top,a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{a.current=null,l.current=null,t(!0)},1e3)):l.current=null,s&&(n={behavior:n.behavior,left:n.top}),o.scrollTo(n)}}}const Sn="-webkit-sticky",jn="sticky",kn=mn(()=>{if(typeof document>"u")return jn;const e=document.createElement("div");return e.style.position=Sn,e.style.position===Sn?Sn:jn});function Rn(e){return e}const Nn=je(([e,t])=>({...e,...t}),re(pn,je(()=>{const e=Te(e=>`Item ${e}`),t=Te(e=>`Group ${e}`),n=Te({}),o=Te(Rn),r=Te("div"),s=Te(te),i=(e,t=null)=>Ce(xe(n,ge(t=>t[e]),he()),t);return{components:n,computeItemKey:o,EmptyPlaceholder:i("EmptyPlaceholder"),FooterComponent:i("Footer"),GroupComponent:i("Group","div"),groupContent:t,HeaderComponent:i("Header"),HeaderFooterTag:r,ItemComponent:i("Item","div"),itemContent:e,ListComponent:i("List","div"),ScrollerComponent:i("Scroller","div"),scrollerRef:s,ScrollSeekPlaceholder:i("ScrollSeekPlaceholder"),TopItemListComponent:i("TopItemList")}}))),Hn=({height:t})=>e.jsx("div",{style:{height:t}}),zn={overflowAnchor:"none",position:kn(),zIndex:1},En={overflowAnchor:"none"},Bn={...En,display:"inline-block",height:"100%"},Mn=f.memo(function({showTopList:t=!1}){const n=Jn("listState"),o=Zn("sizeRanges"),r=Jn("useWindowScroll"),s=Jn("customScrollParent"),i=Zn("windowScrollContainerState"),l=Zn("scrollContainerState"),a=s||r?i:l,c=Jn("itemContent"),u=Jn("context"),d=Jn("groupContent"),m=Jn("trackItemSizes"),g=Jn("itemSize"),p=Jn("log"),x=Zn("gap"),v=Jn("horizontalDirection"),{callbackRef:w}=Ae(o,g,m,t?te:a,p,x,s,v,Jn("skipAnimationFrameInResizeObserver")),[I,b]=f.useState(0);Xn("deviation",e=>{I!==e&&b(e)});const T=Jn("EmptyPlaceholder"),C=Jn("ScrollSeekPlaceholder")||Hn,y=Jn("ListComponent"),S=Jn("ItemComponent"),j=Jn("GroupComponent"),k=Jn("computeItemKey"),R=Jn("isSeeking"),N=Jn("groupIndices").length>0,H=Jn("alignToBottom"),z=Jn("initialItemFinalLocationReached"),E=t?{}:{boxSizing:"border-box",...v?{display:"inline-block",height:"100%",marginLeft:0!==I?I:H?"auto":0,paddingLeft:n.offsetTop,paddingRight:n.offsetBottom,whiteSpace:"nowrap"}:{marginTop:0!==I?I:H?"auto":0,paddingBottom:n.offsetBottom,paddingTop:n.offsetTop},...z?{}:{visibility:"hidden"}};return!t&&0===n.totalCount&&T?e.jsx(T,{...Pn(T,u)}):e.jsx(y,{...Pn(y,u),"data-testid":t?"virtuoso-top-item-list":"virtuoso-item-list",ref:w,style:E,children:(t?n.topItems:n.items).map(e=>{const t=e.originalIndex,o=k(t+n.firstItemIndex,e.data,u);return R?h.createElement(C,{...Pn(C,u),height:e.size,index:e.index,key:o,type:e.type||"item",..."group"===e.type?{}:{groupIndex:e.groupIndex}}):"group"===e.type?h.createElement(j,{...Pn(j,u),"data-index":t,"data-item-index":e.index,"data-known-size":e.size,key:o,style:zn},d(e.index,u)):h.createElement(S,{...Pn(S,u),...Wn(S,e.data),"data-index":t,"data-item-group-index":e.groupIndex,"data-item-index":e.index,"data-known-size":e.size,key:o,style:v?Bn:En},N?c(e.index,e.groupIndex,e.data,u):c(e.index,e.data,u))})})}),Ln={height:"100%",outline:"none",overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},An={outline:"none",overflowX:"auto",position:"relative"},On=e=>({height:"100%",position:"absolute",top:0,width:"100%",...e?{display:"flex",flexDirection:"column"}:{}}),Fn={position:kn(),top:0,width:"100%",zIndex:1};function Pn(e,t){if("string"!=typeof e)return{context:t}}function Wn(e,t){return{item:"string"==typeof e?void 0:t}}const Dn=f.memo(function(){const t=Jn("HeaderComponent"),n=Zn("headerHeight"),o=Jn("HeaderFooterTag"),r=Me(f.useMemo(()=>e=>{n(dt(e,"height"))},[n]),!0,Jn("skipAnimationFrameInResizeObserver")),s=Jn("context");return t?e.jsx(o,{ref:r,children:e.jsx(t,{...Pn(t,s)})}):null}),Vn=f.memo(function(){const t=Jn("FooterComponent"),n=Zn("footerHeight"),o=Jn("HeaderFooterTag"),r=Me(f.useMemo(()=>e=>{n(dt(e,"height"))},[n]),!0,Jn("skipAnimationFrameInResizeObserver")),s=Jn("context");return t?e.jsx(o,{ref:r,children:e.jsx(t,{...Pn(t,s)})}):null});function _n({useEmitter:t,useEmitterValue:n,usePublisher:o}){return f.memo(function({children:r,style:s,...i}){const l=o("scrollContainerState"),a=n("ScrollerComponent"),c=o("smoothScrollTargetReached"),u=n("scrollerRef"),d=n("context"),m=n("horizontalDirection")||!1,{scrollByCallback:h,scrollerRef:f,scrollToCallback:g}=yn(l,c,a,u,void 0,m);return t("scrollTo",g),t("scrollBy",h),e.jsx(a,{"data-testid":"virtuoso-scroller","data-virtuoso-scroller":!0,ref:f,style:{...m?An:Ln,...s},tabIndex:0,...i,...Pn(a,d),children:r})})}function Un({useEmitter:t,useEmitterValue:n,usePublisher:o}){return f.memo(function({children:r,style:s,...i}){const l=o("windowScrollContainerState"),a=n("ScrollerComponent"),c=o("smoothScrollTargetReached"),u=n("totalListHeight"),d=n("deviation"),m=n("customScrollParent"),h=n("context"),g=f.useRef(null),p=n("scrollerRef"),{scrollByCallback:x,scrollerRef:v,scrollToCallback:w}=yn(l,c,a,p,m);return Tn(()=>{var e;return v.current=m||(null==(e=g.current)?void 0:e.ownerDocument.defaultView),()=>{v.current=null}},[v,m]),t("windowScrollTo",w),t("scrollBy",x),e.jsx(a,{ref:g,"data-virtuoso-scroller":!0,style:{position:"relative",...s,...0!==u?{height:u+d}:{}},...i,...Pn(a,h),children:r})})}const Gn=({children:t})=>{const n=f.useContext(In),o=Zn("viewportHeight"),r=Zn("fixedItemHeight"),s=Jn("alignToBottom"),i=Jn("horizontalDirection"),l=Me(f.useMemo(()=>Z(o,e=>dt(e,i?"width":"height")),[o,i]),!0,Jn("skipAnimationFrameInResizeObserver"));return f.useEffect(()=>{n&&(o(n.viewportHeight),r(n.itemHeight))},[n,o,r]),e.jsx("div",{"data-viewport-type":"element",ref:l,style:On(s),children:t})},$n=({children:t})=>{const n=f.useContext(In),o=Zn("windowViewportRect"),r=Zn("fixedItemHeight"),s=Jn("customScrollParent"),i=Fe(o,s,Jn("skipAnimationFrameInResizeObserver")),l=Jn("alignToBottom");return f.useEffect(()=>{n&&(r(n.itemHeight),o({offsetTop:0,visibleHeight:n.viewportHeight,visibleWidth:100}))},[n,o,r]),e.jsx("div",{"data-viewport-type":"window",ref:i,style:On(l),children:t})},Kn=({children:t})=>{const n=Jn("TopItemListComponent")||"div",o=Jn("headerHeight"),r={...Fn,marginTop:`${o}px`},s=Jn("context");return e.jsx(n,{style:r,...Pn(n,s),children:t})},qn=f.memo(function(t){const n=Jn("useWindowScroll"),o=Jn("topItemsIndexes").length>0,r=Jn("customScrollParent"),s=Jn("context"),i=r||n?eo:Qn,l=r||n?$n:Gn;return e.jsxs(i,{...t,...Pn(i,s),children:[o&&e.jsx(Kn,{children:e.jsx(Mn,{showTopList:!0})}),e.jsxs(l,{children:[e.jsx(Dn,{}),e.jsx(Mn,{}),e.jsx(Vn,{})]})]})}),{Component:Yn,useEmitter:Xn,useEmitterValue:Jn,usePublisher:Zn}=wn(Nn,{required:{},optional:{restoreStateFrom:"restoreStateFrom",context:"context",followOutput:"followOutput",scrollIntoViewOnChange:"scrollIntoViewOnChange",itemContent:"itemContent",groupContent:"groupContent",overscan:"overscan",increaseViewportBy:"increaseViewportBy",totalCount:"totalCount",groupCounts:"groupCounts",topItemCount:"topItemCount",firstItemIndex:"firstItemIndex",initialTopMostItemIndex:"initialTopMostItemIndex",components:"components",atBottomThreshold:"atBottomThreshold",atTopThreshold:"atTopThreshold",computeItemKey:"computeItemKey",defaultItemHeight:"defaultItemHeight",fixedItemHeight:"fixedItemHeight",itemSize:"itemSize",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"HeaderFooterTag",data:"data",initialItemCount:"initialItemCount",initialScrollTop:"initialScrollTop",alignToBottom:"alignToBottom",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",horizontalDirection:"horizontalDirection",skipAnimationFrameInResizeObserver:"skipAnimationFrameInResizeObserver"},methods:{scrollToIndex:"scrollToIndex",scrollIntoView:"scrollIntoView",scrollTo:"scrollTo",scrollBy:"scrollBy",autoscrollToBottom:"autoscrollToBottom",getState:"getState"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",totalListHeightChanged:"totalListHeightChanged",itemsRendered:"itemsRendered",groupIndices:"groupIndices"}},qn),Qn=_n({useEmitter:Xn,useEmitterValue:Jn,usePublisher:Zn}),eo=Un({useEmitter:Xn,useEmitterValue:Jn,usePublisher:Zn}),to=Yn;kn();const no={bottom:0,itemHeight:0,items:[],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},oo={bottom:0,itemHeight:0,items:[{index:0}],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},{ceil:ro,floor:so,max:io,min:lo,round:ao}=Math;function co(e,t,n){return Array.from({length:t-e+1}).map((t,o)=>({data:null===n?null:n[o+e],index:o+e}))}function uo(e,t){return e&&e.width===t.width&&e.height===t.height}function mo(e,t){return e&&e.column===t.column&&e.row===t.row}const ho=je(([{increaseViewportBy:e,listBoundary:t,overscan:n,visibleRange:o},{footerHeight:r,headerHeight:s,scrollBy:i,scrollContainerState:l,scrollTo:a,scrollTop:c,smoothScrollTargetReached:u,viewportHeight:d},m,h,{didMount:f,propsReady:g},{customScrollParent:p,useWindowScroll:x,windowScrollContainerState:v,windowScrollTo:w,windowViewportRect:I},b])=>{const T=Te(0),C=Te(0),y=Te(no),S=Te({height:0,width:0}),j=Te({height:0,width:0}),k=ye(),R=ye(),N=Te(0),H=Te(null),z=Te({column:0,row:0}),E=ye(),B=ye(),M=Te(!1),L=Te(0),A=Te(!0),O=Te(!1),F=Te(!1);se(xe(f,be(L),fe(([e,t])=>!!t)),()=>{ie(A,!1)}),se(xe(Re(f,A,j,S,L,O),fe(([e,t,n,o,,r])=>e&&!t&&0!==n.height&&0!==o.height&&!r)),([,,,,e])=>{ie(O,!0),Et(1,()=>{ie(k,e)}),ue(xe(c),()=>{ie(t,[0,0]),ie(A,!0)})}),ce(xe(B,fe(e=>null!=e&&e.scrollTop>0),pe(0)),C),se(xe(f,be(B),fe(([,e])=>null!=e)),([,e])=>{e&&(ie(S,e.viewport),ie(j,e.item),ie(z,e.gap),e.scrollTop>0&&(ie(M,!0),ue(xe(c,we(1)),e=>{ie(M,!1)}),ie(a,{top:e.scrollTop})))}),ce(xe(S,ge(({height:e})=>e)),d),ce(xe(Re(Ne(S,uo),Ne(j,uo),Ne(z,(e,t)=>e&&e.column===t.column&&e.row===t.row),Ne(c)),ge(([e,t,n,o])=>({gap:n,item:t,scrollTop:o,viewport:e}))),E),ce(xe(Re(Ne(T),o,Ne(z,mo),Ne(j,uo),Ne(S,uo),Ne(H),Ne(C),Ne(M),Ne(A),Ne(L)),fe(([,,,,,,,e])=>!e),ge(([e,[t,n],o,r,s,i,l,,a,c])=>{const{column:u,row:d}=o,{height:m,width:h}=r,{width:f}=s;if(0===l&&(0===e||0===f))return no;if(0===h){const t=Bt(c,e);return function(e){return{...oo,items:e}}(co(t,t+Math.max(l-1,0),i))}const g=fo(f,h,u);let p,x;a?0===t&&0===n&&l>0?(p=0,x=l-1):(p=g*so((t+d)/(m+d)),x=g*ro((n+d)/(m+d))-1,x=lo(e-1,io(x,g-1)),p=lo(x,io(0,p))):(p=0,x=-1);const v=co(p,x,i),{bottom:w,top:I}=go(s,o,r,v),b=ro(e/g);return{bottom:w,itemHeight:m,items:v,itemWidth:h,offsetBottom:b*m+(b-1)*d-w,offsetTop:I,top:I}})),y),ce(xe(H,fe(e=>null!==e),ge(e=>e.length)),T),ce(xe(Re(S,j,y,z),fe(([e,t,{items:n}])=>n.length>0&&0!==t.height&&0!==e.height),ge(([e,t,{items:n},o])=>{const{bottom:r,top:s}=go(e,o,t,n);return[s,r]}),he(lt)),t);const P=Te(!1);ce(xe(c,be(P),ge(([e,t])=>t||0!==e)),P);const W=Se(xe(Re(y,T),fe(([{items:e}])=>e.length>0),be(P),fe(([[e,t],n])=>{const o=e.items[e.items.length-1].index===t-1;return(n||e.bottom>0&&e.itemHeight>0&&0===e.offsetBottom&&e.items.length===t)&&o}),ge(([[,e]])=>e-1),he())),D=Se(xe(Ne(y),fe(({items:e})=>e.length>0&&0===e[0].index),pe(0),he())),V=Se(xe(Ne(y),be(M),fe(([{items:e},t])=>e.length>0&&!t),ge(([{items:e}])=>({endIndex:e[e.length-1].index,startIndex:e[0].index})),he(it),Ie(0)));ce(V,h.scrollSeekRangeChanged),ce(xe(k,be(S,j,T,z),ge(([e,t,n,o,r])=>{const s=Ht(e),{align:i,behavior:l,offset:a}=s;let c=s.index;"LAST"===c&&(c=o-1),c=io(0,c,lo(o-1,c));let u=po(t,r,n,c);return"end"===i?u=ao(u-t.height+n.height):"center"===i&&(u=ao(u-t.height/2+n.height/2)),a&&(u+=a),{behavior:l,top:u}})),a);const _=Ce(xe(y,ge(e=>e.offsetBottom+e.bottom)),0);return ce(xe(I,ge(e=>({height:e.visibleHeight,width:e.visibleWidth}))),S),{customScrollParent:p,data:H,deviation:N,footerHeight:r,gap:z,headerHeight:s,increaseViewportBy:e,initialItemCount:C,itemDimensions:j,overscan:n,restoreStateFrom:B,scrollBy:i,scrollContainerState:l,scrollHeight:R,scrollTo:a,scrollToIndex:k,scrollTop:c,smoothScrollTargetReached:u,totalCount:T,useWindowScroll:x,viewportDimensions:S,windowScrollContainerState:v,windowScrollTo:w,windowViewportRect:I,...h,gridState:y,horizontalDirection:F,initialTopMostItemIndex:L,totalListHeight:_,...m,endReached:W,propsReady:g,rangeChanged:V,startReached:D,stateChanged:E,stateRestoreInProgress:M,...b}},re(Gt,Pe,Pt,ln,Rt,an,Be));function fo(e,t,n){return io(1,so((e+n)/(so(t)+n)))}function go(e,t,n,o){const{height:r}=n;if(void 0===r||0===o.length)return{bottom:0,top:0};const s=po(e,t,n,o[0].index);return{bottom:po(e,t,n,o[o.length-1].index)+r,top:s}}function po(e,t,n,o){const r=fo(e.width,n.width,t.column),s=so(o/r),i=s*n.height+io(0,s-1)*t.row;return i>0?i+t.row:i}const xo=je(([e,t])=>({...e,...t}),re(ho,je(()=>{const e=Te(e=>`Item ${e}`),t=Te({}),n=Te(null),o=Te("virtuoso-grid-item"),r=Te("virtuoso-grid-list"),s=Te(Rn),i=Te("div"),l=Te(te),a=(e,n=null)=>Ce(xe(t,ge(t=>t[e]),he()),n),c=Te(!1),u=Te(!1);return ce(Ne(u),c),{components:t,computeItemKey:s,context:n,FooterComponent:a("Footer"),HeaderComponent:a("Header"),headerFooterTag:i,itemClassName:o,ItemComponent:a("Item","div"),itemContent:e,listClassName:r,ListComponent:a("List","div"),readyStateChanged:c,reportReadyState:u,ScrollerComponent:a("Scroller","div"),scrollerRef:l,ScrollSeekPlaceholder:a("ScrollSeekPlaceholder","div")}}))),vo=f.memo(function(){const t=jo("gridState"),n=jo("listClassName"),o=jo("itemClassName"),r=jo("itemContent"),s=jo("computeItemKey"),i=jo("isSeeking"),l=ko("scrollHeight"),a=jo("ItemComponent"),c=jo("ListComponent"),u=jo("ScrollSeekPlaceholder"),d=jo("context"),m=ko("itemDimensions"),g=ko("gap"),p=jo("log"),x=jo("stateRestoreInProgress"),v=ko("reportReadyState"),w=Me(f.useMemo(()=>e=>{const t=e.parentElement.parentElement.scrollHeight;l(t);const n=e.firstChild;if(n){const{height:e,width:t}=n.getBoundingClientRect();m({height:e,width:t})}g({column:Ho("column-gap",getComputedStyle(e).columnGap,p),row:Ho("row-gap",getComputedStyle(e).rowGap,p)})},[l,m,g,p]),!0,!1);return Tn(()=>{t.itemHeight>0&&t.itemWidth>0&&v(!0)},[t]),x?null:e.jsx(c,{className:n,ref:w,...Pn(c,d),"data-testid":"virtuoso-item-list",style:{paddingBottom:t.offsetBottom,paddingTop:t.offsetTop},children:t.items.map(n=>{const l=s(n.index,n.data,d);return i?e.jsx(u,{...Pn(u,d),height:t.itemHeight,index:n.index,width:t.itemWidth},l):h.createElement(a,{...Pn(a,d),className:o,"data-index":n.index,key:l},r(n.index,n.data,d))})})}),wo=f.memo(function(){const t=jo("HeaderComponent"),n=ko("headerHeight"),o=jo("headerFooterTag"),r=Me(f.useMemo(()=>e=>{n(dt(e,"height"))},[n]),!0,!1),s=jo("context");return t?e.jsx(o,{ref:r,children:e.jsx(t,{...Pn(t,s)})}):null}),Io=f.memo(function(){const t=jo("FooterComponent"),n=ko("footerHeight"),o=jo("headerFooterTag"),r=Me(f.useMemo(()=>e=>{n(dt(e,"height"))},[n]),!0,!1),s=jo("context");return t?e.jsx(o,{ref:r,children:e.jsx(t,{...Pn(t,s)})}):null}),bo=({children:t})=>{const n=f.useContext(bn),o=ko("itemDimensions"),r=ko("viewportDimensions"),s=Me(f.useMemo(()=>e=>{r(e.getBoundingClientRect())},[r]),!0,!1);return f.useEffect(()=>{n&&(r({height:n.viewportHeight,width:n.viewportWidth}),o({height:n.itemHeight,width:n.itemWidth}))},[n,r,o]),e.jsx("div",{ref:s,style:On(!1),children:t})},To=({children:t})=>{const n=f.useContext(bn),o=ko("windowViewportRect"),r=ko("itemDimensions"),s=jo("customScrollParent"),i=Fe(o,s,!1);return f.useEffect(()=>{n&&(r({height:n.itemHeight,width:n.itemWidth}),o({offsetTop:0,visibleHeight:n.viewportHeight,visibleWidth:n.viewportWidth}))},[n,o,r]),e.jsx("div",{ref:i,style:On(!1),children:t})},Co=f.memo(function({...t}){const n=jo("useWindowScroll"),o=jo("customScrollParent"),r=o||n?No:Ro,s=o||n?To:bo,i=jo("context");return e.jsx(r,{...t,...Pn(r,i),children:e.jsxs(s,{children:[e.jsx(wo,{}),e.jsx(vo,{}),e.jsx(Io,{})]})})}),{Component:yo,useEmitter:So,useEmitterValue:jo,usePublisher:ko}=wn(xo,{optional:{context:"context",totalCount:"totalCount",overscan:"overscan",itemContent:"itemContent",components:"components",computeItemKey:"computeItemKey",data:"data",initialItemCount:"initialItemCount",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"headerFooterTag",listClassName:"listClassName",itemClassName:"itemClassName",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",restoreStateFrom:"restoreStateFrom",initialTopMostItemIndex:"initialTopMostItemIndex",increaseViewportBy:"increaseViewportBy"},methods:{scrollTo:"scrollTo",scrollBy:"scrollBy",scrollToIndex:"scrollToIndex"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",stateChanged:"stateChanged",readyStateChanged:"readyStateChanged"}},Co),Ro=_n({useEmitter:So,useEmitterValue:jo,usePublisher:ko}),No=Un({useEmitter:So,useEmitterValue:jo,usePublisher:ko});function Ho(e,t,n){return"normal"!==t&&!(null!=t&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,ze.WARN),"normal"===t?0:parseInt(null!=t?t:"0",10)}function zo({isOwn:t=!1}){return e.jsx("div",{className:`flex ${t?"justify-end":"justify-start"} px-4 py-2`,children:e.jsx("div",{className:`max-w-[70%] ${t?"items-end":"items-start"} flex flex-col space-y-2`,children:e.jsxs("div",{className:(t?"bg-primary/20 animate-pulse":"bg-muted animate-pulse")+" rounded-lg p-3 space-y-2",children:[e.jsx("div",{className:"h-3 bg-muted-foreground/20 rounded animate-pulse w-24"}),e.jsx("div",{className:"h-4 bg-muted-foreground/20 rounded animate-pulse w-40"}),e.jsx("div",{className:"h-4 bg-muted-foreground/20 rounded animate-pulse w-32"})]})})})}function Eo({message:t}){return"parent"!==t.sender_type?null:t.sending?e.jsx(M,{className:"h-3 w-3 text-muted-foreground animate-pulse"}):t.failed?e.jsx(L,{className:"h-3 w-3 text-destructive"}):t.delivered?e.jsx(A,{className:"h-3 w-3 text-blue-500"}):e.jsx(O,{className:"h-3 w-3 text-muted-foreground"})}function Bo({message:o,currentUser:r,otherUser:s,hasActiveSearch:i,searchTerm:l,isCurrentResult:a,onRetryMessage:c}){const u="parent"===o.sender_type;return e.jsx("div",{className:`flex ${u?"justify-end":"justify-start"} px-4 py-2 group`,"data-message-id":o.id,children:e.jsxs("div",{className:`max-w-[85%] sm:max-w-[70%] flex ${u?"flex-row-reverse":"flex-row"} items-end space-x-2 ${u?"space-x-reverse":""}`,children:[!u&&e.jsxs(R,{className:"h-8 w-8 mb-1 flex-shrink-0",children:[e.jsx(N,{src:s?.avatar_url,alt:s?.name||"Other user"}),e.jsx(H,{className:"text-xs",children:s?.name?.charAt(0)||"A"})]}),e.jsx("div",{className:"flex flex-col space-y-1 flex-1 min-w-0",children:e.jsxs("div",{className:t("relative rounded-2xl px-4 py-2 transition-all duration-200 max-w-full",u?"bg-primary text-primary-foreground rounded-br-md":"bg-muted text-foreground rounded-bl-md",o.sending&&"opacity-70",o.failed&&"bg-destructive/10 border border-destructive/20"),children:[e.jsx("div",{className:"break-words whitespace-pre-wrap",children:i&&l?e.jsx(T,{text:o.content,searchTerm:l,isCurrentResult:a?.(o)||!1}):e.jsx("span",{children:o.content})}),o.attachments&&o.attachments.length>0&&e.jsx("div",{className:"mt-2 space-y-2",children:o.attachments.map((t,n)=>e.jsx(C,{attachments:[t]},n))}),e.jsxs("div",{className:t("flex items-center justify-between mt-1 text-xs opacity-70 space-x-2",u?"flex-row-reverse space-x-reverse":"flex-row"),children:[e.jsx("span",{className:"whitespace-nowrap",children:new Date(o.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx(Eo,{message:o})]}),o.failed&&u&&c&&e.jsxs(n,{variant:"ghost",size:"sm",className:"absolute -bottom-8 right-0 text-xs h-6 px-2 bg-background border shadow-sm",onClick:()=>c(o.id),"data-testid":`retry-message-${o.id}`,children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),"Retry"]})]})})]})})}function Mo({messages:o,currentUser:r,otherUser:s,loading:i=!1,hasActiveSearch:l=!1,searchTerm:a="",isCurrentResult:c,onRetryMessage:u,onLoadMore:d,hasMore:m=!1,className:f}){const g=h.useRef(null),[p,x]=h.useState(!0);h.useEffect(()=>{p&&g.current&&o.length>0&&g.current.scrollToIndex({index:o.length-1,behavior:"smooth"})},[o.length,p]);const v=h.useCallback(e=>{x(e)},[]),w=h.useCallback(t=>{const n=o[t];return n?e.jsx(Bo,{message:n,currentUser:r,otherUser:s,hasActiveSearch:l,searchTerm:a,isCurrentResult:c,onRetryMessage:u},n.id):e.jsx(zo,{},`skeleton-${t}`)},[o,r,s,l,a,c,u]);return i&&0===o.length?e.jsx("div",{className:t("flex-1 flex items-center justify-center",f),children:e.jsx(z,{className:"h-6 w-6 animate-spin text-muted-foreground","data-testid":"loading-messages"})}):i||0!==o.length?e.jsxs("div",{className:t("flex-1 flex flex-col relative",f),children:[e.jsx(to,{ref:g,data:o,totalCount:o.length,itemContent:w,followOutput:"smooth",atBottomStateChange:v,startReached:m&&!i?d:void 0,className:"scrollbar-thin scrollbar-thumb-muted scrollbar-track-transparent message-list-container","data-testid":"virtualized-message-list",style:{height:"100%"},components:{Header:m&&i?()=>e.jsxs("div",{className:"flex justify-center py-2","data-testid":"loading-more-messages",children:[e.jsx(z,{className:"h-4 w-4 animate-spin mr-2"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading more messages..."})]}):void 0}}),!p&&o.length>0&&e.jsx(n,{variant:"secondary",size:"sm",className:"absolute bottom-4 right-4 rounded-full shadow-lg z-10 h-11 w-11 p-0",onClick:()=>{g.current?.scrollToIndex({index:o.length-1,behavior:"smooth"}),x(!0)},"data-testid":"scroll-to-bottom-button",children:""})]}):e.jsx("div",{className:t("flex-1 flex items-center justify-center text-muted-foreground",f),"data-testid":"empty-messages",children:e.jsxs("div",{className:"text-center",children:[e.jsx(E,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Start a conversation"})]})})}function Lo({value:o,onChange:r,onSend:s,onAttachmentsChange:i,attachments:l,sending:a=!1,disabled:c=!1,placeholder:u="Type a message...",maxLength:d=2e3,showCharacterCount:m=!1,className:f,onKeyboardShow:g,onKeyboardHide:p,adjustForKeyboard:x=!0}){const v=h.useRef(null),w=h.useRef(null),[I,b]=h.useState(!1),[T,C]=h.useState(!1),[S,j]=h.useState(0),[k,R]=h.useState(44),N=h.useCallback(()=>{const e=v.current;if(!e)return;e.style.height="44px";const t=e.scrollHeight,n=Math.min(Math.max(t,44),144);e.style.height=`${n}px`,R(n)},[]);h.useEffect(()=>{N()},[o,N]),h.useEffect(()=>{if(!x||"undefined"==typeof window)return;let e,t,n=window.innerHeight;const o=()=>{const o=window.innerHeight,r=n-o;clearTimeout(e),clearTimeout(t),r>150?e=setTimeout(()=>{C(!0),j(r),g?.(),w.current&&setTimeout(()=>{w.current?.scrollIntoView({behavior:"smooth",block:"nearest"})},100)},100):t=setTimeout(()=>{C(!1),j(0),p?.()},100)},r=()=>{setTimeout(o,300)};if("visualViewport"in window&&window.visualViewport){const e=window.visualViewport;e.addEventListener("resize",o);const t=v.current;return t?.addEventListener("focus",r),()=>{e.removeEventListener("resize",o),t?.removeEventListener("focus",r)}}{window.addEventListener("resize",o);const e=v.current;return e?.addEventListener("focus",r),()=>{window.removeEventListener("resize",o),e?.removeEventListener("focus",r)}}},[x,g,p]);const H=h.useCallback(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),(o.trim()||l.some(e=>"completed"===e.status))&&s())},[o,l,s]),E=h.useCallback(()=>{c||a||(o.trim()||l.some(e=>"completed"===e.status))&&s()},[c,a,o,l,s]),B=h.useCallback(()=>{b(!I)},[I]),M=o.length,L=d-M,A=M>.8*d;return e.jsx($,{className:t("bg-background border-t",f),children:e.jsxs("div",{ref:w,className:t("transition-all duration-200 ease-out",T&&x&&"pb-2"),style:{transform:T&&x?`translateY(-${Math.min(S/4,50)}px)`:"none"},children:[I&&e.jsxs("div",{className:"border-b bg-muted/30 p-4 animate-in slide-in-from-bottom-2 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Attachments"}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>b(!1),className:"h-6 w-6 p-0","data-testid":"close-attachments",children:e.jsx(F,{className:"h-4 w-4"})})]}),e.jsx(y,{files:l,onFilesChange:i})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-end space-x-3",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:B,disabled:c,className:t("h-11 w-11 p-0 flex-shrink-0 transition-colors",I&&"bg-primary text-primary-foreground"),"data-testid":"attach-files-button",children:e.jsx(P,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{ref:v,value:o,onChange:e=>r(e.target.value),onKeyDown:H,placeholder:u,disabled:c,maxLength:d,className:t("w-full resize-none rounded-2xl px-4 py-3 pr-12","border border-input bg-background text-foreground","placeholder:text-muted-foreground","focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2","transition-all duration-200 ease-out","text-base",c&&"opacity-50 cursor-not-allowed"),style:{minHeight:44,height:k,lineHeight:"24px"},"data-testid":"message-textarea"}),m&&e.jsx("div",{className:t("absolute bottom-1 right-1 text-xs px-2 py-1 rounded","bg-background/80 backdrop-blur-sm",A&&L>=0&&"text-orange-500",L<0&&"text-destructive","transition-colors duration-200"),children:L<100&&`${L}`})]}),e.jsx(n,{onClick:E,disabled:c||a||!o.trim()&&!l.some(e=>"completed"===e.status),className:t("h-11 w-11 p-0 rounded-full flex-shrink-0","transition-all duration-200 ease-out","disabled:opacity-50 disabled:cursor-not-allowed"),"data-testid":"send-message-button",children:a?e.jsx(z,{className:"h-5 w-5 animate-spin"}):e.jsx(W,{className:"h-5 w-5"})})]}),l.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:l.map((o,r)=>e.jsxs("div",{className:t("flex items-center space-x-2 px-3 py-2 rounded-lg text-sm","bg-muted border transition-colors duration-200","completed"===o.status&&"bg-green-50 dark:bg-green-950 border-green-200 dark:border-green-800","error"===o.status&&"bg-red-50 dark:bg-red-950 border-red-200 dark:border-red-800"),children:[e.jsx(P,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate max-w-[120px]",children:o.file.name}),"uploading"===o.status&&e.jsx(z,{className:"h-3 w-3 animate-spin flex-shrink-0"}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>i(l.filter((e,t)=>t!==r)),className:"h-4 w-4 p-0 flex-shrink-0 hover:bg-transparent","data-testid":`remove-attachment-${r}`,children:e.jsx(F,{className:"h-3 w-3"})})]},r))})]})]})})}function Ao({onBack:a,showBackButton:c=!0,contactName:u,contactAvatar:d,contactStatus:m,lastSeen:h,unreadCount:f=0,isTyping:g=!1,onCall:p,onVideoCall:x,onSearch:v,onShowProfile:w,className:I}){return e.jsx(K,{className:t("bg-background border-b",I),children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 min-h-[56px]",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[c&&e.jsx(n,{variant:"ghost",size:"sm",onClick:a,className:"h-10 w-10 p-0 flex-shrink-0","data-testid":"back-button",children:e.jsx(D,{className:"h-5 w-5"})}),e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsxs(R,{className:"h-10 w-10",children:[e.jsx(N,{src:d,alt:u}),e.jsx(H,{className:"text-sm font-medium",children:u.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2)})]}),"online"===m&&e.jsx("div",{className:"absolute bottom-0 right-0 h-3 w-3 bg-green-500 border-2 border-background rounded-full"}),f>0&&e.jsx(Y,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 p-0 text-xs flex items-center justify-center",children:f>99?"99+":f})]}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:w,"data-testid":"contact-info",children:[e.jsx("h2",{className:"font-semibold text-foreground truncate text-base leading-tight",children:u}),(g||m||h)&&e.jsx("p",{className:t("text-sm truncate leading-tight",g?"text-primary":"online"===m?"text-green-500":"text-muted-foreground",g&&"animate-pulse"),children:g?"typing...":"online"===m?"online":h?`last seen ${new Date(h).toLocaleString()}`:""})]})]}),e.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[x&&e.jsx(n,{variant:"ghost",size:"sm",onClick:x,className:"h-10 w-10 p-0","data-testid":"video-call-button",children:e.jsx(V,{className:"h-5 w-5"})}),p&&e.jsx(n,{variant:"ghost",size:"sm",onClick:p,className:"h-10 w-10 p-0","data-testid":"voice-call-button",children:e.jsx(_,{className:"h-5 w-5"})}),v&&e.jsx(n,{variant:"ghost",size:"sm",onClick:v,className:"h-10 w-10 p-0","data-testid":"search-button",children:e.jsx(U,{className:"h-5 w-5"})}),e.jsxs(o,{children:[e.jsx(r,{asChild:!0,children:e.jsx(n,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0","data-testid":"more-options-button",children:e.jsx(G,{className:"h-5 w-5"})})}),e.jsxs(s,{align:"end",className:"w-48",children:[w&&e.jsxs(e.Fragment,{children:[e.jsx(i,{onClick:w,"data-testid":"view-profile",children:"View Profile"}),e.jsx(l,{})]}),e.jsx(i,{"data-testid":"mute-notifications",children:"Mute Notifications"}),e.jsx(i,{"data-testid":"clear-chat",children:"Clear Chat"}),e.jsx(l,{}),e.jsx(i,{"data-testid":"block-contact",className:"text-destructive",children:"Block Contact"})]})]})]})]})})}function Oo(){const[o,r]=h.useState(null),[s,i]=h.useState("conversations"),[l,f]=h.useState(""),[g,T]=h.useState(""),[C,y]=h.useState([]),[R,N]=h.useState(!1),[H,z]=h.useState(!1),{toast:B}=a(),{updateStatus:M}=S(),{conversations:L,loading:A,error:O,refetch:F}=v(),{markMessagesRead:P}=w(),{messages:W,loading:D,sendMessage:V,retryMessage:_,removeFailedMessage:G,getRetryInfo:$}=function(e){const t=I(),[n,o]=h.useState(new Map),[r,s]=h.useState(new Map),i=h.useRef(new Map),{messageHistory:l,loading:a,error:c,refetch:u}=p(e,!!e),d=h.useCallback(()=>`optimistic_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),m=h.useCallback(e=>{const t=1e3*Math.pow(2,e-1),n=1e3*Math.random();return Math.min(t+n,3e4)},[]),f=h.useMemo(()=>[...(l?.messages||[]).map(e=>{let t="advocate";return l?.conversation&&(e.sender_id===l.conversation.parent_id?t="parent":e.sender_id===l.conversation.advocate_id&&(t="advocate")),{...e,sender_type:t,sending:!1,failed:!1,delivered:!0}}),...Array.from(n.values())].sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()),[l,n]),g=b({mutationFn:async e=>{const t={conversation_id:e.conversationId};return e.content&&(t.content=e.content),e.attachments&&e.attachments.length>0&&(t.attachments=e.attachments),x(t)},onSuccess:(e,n,r)=>{const l=r?.optimisticId;if(l){o(e=>{const t=new Map(e);return t.delete(l),t}),s(e=>{const t=new Map(e);return t.delete(l),t});const e=i.current.get(l);e&&(clearTimeout(e),i.current.delete(l))}t.invalidateQueries({queryKey:["/api/messaging/conversations"]}),t.invalidateQueries({queryKey:["/api/messaging/conversations",n.conversationId]})},onError:(e,t,n)=>{const r=n?.optimisticId;r&&(o(e=>{const t=new Map(e),n=t.get(r);return n&&t.set(r,{...n,sending:!1,failed:!0,delivered:!1}),t}),s(e=>{const t=new Map(e),n=(t.get(r)||{attempts:0,nextRetryAt:0,exponentialDelay:1e3}).attempts+1;if(n<=3){const e=m(n);t.set(r,{attempts:n,nextRetryAt:Date.now()+e,exponentialDelay:e});const o=setTimeout(()=>{w(r)},e);i.current.set(r,o)}return t})),console.error("Failed to send message:",e)}}),v=h.useCallback(async(e,t,n)=>{if(!e)return null;const r=d(),s=(new Date).toISOString(),i={id:r,content:t||"",sender_type:"parent",created_at:s,attachments:n||[],sending:!0,failed:!1,delivered:!1};o(e=>new Map(e).set(r,i));try{return await g.mutateAsync({conversationId:e,content:t,attachments:n}),i}catch(l){return console.error("Send message error:",l),null}},[d,g]),w=h.useCallback(async t=>{const s=n.get(t),l=r.get(t);if(!s||!e||l&&l.attempts>=3)return;const a=i.current.get(t);a&&(clearTimeout(a),i.current.delete(t)),o(e=>{const n=new Map(e),o=n.get(t);return o&&n.set(t,{...o,sending:!0,failed:!1}),n});try{await g.mutateAsync({conversationId:e,content:s.content,attachments:s.attachments})}catch(c){console.error("Retry failed:",c)}},[n,r,e,g]),T=h.useCallback(e=>{o(t=>{const n=new Map(t);return n.delete(e),n}),s(t=>{const n=new Map(t);return n.delete(e),n});const t=i.current.get(e);t&&(clearTimeout(t),i.current.delete(e))},[]),C=h.useCallback(e=>{const t=r.get(e);if(!t)return null;const n=Date.now(),o=Math.max(0,t.nextRetryAt-n);return{attempts:t.attempts,maxAttempts:3,canRetry:t.attempts<3,timeUntilAutoRetry:o,nextRetryAt:t.nextRetryAt}},[r]);return h.useState(()=>()=>{i.current.forEach(e=>clearTimeout(e)),i.current.clear()}),{messages:f,loading:a&&0===f.length,error:c,refetch:u,sendMessage:v,retryMessage:w,removeFailedMessage:T,getRetryInfo:C,sending:g.isPending}}(o?.id||null),{searchTerm:K,setSearchTerm:Y,currentResultIndex:X,totalResults:J,goToNext:Z,goToPrevious:Q,clearSearch:ee,isCurrentResult:te,hasActiveSearch:ne,hasResults:oe}=j(W||[]),re=h.useMemo(()=>l.trim()?L.filter(e=>e.advocate?.name?.toLowerCase().includes(l.toLowerCase())||e.subject?.toLowerCase().includes(l.toLowerCase())||e.last_message?.content?.toLowerCase().includes(l.toLowerCase())):L,[L,l]);h.useEffect(()=>{L.length>0&&!o&&r(L[0])},[L,o]);const se=h.useCallback(async e=>{if(r(e),i("chat"),e.unread_count>0)try{await P(e.id),F()}catch(t){console.error("Error marking messages as read:",t)}},[P,F]),ie=h.useCallback(async()=>{if(!o)return;const e=g.trim(),t=C.some(e=>"completed"===e.status);if(!e&&!t)return;const n=C.filter(e=>"completed"===e.status).map(async e=>{const t=new FileReader,n=await new Promise(n=>{t.onload=()=>n(t.result),t.readAsDataURL(e.file)});return{file_name:e.file.name,file_type:e.file.type,file_size:e.file.size,file_content:n}});try{const e=await Promise.all(n);await V(o.id,g.trim()||void 0,e.length>0?e:void 0),T(""),y([]),F()}catch(r){console.error("Error sending message:",r),B({title:"Failed to send message",description:"Your message couldn't be sent. Please try again.",variant:"destructive"})}},[o,g,C,V,F,B]),le=h.useCallback(async e=>{try{await _(e),B({title:"Message retry attempted",description:"Trying to send your message again..."})}catch(t){B({title:"Retry failed",description:"Unable to retry sending the message.",variant:"destructive"})}},[_,B]),ae=h.useCallback(()=>{N(!0)},[]),ce=h.useCallback(()=>{N(!1)},[]),ue=h.useCallback(()=>{"chat"===s&&(i("conversations"),r(null))},[s]),de={id:"current-parent",name:"You"},me=o?.advocate?{id:o.advocate.id,name:o.advocate.name,avatar_url:o.advocate.avatar_url}:void 0;return e.jsx(c,{children:e.jsxs("div",{className:"h-[calc(100vh-8rem)]",children:[e.jsx("div",{className:"lg:hidden h-full",children:"conversations"===s?e.jsxs(u,{className:"h-full flex flex-col",children:[e.jsx("div",{className:"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsxs(q,{className:"px-4 py-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-xl font-semibold",children:"Messages"})}),e.jsxs("div",{className:"relative mt-3",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(d,{placeholder:"Search conversations...",className:"pl-10",value:l,onChange:e=>f(e.target.value),"data-testid":"search-conversations"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx(m,{conversations:re,loading:A,onOpenConversation:se,onArchive:async e=>{try{await M(e.id,{archived:!e.archived}),F()}catch(t){console.error("Error archiving conversation:",t)}},onMarkUrgent:async e=>{try{await M(e.id,{priority:"urgent"}),F()}catch(t){console.error("Error marking conversation urgent:",t)}}}),!A&&O&&e.jsxs("div",{className:"p-4 text-center text-destructive",children:["Error loading conversations: ",O]})]})]}):e.jsxs("div",{className:"h-full flex flex-col bg-background",children:[o&&e.jsx(Ao,{onBack:ue,contactName:o.advocate?.name||"Unknown Advocate",contactAvatar:o.advocate?.avatar_url,contactStatus:"online",unreadCount:o.unread_count,onSearch:()=>z(!H)}),H&&e.jsx("div",{className:"border-b bg-muted/30 p-4",children:e.jsx(k,{searchTerm:K,onSearchChange:Y,currentResultIndex:X,totalResults:J,onNext:Z,onPrevious:Q,onClear:()=>{ee(),z(!1)},hasActiveSearch:ne,hasResults:oe})}),e.jsx("div",{className:t("flex-1 min-h-0 message-list-container",R&&"pb-4"),children:o?e.jsx(Mo,{messages:W||[],currentUser:de,otherUser:me,loading:D,hasActiveSearch:ne,searchTerm:K,isCurrentResult:te,onRetryMessage:le,className:"h-full"}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(E,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Select a conversation to start messaging"})]})})}),o&&e.jsx(Lo,{value:g,onChange:T,onSend:ie,onAttachmentsChange:y,attachments:C,placeholder:`Message ${o.advocate?.name||"advocate"}...`,maxLength:2e3,showCharacterCount:g.length>1600,onKeyboardShow:ae,onKeyboardHide:ce,adjustForKeyboard:!0})]})}),e.jsxs("div",{className:"hidden lg:grid lg:grid-cols-3 gap-6 h-full",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(u,{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Messages"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(d,{placeholder:"Search conversations...",className:"pl-10",value:l,onChange:e=>f(e.target.value),"data-testid":"search-conversations-desktop"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx(m,{conversations:re,loading:A,onOpenConversation:se,onArchive:async e=>{try{await M(e.id,{archived:!e.archived}),F()}catch(t){console.error("Error archiving conversation:",t)}},onMarkUrgent:async e=>{try{await M(e.id,{priority:"urgent"}),F()}catch(t){console.error("Error marking conversation urgent:",t)}}}),!A&&O&&e.jsxs("div",{className:"p-4 text-center text-destructive",children:["Error loading conversations: ",O]})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(u,{className:"h-full flex flex-col",children:[o&&e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h3",{className:"font-semibold",children:o.advocate?.name||"Unknown Advocate"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o.subject})]})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>z(!H),"data-testid":"toggle-search-desktop",children:e.jsx(U,{className:"h-4 w-4"})})})]})}),H&&e.jsx("div",{className:"p-4 border-b bg-muted/30",children:e.jsx(k,{searchTerm:K,onSearchChange:Y,currentResultIndex:X,totalResults:J,onNext:Z,onPrevious:Q,onClear:()=>{ee(),z(!1)},hasActiveSearch:ne,hasResults:oe})}),e.jsx("div",{className:"flex-1 min-h-0 message-list-container",children:o?e.jsx(Mo,{messages:W||[],currentUser:de,otherUser:me,loading:D,hasActiveSearch:ne,searchTerm:K,isCurrentResult:te,onRetryMessage:le,className:"h-full"}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(E,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Select a conversation to start messaging"})]})})}),o&&e.jsx(Lo,{value:g,onChange:T,onSend:ie,onAttachmentsChange:y,attachments:C,placeholder:`Message ${o.advocate?.name||"advocate"}...`,maxLength:2e3,showCharacterCount:g.length>1600,adjustForKeyboard:!1})]})})]})]})})}export{Oo as default};
