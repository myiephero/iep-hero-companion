import{j as e}from"./chunk-DsWtD-um.js";import{d as s,r as t}from"./chunk--CdJ9rTh.js";import{a,u as i,D as r,B as n,C as l,d,e as c,h as o,L as h,I as u}from"../assets/index-BuUqvl4a.js";import{S as m,a as x,b as j,c as p,d as v}from"./chunk-CqIUznKi.js";import{T as g}from"./chunk-CKRZgYDG.js";import{a1 as f,ao as y}from"./chunk-CIO6T0Sb.js";import"./chunk-DiCKXT8z.js";function _(){const _=s(),{toast:N}=a(),{user:S}=i(),[q,w]=t.useState(!1),[b,C]=t.useState([]),[P,k]=t.useState({title:"",meeting_type:"",requested_date:"",preferred_time:"",meeting_format:"",advocate_id:"",notes:"",priority:"normal"});t.useEffect(()=>{(async()=>{try{const e=localStorage.getItem("authToken"),s=await fetch("/api/advocate-clients",{credentials:"include",headers:{Authorization:e?`Bearer ${e}`:""}});if(s.ok){const e=await s.json();C(e||[])}}catch(e){console.error("Error fetching advocates:",e)}})()},[]);const M=(e,s)=>{k(t=>({...t,[e]:s}))};return e.jsx(r,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>_("/parent/schedule"),"data-testid":"button-back",children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Back to Schedule"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Request Meeting"}),e.jsx("p",{className:"text-muted-foreground",children:"Request a meeting with your advocate"})]})]}),e.jsx("div",{className:"max-w-2xl",children:e.jsxs(l,{children:[e.jsx(d,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"Meeting Request Details"]})}),e.jsx(o,{children:e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),w(!0);try{const e=localStorage.getItem("authToken"),s=await fetch("/api/meeting-requests",{method:"POST",headers:{"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:""},credentials:"include",body:JSON.stringify({...P,status:"pending",requested_by:S?.id})});if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to send meeting request")}N({title:"Meeting Request Sent",description:"Your advocate will review your request and respond soon."}),_("/parent/schedule")}catch(s){console.error("Error requesting meeting:",s),N({title:"Request Failed",description:s.message||"Failed to send meeting request. Please try again.",variant:"destructive"})}finally{w(!1)}},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"title",children:"Meeting Subject"}),e.jsx(u,{id:"title",value:P.title,onChange:e=>M("title",e.target.value),placeholder:"e.g., Discuss IEP goals for next semester",required:!0,"data-testid":"input-title"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"meeting_type",children:"Meeting Type"}),e.jsxs(m,{value:P.meeting_type,onValueChange:e=>M("meeting_type",e),children:[e.jsx(x,{"data-testid":"select-meeting-type",children:e.jsx(j,{placeholder:"Select type"})}),e.jsxs(p,{children:[e.jsx(v,{value:"iep_review",children:"IEP Review"}),e.jsx(v,{value:"consultation",children:"General Consultation"}),e.jsx(v,{value:"504_meeting",children:"504 Plan Meeting"}),e.jsx(v,{value:"progress_review",children:"Progress Review"}),e.jsx(v,{value:"urgent_concern",children:"Urgent Concern"}),e.jsx(v,{value:"advocacy_support",children:"Advocacy Support"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"priority",children:"Priority"}),e.jsxs(m,{value:P.priority,onValueChange:e=>M("priority",e),children:[e.jsx(x,{"data-testid":"select-priority",children:e.jsx(j,{placeholder:"Select priority"})}),e.jsxs(p,{children:[e.jsx(v,{value:"low",children:"Low - Routine discussion"}),e.jsx(v,{value:"normal",children:"Normal - Standard meeting"}),e.jsx(v,{value:"high",children:"High - Important issue"}),e.jsx(v,{value:"urgent",children:"Urgent - Immediate attention needed"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"requested_date",children:"Preferred Date"}),e.jsx(u,{id:"requested_date",type:"date",value:P.requested_date,onChange:e=>M("requested_date",e.target.value),required:!0,"data-testid":"input-date"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"preferred_time",children:"Preferred Time"}),e.jsxs(m,{value:P.preferred_time,onValueChange:e=>M("preferred_time",e),children:[e.jsx(x,{"data-testid":"select-time",children:e.jsx(j,{placeholder:"Select time"})}),e.jsxs(p,{children:[e.jsx(v,{value:"morning",children:"Morning (9 AM - 12 PM)"}),e.jsx(v,{value:"afternoon",children:"Afternoon (12 PM - 5 PM)"}),e.jsx(v,{value:"evening",children:"Evening (5 PM - 8 PM)"}),e.jsx(v,{value:"flexible",children:"Flexible - Any time"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"meeting_format",children:"Meeting Format"}),e.jsxs(m,{value:P.meeting_format,onValueChange:e=>M("meeting_format",e),children:[e.jsx(x,{"data-testid":"select-format",children:e.jsx(j,{placeholder:"Select format"})}),e.jsxs(p,{children:[e.jsx(v,{value:"video_call",children:"Video Call (Zoom/Teams)"}),e.jsx(v,{value:"phone_call",children:"Phone Call"}),e.jsx(v,{value:"in_person",children:"In Person"}),e.jsx(v,{value:"school_meeting",children:"At School"})]})]})]}),b.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"advocate_id",children:"Select Advocate"}),e.jsxs(m,{value:P.advocate_id,onValueChange:e=>M("advocate_id",e),children:[e.jsx(x,{"data-testid":"select-advocate",children:e.jsx(j,{placeholder:"Select your advocate"})}),e.jsx(p,{children:b.map(s=>e.jsx(v,{value:s.advocate_id,children:s.advocate_name||`Advocate ${s.advocate_id}`},s.advocate_id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"notes",children:"Additional Details"}),e.jsx(g,{id:"notes",value:P.notes,onChange:e=>M("notes",e.target.value),placeholder:"Describe what you'd like to discuss, any concerns, questions, or specific topics...",rows:4,"data-testid":"textarea-notes"})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx(n,{type:"submit",disabled:q,className:"flex-1","data-testid":"button-request",children:q?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-primary-foreground border-t-transparent rounded-full"}),"Sending Request..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),"Send Meeting Request"]})}),e.jsx(n,{type:"button",variant:"outline",onClick:()=>_("/parent/schedule"),"data-testid":"button-cancel",children:"Cancel"})]})]})})]})})]})})}export{_ as default};
