import{j as e}from"./chunk-DsWtD-um.js";import{d as s,r as t}from"./chunk--CdJ9rTh.js";import{a,C as r,h as o,i as l,B as i,d as n,e as c,f as d,L as m,I as x}from"../assets/index-BuUqvl4a.js";import{N as h,a2 as u,b as p,E as g,x as b,y}from"./chunk-CIO6T0Sb.js";import"./chunk-DiCKXT8z.js";function j(){const j=s(),{toast:N}=a(),[f,v]=t.useState(null),[w,P]=t.useState(""),[k,S]=t.useState(""),[C,I]=t.useState(!1),[E,L]=t.useState(!1),[T,U]=t.useState(!1);t.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("token");e?v(e):(N({title:"Invalid Link",description:"The password setup link is invalid or missing.",variant:"destructive"}),j("/m/auth"))},[j,N]);const H={length:(M=w).length>=8,hasNumber:/\d/.test(M),hasUpper:/[A-Z]/.test(M),hasLower:/[a-z]/.test(M)};var M;const O=Object.values(H).every(Boolean),$=w===k&&w.length>0;return f?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 via-blue-50 to-cyan-50 p-4",children:e.jsxs(r,{className:"w-full max-w-lg border-0 shadow-2xl bg-white/95 backdrop-blur",children:[e.jsxs(n,{className:"text-center pb-6",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("img",{src:l,alt:"My IEP Hero",className:"h-20 w-auto transition-transform hover:scale-105"})}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-600 via-cyan-500 to-blue-700 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(u,{className:"h-10 w-10 text-white"})}),e.jsx("div",{className:"absolute -top-1 -right-1",children:e.jsx(p,{className:"h-6 w-6 text-yellow-400 animate-pulse"})})]})}),e.jsx(c,{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent",children:"Set Up Your Password"}),e.jsx(d,{className:"text-lg text-gray-600 mt-2",children:"Create a secure password to access your My IEP Hero account"}),e.jsx("div",{className:"mt-4 px-4 py-2 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-full",children:e.jsx("p",{className:"text-sm font-medium text-blue-700",children:"LOYAL â€¢ HONEST â€¢ HEROIC"})})]}),e.jsxs(o,{className:"px-8 pb-8",children:[e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),f)if(O)if($){U(!0);try{const e=await fetch("/api/setup-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:f,password:w})}),s=await e.json();e.ok?(localStorage.setItem("authToken",s.token),N({title:"Welcome to My IEP Hero! ðŸŽ‰",description:"Your account is ready! Taking you to your dashboard..."}),setTimeout(()=>{j(s.redirectTo||"/parent/dashboard-free")},1500)):N({title:"Setup Failed",description:s.error||"Failed to set up password. Please try again.",variant:"destructive"})}catch(s){console.error("Password setup error:",s),N({title:"Connection Error",description:"Unable to connect to server. Please check your connection and try again.",variant:"destructive"})}finally{U(!1)}}else N({title:"Password Mismatch",description:"Passwords do not match.",variant:"destructive"});else N({title:"Password Requirements",description:"Please ensure your password meets all requirements.",variant:"destructive"});else N({title:"Error",description:"Invalid setup token.",variant:"destructive"})},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{htmlFor:"password",className:"text-base font-semibold text-gray-700",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{id:"password",type:C?"text":"password",value:w,onChange:e=>P(e.target.value),placeholder:"Create a strong password",className:"pr-12 h-12 text-lg border-2 border-gray-200 focus:border-blue-500 transition-colors","data-testid":"input-password"}),e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-12 px-4 hover:bg-gray-100",onClick:()=>I(!C),"data-testid":"button-toggle-password",children:C?e.jsx(g,{className:"h-5 w-5 text-gray-500"}):e.jsx(b,{className:"h-5 w-5 text-gray-500"})})]}),w&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Password Requirements:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`flex items-center gap-2 ${H.length?"text-green-600":"text-gray-500"} transition-colors`,children:[e.jsx(y,{className:"h-4 w-4 "+(H.length?"text-green-600":"text-gray-300")}),e.jsx("span",{className:"text-sm",children:"8+ characters"})]}),e.jsxs("div",{className:`flex items-center gap-2 ${H.hasUpper?"text-green-600":"text-gray-500"} transition-colors`,children:[e.jsx(y,{className:"h-4 w-4 "+(H.hasUpper?"text-green-600":"text-gray-300")}),e.jsx("span",{className:"text-sm",children:"Uppercase"})]}),e.jsxs("div",{className:`flex items-center gap-2 ${H.hasLower?"text-green-600":"text-gray-500"} transition-colors`,children:[e.jsx(y,{className:"h-4 w-4 "+(H.hasLower?"text-green-600":"text-gray-300")}),e.jsx("span",{className:"text-sm",children:"Lowercase"})]}),e.jsxs("div",{className:`flex items-center gap-2 ${H.hasNumber?"text-green-600":"text-gray-500"} transition-colors`,children:[e.jsx(y,{className:"h-4 w-4 "+(H.hasNumber?"text-green-600":"text-gray-300")}),e.jsx("span",{className:"text-sm",children:"Number"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{htmlFor:"confirmPassword",className:"text-base font-semibold text-gray-700",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{id:"confirmPassword",type:E?"text":"password",value:k,onChange:e=>S(e.target.value),placeholder:"Confirm your password",className:"pr-12 h-12 text-lg border-2 border-gray-200 focus:border-blue-500 transition-colors","data-testid":"input-confirm-password"}),e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-12 px-4 hover:bg-gray-100",onClick:()=>L(!E),"data-testid":"button-toggle-confirm-password",children:E?e.jsx(g,{className:"h-5 w-5 text-gray-500"}):e.jsx(b,{className:"h-5 w-5 text-gray-500"})})]}),k&&e.jsxs("div",{className:`text-sm font-medium flex items-center gap-2 ${$?"text-green-600":"text-red-500"} transition-colors`,children:[e.jsx(y,{className:"h-4 w-4 "+($?"text-green-600":"text-red-500")}),$?"Passwords match perfectly!":"Passwords do not match"]})]}),e.jsx(i,{type:"submit",className:"w-full h-14 text-lg font-semibold transition-all duration-200 "+(O&&$&&!T?"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 hover:scale-[1.02] shadow-lg hover:shadow-xl":"bg-gray-400 cursor-not-allowed"),disabled:!O||!$||T,"data-testid":"button-setup-password",children:T?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/20 border-t-white rounded-full animate-spin"}),"Setting up your account..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5"}),"Create My Account"]})})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-cyan-50 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-gray-600 leading-relaxed",children:[e.jsx("strong",{children:"ðŸ”’ Secure & Private:"})," Your information is encrypted and protected. After setup, you'll be automatically signed in to your personalized dashboard."]})})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Need help? Contact your advocate or email"," ",e.jsx("a",{href:"mailto:support@myiephero.com",className:"text-blue-600 hover:text-blue-700 font-medium",children:"support@myiephero.com"})]})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 via-blue-50 to-cyan-50 p-4",children:e.jsx(r,{className:"w-full max-w-lg border-0 shadow-2xl bg-white/95 backdrop-blur",children:e.jsxs(o,{className:"p-8 text-center",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("img",{src:l,alt:"My IEP Hero",className:"h-16 w-auto"})}),e.jsx(h,{className:"h-16 w-16 text-red-500 mx-auto mb-6"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Invalid Setup Link"}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:"The password setup link is invalid or has expired. Please contact your advocate for a new invitation."}),e.jsx(i,{onClick:()=>j("/m/auth"),className:"mt-6 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700",children:"Go to Sign In"})]})})})}export{j as default};
