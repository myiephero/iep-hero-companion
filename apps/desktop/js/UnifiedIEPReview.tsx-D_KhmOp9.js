import{j as e}from"./chunk-DsWtD-um.js";import{r as s}from"./chunk--CdJ9rTh.js";import{a,D as t,C as n,d as i,e as r,f as l,h as c,B as o,r as d,t as m,v as h,w as x,x as u,L as p,I as g}from"../assets/index-DmH44GAo.js";import{B as j}from"./chunk-0mWKUDnJ.js";import{P as f}from"./chunk-Cc1_LcYd.js";import{S as y,a as v,b,c as N,d as w}from"./chunk-CeW2BF6N.js";import{D as k}from"./chunk-Dsf71OSs.js";import{D as S,a as C,b as A,c as I,d as $}from"./chunk-CFc3a_Ag.js";import{T as D}from"./chunk-B148CZfy.js";import{C as E}from"./chunk-Da-FqAZc.js";import{a as P}from"./chunk-C-MbUUvx.js";import{a8 as _,X as L,aV as T,ad as M,aN as z,B as O,av as R,M as q,aW as F,C as G,au as J,f as U,ab as B,w as V}from"./chunk-CIO6T0Sb.js";import"./chunk-DiCKXT8z.js";import"./chunk--P05M-BP.js";import"./chunk-Csgv8Z6q.js";import"./chunk-CSUAnfQx.js";import"./chunk-CBR39ci4.js";const Q=[{value:"iep_quality",label:"IEP Quality Review",description:"Comprehensive quality analysis with scoring"},{value:"compliance_check",label:"Compliance Analysis",description:"Check IDEA compliance and requirements"},{value:"accommodation",label:"Accommodation Analysis",description:"Review accommodation effectiveness"},{value:"meeting_prep",label:"Meeting Preparation",description:"Prepare for IEP meetings"},{value:"goal_analysis",label:"Goal Analysis",description:"Analyze IEP goals and progress"}];function K(){const[K,W]=s.useState([]),[Y,Z]=s.useState(""),[X,H]=s.useState("iep_quality"),[ee,se]=s.useState(!1),[ae,te]=s.useState({}),[ne,ie]=s.useState(""),[re,le]=s.useState([]),[ce,oe]=s.useState(new Set),[de,me]=s.useState(!1),[he,xe]=s.useState(null),[ue,pe]=s.useState([]),[ge,je]=s.useState(!1),[fe,ye]=s.useState("analyze"),[ve,be]=s.useState(""),{toast:Ne}=a(),we=e=>e.documentName?e.documentName:e.parsedAnalysis?.document_title?e.parsedAnalysis.document_title:e.parsedAnalysis?.title?e.parsedAnalysis.title:"Document Review";s.useEffect(()=>{ke()},[]);const ke=async()=>{try{const e=await P.getStudents();if(le(e),Y){const s=e.find(e=>e.id===Y);s&&ie(s.full_name)}}catch(e){console.error("Error fetching students:",e)}},Se=(e,s,a)=>{const t="string"==typeof e.content?e.content:JSON.stringify(e.content),n=(e=>{const s=e.toLowerCase().includes("strong")||e.toLowerCase().includes("excellent"),a=e.toLowerCase().includes("concern")||e.toLowerCase().includes("issue"),t=s?85:a?70:80,n=10*Math.random()-5;return{overall:Math.max(60,Math.min(95,Math.round(t+n))),goal_quality:Math.max(60,Math.min(95,Math.round(t+n-2))),service_alignment:Math.max(60,Math.min(95,Math.round(t+n+3))),compliance:Math.max(60,Math.min(95,Math.round(t+n+1)))}})(t),i=(e=>{const s=[];return e.toLowerCase().includes("concern")&&s.push({where:"Goal Section",notes:"Some goals may need refinement for specificity",type:"moderate"}),(e.toLowerCase().includes("missing")||e.toLowerCase().includes("lacking"))&&s.push({where:"Service Provision",notes:"Service alignment could be improved",type:"minor"}),s})(t),r=(e=>{const s=[{title:"Enhance Goal Specificity",suggestion:"Consider making goals more specific and measurable"},{title:"Service Alignment",suggestion:"Ensure services directly support stated goals"}];return e.toLowerCase().includes("progress")&&s.push({title:"Progress Monitoring",suggestion:"Implement more frequent progress monitoring for key goals"}),s})(t),l={id:`unified-${Date.now()}-${Math.random()}`,documentId:s,studentId:Y,reviewType:X,analysis:e.content,parsedAnalysis:e.parsedAnalysis,scores:n,flags:i,recommendations:r,timestamp:(new Date).toISOString(),documentName:a};W(e=>[l,...e]),ye("results"),Ne({title:"Analysis Complete",description:`${Q.find(e=>e.value===X)?.label} completed successfully.`})},Ce=async e=>{try{se(!0);const s={documentTitle:we(e),reviewType:e.reviewType,timestamp:e.timestamp,studentId:e.studentId,scores:e.scores,flags:e.flags,recommendations:e.recommendations,analysis:e.parsedAnalysis||{summary:"string"==typeof e.analysis?e.analysis:JSON.stringify(e.analysis),recommendations:e.recommendations||[],areas_of_concern:e.flags||[],strengths:[],action_items:[]},rawAnalysis:e.analysis},a={title:`${Q.find(s=>s.value===e.reviewType)?.label} - ${we(e)}`,description:`Unified IEP analysis completed on ${new Date(e.timestamp).toLocaleDateString()} (Score: ${e.scores?.overall}/100)`,file_name:`${we(e).replace(/[^a-zA-Z0-9]/g,"")}.json`,file_path:`vault/unified-iep-reviews/${e.id}.json`,file_type:"application/json",file_size:JSON.stringify(s).length,category:"IEP Analysis",tags:["iep-analysis",e.reviewType,"unified-review"],student_id:e.studentId};a.content=JSON.stringify(s),await P.createDocument(a),Ne({title:"Saved to Vault",description:"Analysis saved successfully to document vault."}),W(s=>s.filter(s=>s.id!==e.id))}catch(s){console.error("Error saving to vault:",s),Ne({title:"Save Failed",description:"Failed to save analysis to vault. Please try again.",variant:"destructive"})}finally{se(!1)}},Ae=(s,a,t,n,i)=>{if(!t||Array.isArray(t)&&0===t.length)return null;const r=i,l=(c=s.id,ae[`${c}-${a}`]||!1);var c;return e.jsxs("div",{className:`border rounded-lg overflow-hidden ${n}`,children:[e.jsxs("button",{onClick:()=>((e,s)=>{const a=`${e}-${s}`;te(e=>({...e,[a]:!e[a]}))})(s.id,a),className:"w-full p-4 text-left flex items-center justify-between hover:bg-opacity-80 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(r,{className:"h-5 w-5"}),e.jsx("h4",{className:"font-semibold",children:a})]}),l?e.jsx(R,{className:"h-4 w-4"}):e.jsx(J,{className:"h-4 w-4"})]}),!l&&e.jsx("div",{className:"p-4 pt-0",children:Array.isArray(t)?e.jsx("ul",{className:"space-y-2",children:t.map((s,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-sm opacity-70",children:"•"}),e.jsx("span",{className:"text-sm",children:"object"==typeof s?s.title||s.suggestion||s.notes||JSON.stringify(s):s})]},a))}):e.jsx("p",{className:"text-sm",children:"string"==typeof t?t:JSON.stringify(t)})})]})};return e.jsx(t,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(n,{children:[e.jsxs(i,{children:[e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Upload & Analyze IEP Document"]}),e.jsx(l,{children:"Upload your IEP document for comprehensive AI-powered analysis with quality scoring and recommendations"})]}),e.jsx(c,{className:"space-y-4",children:e.jsx(k,{onAnalysisComplete:e=>{e.documentId&&e.documentName&&Se(e,e.documentId,e.documentName)}})})]}),K.length>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(j,{variant:"secondary",className:"text-sm font-medium",children:[K.length," Analysis Result",1!==K.length?"s":""]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(o,{variant:"outline",size:"sm",onClick:()=>me(!de),className:"flex items-center gap-2",children:de?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4"}),"Cancel"]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4"}),"Select Multiple"]})})})]}),de&&ce.size>0&&e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:[ce.size," of ",K.length," selected"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{onClick:async()=>{const e=K.filter(e=>ce.has(e.id));for(const s of e)await Ce(s);oe(new Set),me(!1)},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white",size:"sm",children:[e.jsx(M,{className:"h-4 w-4"}),"Save to Vault (",ce.size,")"]}),e.jsxs(o,{onClick:()=>{K.filter(e=>ce.has(e.id)).forEach(e=>{const s=JSON.stringify(e,null,2),a="data:application/json;charset=utf-8,"+encodeURIComponent(s),t=`iep-review-${we(e)}-${(new Date).toISOString().split("T")[0]}.json`,n=document.createElement("a");n.setAttribute("href",a),n.setAttribute("download",t),n.click()})},variant:"outline",className:"flex items-center gap-2",size:"sm",children:[e.jsx(z,{className:"h-4 w-4"}),"Download (",ce.size,")"]})]})]}),e.jsx("div",{className:"space-y-6",children:0===K.length?e.jsx(n,{className:"border-dashed",children:e.jsxs(c,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(O,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Ready to Analyze"}),e.jsx("p",{className:"text-muted-foreground text-center max-w-md",children:"Upload an IEP document above to get started with AI-powered analysis and recommendations."})]})}):e.jsx("div",{className:"space-y-6",children:K.map(s=>e.jsx(n,{className:"border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900",children:e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[de&&e.jsx(E,{checked:ce.has(s.id),onCheckedChange:e=>{oe(e?e=>new Set([...e,s.id]):e=>{const a=new Set(e);return a.delete(s.id),a})}}),e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(O,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:we(s)}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[new Date(s.timestamp).toLocaleDateString()," • ",Q.find(e=>e.value===s.reviewType)?.label,s.scores&&e.jsxs("span",{className:"ml-2 font-medium",children:["• Score: ",s.scores.overall,"/100"]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(d,{children:[e.jsx(m,{asChild:!0,children:e.jsxs(o,{className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white",size:"sm",disabled:ee,children:[e.jsx(M,{className:"h-4 w-4"}),"Actions",e.jsx(R,{className:"h-3 w-3"})]})}),e.jsxs(h,{align:"end",className:"w-48",children:[e.jsxs(x,{onClick:()=>Ce(s),className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Save to Vault"]}),e.jsxs(x,{onClick:()=>{xe(s),be(""),je(!0)},className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Create Letter"]}),e.jsx(u,{}),e.jsxs(x,{onClick:()=>{const e=JSON.stringify(s,null,2),a="data:application/json;charset=utf-8,"+encodeURIComponent(e),t=`iep-review-${we(s)}-${(new Date).toISOString().split("T")[0]}.json`,n=document.createElement("a");n.setAttribute("href",a),n.setAttribute("download",t),n.click()},className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Export Analysis"]}),e.jsxs(x,{onClick:()=>{navigator.clipboard.writeText(JSON.stringify(s,null,2)),Ne({title:"Copied to Clipboard",description:"Review data copied to clipboard."})},className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4"}),"Copy to Clipboard"]})]})]})})]}),s.scores&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Quality Scores"]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-4",children:Object.entries(s.scores).map(([s,a])=>{return"overall"!==s&&e.jsx("div",{children:(t=s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),l=a,o=`${s} assessment score`,e.jsxs(n,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(r,{className:"text-sm font-medium",children:t})}),e.jsxs(c,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(f,{value:l,className:"h-2"})}),e.jsx("div",{className:"text-2xl font-bold",children:l})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:o})]})]}))},s);var t,l,o})}),e.jsx(n,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950/30 dark:to-indigo-950/30",children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400 mb-2",children:[s.scores.overall,"/100"]}),e.jsx("div",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-2",children:"Overall Score"}),e.jsx(f,{value:s.scores.overall,className:"h-3"})]})})})]}),e.jsxs("div",{className:"space-y-4",children:[s.parsedAnalysis&&Ae(s,"Summary",s.parsedAnalysis.summary,"bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800 text-blue-900 dark:text-blue-100",U),s.recommendations&&Ae(s,"Recommendations",s.recommendations,"bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-800 text-green-900 dark:text-green-100",B),s.flags&&Ae(s,"Areas of Concern",s.flags,"bg-yellow-50 dark:bg-yellow-950/30 border-yellow-200 dark:border-yellow-800 text-yellow-900 dark:text-yellow-100",V)]})]})},s.id))})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Action Plans & Letters"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Generated advocacy letters and action plans based on IEP reviews"})]}),e.jsxs(j,{variant:"secondary",className:"text-sm font-medium",children:[ue.length," Draft",1!==ue.length?"s":""]})]}),e.jsx("div",{className:"space-y-4",children:0===ue.length?e.jsx(n,{className:"border-dashed",children:e.jsxs(c,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(q,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Action Plans Yet"}),e.jsx("p",{className:"text-muted-foreground text-center max-w-md",children:'Generate advocacy letters from your IEP reviews using the "Create Letter" button in the results tab.'})]})}):ue.map(s=>e.jsxs(n,{children:[e.jsx(i,{children:e.jsxs(r,{className:"flex items-center justify-between",children:[e.jsx("span",{children:s.title}),e.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()})]})}),e.jsxs(c,{children:[e.jsx("div",{className:"prose max-w-none",children:e.jsx("pre",{className:"whitespace-pre-wrap text-sm",children:s.body})}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(o,{onClick:()=>{navigator.clipboard.writeText(s.body),Ne({title:"Copied to Clipboard",description:"Draft copied to clipboard for editing."})},variant:"outline",size:"sm",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Copy to Clipboard"]}),e.jsxs(o,{onClick:()=>{const e=s.body,a="data:text/plain;charset=utf-8,"+encodeURIComponent(e),t=`${s.title.replace(/[^a-zA-Z0-9]/g,"_")}.txt`,n=document.createElement("a");n.setAttribute("href",a),n.setAttribute("download",t),n.click()},variant:"outline",size:"sm",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Download"]})]})]})]},s.id))})]}),e.jsx(S,{open:ge,onOpenChange:je,children:e.jsxs(C,{className:"max-w-2xl",children:[e.jsxs(A,{children:[e.jsx(I,{children:"Generate Action Letter"}),e.jsxs($,{children:["Create an advocacy letter based on the IEP review findings for ",he?we(he):"this document","."]})]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault();const s=new FormData(e.target),a={parentName:s.get("parentName"),templateType:s.get("templateType"),additionalConcerns:s.get("additionalConcerns")};(async(e,s)=>{if(he)try{const a=`${e.charAt(0).toUpperCase()+e.slice(1)} Letter - ${we(he)}`,t=`Dear IEP Team,\n\nI am writing regarding the recent IEP review for ${ne||"my child"}. Based on the comprehensive analysis completed on ${new Date(he.timestamp).toLocaleDateString()}, I would like to address the following areas:\n\n## Key Findings:\n- Overall IEP Quality Score: ${he.scores?.overall}/100\n- Goal Quality: ${he.scores?.goal_quality}/100  \n- Service Alignment: ${he.scores?.service_alignment}/100\n- Compliance Rating: ${he.scores?.compliance}/100\n\n## Recommendations for Improvement:\n${he.recommendations?.map(e=>`• ${e.title}: ${e.suggestion}`).join("\n")||"No specific recommendations at this time."}\n\n## Areas of Concern:\n${he.flags?.map(e=>`• ${e.where}: ${e.notes}`).join("\n")||"No major concerns identified."}\n\nI look forward to working together to ensure ${ne||"my child"} receives the best possible educational support.\n\nThank you for your attention to these matters.\n\nSincerely,\n${s.parentName||"[Parent Name]"}`,n={id:`draft-${Date.now()}`,title:a,body:t,created_at:(new Date).toISOString()};pe([n,...ue]),je(!1),Ne({title:"Action Draft Generated",description:"Letter draft created successfully."})}catch(a){Ne({title:"Draft Generation Failed",description:a.message,variant:"destructive"})}})(a.templateType,a)},className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"parentName",children:"Your Name"}),e.jsx(g,{id:"parentName",name:"parentName",placeholder:"Enter your full name",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"templateType",children:"Letter Type"}),e.jsxs(y,{name:"templateType",value:ve,onValueChange:be,required:!0,children:[e.jsx(v,{children:e.jsx(b,{placeholder:"Select letter type"})}),e.jsxs(N,{children:[e.jsx(w,{value:"concern",children:"Request for IEP Meeting"}),e.jsx(w,{value:"followup",children:"Follow-up on Concerns"}),e.jsx(w,{value:"compliance",children:"Compliance Issue"}),e.jsx(w,{value:"services",children:"Service Request"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"additionalConcerns",children:"Additional Concerns (Optional)"}),e.jsx(D,{id:"additionalConcerns",name:"additionalConcerns",placeholder:"Any additional concerns or requests...",rows:3})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(o,{variant:"outline",type:"button",onClick:()=>je(!1),children:"Cancel"}),e.jsx(o,{type:"submit",children:"Generate Letter"})]})]})]})})]})})}export{K as default};
