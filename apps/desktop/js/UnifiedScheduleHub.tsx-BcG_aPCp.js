import{j as e}from"./chunk-DsWtD-um.js";import{d as s,u as t,r as a}from"./chunk--CdJ9rTh.js";import{a as i,u as n,D as l,B as r,L as d,I as c,C as o,d as m,e as u,h,f as x}from"../assets/index-DmH44GAo.js";import{B as j}from"./chunk-0mWKUDnJ.js";import{T as p}from"./chunk-B148CZfy.js";import{S as g,a as f,b as v,c as N,d as y}from"./chunk-CeW2BF6N.js";import{D as w,e as b,a as _,b as S,c as k,d as C}from"./chunk-CFc3a_Ag.js";import{a as q}from"./chunk-C-MbUUvx.js";import{ac as M,aa as T,f as I,Y as F,aI as R,aO as P,z as E,ao as D,U as $,aP as z,T as A,aQ as L}from"./chunk-CIO6T0Sb.js";import"./chunk-DiCKXT8z.js";function O(){const O=s(),B=t(),{toast:U}=i(),{user:Q,profile:V}=n(),Y="advocate"===V?.role,[G,H]=a.useState([]),[J,K]=a.useState([]),[W,X]=a.useState(!0),[Z,ee]=a.useState(!1),[se,te]=a.useState(!1),[ae,ie]=a.useState(null),[ne,le]=a.useState({title:"",meeting_type:"",scheduled_date:"",start_time:"",end_time:"",location:"",notes:"",priority:"normal"});a.useEffect(()=>{if(B.state?.newItem){const e={id:`timeline-${Date.now()}`,title:B.state.newItem.title,date:B.state.newItem.dates[0]?.date||"",priority:"urgent"===B.state.newItem.dates[0]?.type?"high":"medium",type:B.state.newItem.type||"meeting",student_id:B.state.newItem.student_id||"default",imported_from_timeline:!0};K(s=>[e,...s]),U({title:"Timeline Added",description:"Timeline deadline has been added to your schedule."}),window.history.replaceState({},document.title)}},[B.state,U]),a.useEffect(()=>{"schedule-meeting"===new URLSearchParams(B.search).get("action")&&(ee(!0),U({title:"Letter Sent Successfully",description:"Now let's schedule a meeting to discuss your letter."}))},[B.search,U]),a.useEffect(()=>{(async()=>{try{const[e,s]=await Promise.all([q.getMeetings(),fetch("/api/timeline-deadlines",{credentials:"include",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}).then(e=>e.ok?e.json():[]).catch(()=>[])]);H(e||[]),B.state?.newItem||K(s||[])}catch(e){console.error("Error fetching schedule data:",e),U({title:"Error",description:"Failed to load schedule data. Please try again.",variant:"destructive"})}finally{X(!1)}})()},[U,B.state]);const re=(new Date).toISOString().split("T")[0],de=G.filter(e=>e.scheduled_date>=re&&("scheduled"===e.status||"confirmed"===e.status)),ce=J.filter(e=>e.date>=re),oe=e=>{switch(e){case"confirmed":return"default";case"scheduled":default:return"secondary";case"pending":return"outline"}},me=e=>{switch(e){case"high":return"destructive";case"medium":return"default";default:return"secondary"}},ue=e=>{ie(e),ee(!1),"quick"===e?te(!0):O("/parent/tools/smart-letter-generator?type=meeting-request")},he=(e,s)=>{le(t=>({...t,[e]:s}))};return e.jsx(l,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Schedule Hub"}),e.jsx("p",{className:"text-muted-foreground",children:Y?"Manage your meetings and client appointments":"View your meetings, deadlines, and request new meetings"})]}),e.jsxs(w,{open:Z,onOpenChange:ee,children:[e.jsx(b,{asChild:!0,children:e.jsxs(r,{"data-testid":"button-new-meeting",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),Y?"Schedule Meeting":"Request Meeting"]})}),e.jsxs(_,{className:"max-w-md",children:[e.jsxs(S,{children:[e.jsx(k,{children:"How would you like to proceed?"}),e.jsx(C,{children:"Choose the best approach for your meeting request"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(r,{variant:"outline",className:"w-full h-auto p-4 flex flex-col items-start",onClick:()=>ue("quick"),"data-testid":"button-quick-schedule",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:"Quick Schedule"})]}),e.jsx("span",{className:"text-sm text-muted-foreground text-left",children:"Fast scheduling for routine meetings and consultations"})]}),!Y&&e.jsxs(r,{variant:"outline",className:"w-full h-auto p-4 flex flex-col items-start",onClick:()=>ue("formal"),"data-testid":"button-formal-request",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:"Formal Request Letter"})]}),e.jsx("span",{className:"text-sm text-muted-foreground text-left",children:"Generate a professional letter for formal IEP meetings"})]})]})]})]})]}),e.jsx(w,{open:se,onOpenChange:te,children:e.jsxs(_,{className:"max-w-2xl",children:[e.jsxs(S,{children:[e.jsx(k,{children:Y?"Schedule New Meeting":"Request Meeting"}),e.jsx(C,{children:Y?"Schedule a meeting with your client":"Request a meeting with your advocate"})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{const e=Y?"/api/meetings":"/api/meeting-requests",s=localStorage.getItem("authToken"),t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:s?`Bearer ${s}`:""},credentials:"include",body:JSON.stringify({...ne,status:Y?"scheduled":"pending",requested_by:Q?.id,client_id:Y?ne.notes:void 0})});if(!t.ok){const e=await t.json();throw new Error(e.error||"Failed to process request")}U({title:Y?"Meeting Scheduled":"Meeting Request Sent",description:Y?"Your meeting has been successfully scheduled.":"Your advocate will review your request and respond soon."}),te(!1),le({title:"",meeting_type:"",scheduled_date:"",start_time:"",end_time:"",location:"",notes:"",priority:"normal"}),window.location.reload()}catch(s){console.error("Error with meeting request:",s),U({title:"Request Failed",description:s.message||"Failed to process meeting request. Please try again.",variant:"destructive"})}},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"title",children:"Meeting Title"}),e.jsx(c,{id:"title",value:ne.title,onChange:e=>he("title",e.target.value),placeholder:"e.g., IEP Review Meeting",required:!0,"data-testid":"input-title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"meeting_type",children:"Meeting Type"}),e.jsxs(g,{value:ne.meeting_type,onValueChange:e=>he("meeting_type",e),children:[e.jsx(f,{"data-testid":"select-meeting-type",children:e.jsx(v,{placeholder:"Select type"})}),e.jsxs(N,{children:[e.jsx(y,{value:"iep_review",children:"IEP Review"}),e.jsx(y,{value:"consultation",children:"Consultation"}),e.jsx(y,{value:"504_meeting",children:"504 Meeting"}),e.jsx(y,{value:"progress_review",children:"Progress Review"}),e.jsx(y,{value:"initial_meeting",children:"Initial Meeting"}),e.jsx(y,{value:"strategy_session",children:"Strategy Session"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"scheduled_date",children:"Date"}),e.jsx(c,{id:"scheduled_date",type:"date",value:ne.scheduled_date,onChange:e=>he("scheduled_date",e.target.value),required:!0,"data-testid":"input-date"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"start_time",children:"Start Time"}),e.jsx(c,{id:"start_time",type:"time",value:ne.start_time,onChange:e=>he("start_time",e.target.value),required:!0,"data-testid":"input-start-time"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"end_time",children:"End Time"}),e.jsx(c,{id:"end_time",type:"time",value:ne.end_time,onChange:e=>he("end_time",e.target.value),required:!0,"data-testid":"input-end-time"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"location",children:"Location"}),e.jsx(c,{id:"location",value:ne.location,onChange:e=>he("location",e.target.value),placeholder:"e.g., School conference room or video call link","data-testid":"input-location"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"notes",children:"Notes"}),e.jsx(p,{id:"notes",value:ne.notes,onChange:e=>he("notes",e.target.value),placeholder:"Additional details, agenda items, or special requirements",rows:3,"data-testid":"textarea-notes"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>te(!1),"data-testid":"button-cancel",children:"Cancel"}),e.jsx(r,{type:"submit","data-testid":"button-submit",children:Y?"Schedule Meeting":"Send Request"})]})]})]})}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(o,{children:[e.jsx(m,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Upcoming Meetings"]})}),e.jsx(h,{children:W?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"})}):de.length>0?e.jsx("div",{className:"space-y-4",children:de.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-semibold",children:s.title}),e.jsx(j,{variant:oe(s.status),children:s.status})]}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{children:s.scheduled_date})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.start_time," - ",s.end_time]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:["video_call"===s.meeting_type?e.jsx(R,{className:"h-4 w-4"}):e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{children:s.location||"TBD"})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx(j,{variant:"outline",className:"text-xs",children:s.meeting_type?.replace("_"," ")||"Meeting"})}),"confirmed"===s.status&&e.jsxs("div",{className:"flex gap-2 mt-4",children:[!Y&&e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>{return e=s.id,void O(`/parent/tools/meeting-prep?meeting=${e}`);var e},"data-testid":`button-prep-${s.id}`,children:[e.jsx(E,{className:"h-4 w-4 mr-1"}),"Prepare"]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>O(Y?`/advocate/messaging?client=${s.client_id}`:`/parent/messaging?advocate=${s.advocate_id}`),"data-testid":`button-message-${s.id}`,children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),"Message"]}),Y&&e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>O(`/advocate/students?client=${s.client_id}`),"data-testid":`button-view-client-${s.id}`,children:[e.jsx($,{className:"h-4 w-4 mr-1"}),"View Client"]})]})]},s.id))}):e.jsxs("div",{className:"text-center p-8",children:[e.jsx(z,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Upcoming Meetings"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:Y?"Schedule a meeting with your clients":"Request a meeting with your advocate"}),e.jsxs(r,{onClick:()=>ee(!0),children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),Y?"Schedule Meeting":"Request Meeting"]})]})})]}),ce.length>0&&e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Important Deadlines",e.jsx(j,{variant:"secondary",className:"ml-2",children:"Timeline Calculator"})]}),e.jsx(x,{children:"Deadlines imported from your timeline calculations"})]}),e.jsx(h,{children:e.jsx("div",{className:"space-y-3",children:ce.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full "+("high"===s.priority?"bg-destructive":"medium"===s.priority?"bg-orange-500":"bg-green-500")}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsx("span",{children:s.date}),e.jsxs(j,{variant:me(s.priority),className:"text-xs",children:[s.priority," priority"]})]})]})]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>O("/parent/tools/smart-letter-generator?type=deadline-response"),"data-testid":`button-respond-${s.id}`,children:[e.jsx(I,{className:"h-4 w-4 mr-1"}),"Generate Response"]})]},s.id))})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(u,{children:"Quick Actions"})}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs(r,{variant:"outline",className:"w-full justify-start",onClick:()=>O("/parent/tools/meeting-prep"),"data-testid":"button-meeting-prep",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Meeting Preparation"]}),e.jsxs(r,{variant:"outline",className:"w-full justify-start",onClick:()=>O("/parent/messages"),"data-testid":"button-message-advocate",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Message Advocate"]}),e.jsxs(r,{variant:"outline",className:"w-full justify-start",onClick:()=>O("/parent/tools/smart-letter-generator"),"data-testid":"button-smart-letters",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Smart Letters"]}),e.jsxs(r,{variant:"outline",className:"w-full justify-start",onClick:()=>O("/parent/tools/timeline-calculator"),"data-testid":"button-timeline-calculator",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Timeline Calculator"]})]})]}),e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(u,{children:"This Month"})}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Meetings"}),e.jsx("span",{className:"font-semibold",children:G.length})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Confirmed"}),e.jsx("span",{className:"font-semibold text-green-600",children:G.filter(e=>"confirmed"===e.status).length})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Pending"}),e.jsx("span",{className:"font-semibold text-orange-600",children:G.filter(e=>"pending"===e.status).length})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Upcoming Deadlines"}),e.jsx("span",{className:"font-semibold text-blue-600",children:ce.length})]})]})]})]})]})]})})}export{O as default};
