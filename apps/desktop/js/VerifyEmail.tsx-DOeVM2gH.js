import{j as e}from"./chunk-DsWtD-um.js";import{g as s,d as r,r as t}from"./chunk--CdJ9rTh.js";import{C as a,d as o,e as i,f as c,h as n,B as l}from"../assets/index-4xq_U8Za.js";import{v as d,y as u,a5 as m}from"./chunk-CIO6T0Sb.js";import"./chunk-DiCKXT8z.js";function x(){const[x]=s(),h=r(),[p,f]=t.useState("loading"),[w,g]=t.useState(""),[j,y]=t.useState({}),v=x.get("token");return t.useEffect(()=>{if(!v)return f("error"),void g("No verification token provided");console.log("ðŸ§¹ SECURITY: Clearing all authentication state before verification"),localStorage.removeItem("authToken"),localStorage.removeItem("user"),localStorage.removeItem("profile"),localStorage.removeItem("lastAuthCheck"),window.sessionStorage&&window.sessionStorage.clear(),fetch(`/api/verify-email?token=${v}`).then(e=>e.json()).then(e=>{e.success?(f("success"),g(e.message),y({requiresPasswordSetup:e.requiresPasswordSetup,hasPassword:e.hasPassword,redirectTo:e.redirectTo}),e.requiresPasswordSetup?(console.log("ðŸ”’ New user verified - redirecting to password setup"),setTimeout(()=>{h(e.redirectTo)},2e3)):e.hasPassword?(console.log("ðŸ”’ Existing user verified - redirecting to login"),setTimeout(()=>{h(e.redirectTo)},2e3)):(console.log("ðŸ”’ Fallback redirect - this should not happen"),setTimeout(()=>{h("/m/auth")},3e3))):(f("error"),g(e.message||"Verification failed"))}).catch(e=>{console.error("Verification error:",e),f("error"),g("An error occurred during verification")})},[v,h]),"loading"===p?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 to-accent/5 py-12",children:e.jsx("div",{className:"container mx-auto px-4 max-w-2xl",children:e.jsx(a,{children:e.jsxs(o,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(d,{className:"w-6 h-6 text-blue-600 animate-spin"})}),e.jsx(i,{className:"text-xl",children:"Verifying Your Email"}),e.jsx(c,{children:"Please wait while we verify your email address..."})]})})})}):"success"===p?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 to-accent/5 py-12",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-2xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(u,{className:"w-8 h-8 text-green-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Email Verified Successfully! ðŸŽ‰"}),e.jsx("p",{className:"text-lg text-gray-600",children:j.requiresPasswordSetup?"Now let's set up your password to secure your account.":j.hasPassword?"Please sign in with your existing password.":"Welcome to My IEP Hero! Your account is now active."})]}),e.jsxs(a,{children:[e.jsxs(o,{className:"text-center",children:[e.jsx(i,{className:"text-xl",children:j.requiresPasswordSetup?"Password Setup Required":j.hasPassword?"Ready to Sign In":"You're All Set!"}),e.jsx(c,{children:j.requiresPasswordSetup?"Your email is verified. Please create a secure password to complete your account setup.":j.hasPassword?"Your email is verified. You can now sign in with your existing password.":"Your email has been verified and your account is ready to use."})]}),e.jsxs(n,{className:"text-center space-y-6",children:[e.jsx("p",{className:"text-muted-foreground",children:j.requiresPasswordSetup?"You'll be automatically redirected to password setup in a few seconds, or click below to continue.":j.hasPassword?"You'll be automatically redirected to sign in in a few seconds, or click below to continue.":"You'll be automatically redirected in a few seconds, or click below to continue."}),e.jsx(l,{size:"lg",onClick:()=>h(j.redirectTo||"/auth"),"data-testid":"button-continue",children:j.requiresPasswordSetup?"Set Up Password":j.hasPassword?"Sign In":"Continue"}),e.jsx("div",{className:"border-t pt-6",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:j.requiresPasswordSetup?"After setting up your password, you'll have full access to your My IEP Hero features.":"You now have access to all your subscription features including AI-powered IEP analysis, meeting preparation tools, and advocate matching services."})})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 to-accent/5 py-12",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-2xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(m,{className:"w-8 h-8 text-red-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Verification Failed"}),e.jsx("p",{className:"text-lg text-gray-600",children:w})]}),e.jsx(a,{children:e.jsxs(n,{className:"text-center space-y-6 pt-6",children:[e.jsx("p",{className:"text-muted-foreground",children:"The verification link may have expired or been used already. Please contact support if you continue to have issues."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(l,{variant:"outline",className:"flex-1",onClick:()=>h("/"),"data-testid":"button-home",children:"Return Home"}),e.jsx(l,{className:"flex-1",onClick:()=>window.location.href="mailto:support@myiephero.com","data-testid":"button-contact-support",children:"Contact Support"})]})]})})]})})}export{x as default};
