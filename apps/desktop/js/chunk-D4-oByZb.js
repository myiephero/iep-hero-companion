import{r as e}from"./chunk--CdJ9rTh.js";import{W as t,J as a,K as r,a as i,l as n}from"../assets/index-2BchvXuI.js";var o,s,l,c,m,p;(s=o||(o={})).Prompt="PROMPT",s.Camera="CAMERA",s.Photos="PHOTOS",(c=l||(l={})).Rear="REAR",c.Front="FRONT",(p=m||(m={})).Uri="uri",p.Base64="base64",p.DataUrl="dataUrl";class d extends t{async getPhoto(e){return new Promise(async(t,a)=>{if(e.webUseInput||e.source===o.Photos)this.fileInputExperience(e,t,a);else if(e.source===o.Prompt){let r=document.querySelector("pwa-action-sheet");r||(r=document.createElement("pwa-action-sheet"),document.body.appendChild(r)),r.header=e.promptLabelHeader||"Photo",r.cancelable=!1,r.options=[{title:e.promptLabelPhoto||"From Photos"},{title:e.promptLabelPicture||"Take Picture"}],r.addEventListener("onSelection",async r=>{0===r.detail?this.fileInputExperience(e,t,a):this.cameraExperience(e,t,a)})}else this.cameraExperience(e,t,a)})}async pickImages(e){return new Promise(async(e,t)=>{this.multipleFileInputExperience(e,t)})}async cameraExperience(e,t,r){if(customElements.get("pwa-camera-modal")){const n=document.createElement("pwa-camera-modal");n.facingMode=e.direction===l.Front?"user":"environment",document.body.appendChild(n);try{await n.componentOnReady(),n.addEventListener("onPhoto",async i=>{const o=i.detail;null===o?r(new a("User cancelled photos app")):o instanceof Error?r(o):t(await this._getCameraPhoto(o,e)),n.dismiss(),document.body.removeChild(n)}),n.present()}catch(i){this.fileInputExperience(e,t,r)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(e,t,r)}fileInputExperience(e,t,r){let i=document.querySelector("#_capacitor-camera-input");const n=()=>{var e;null===(e=i.parentNode)||void 0===e||e.removeChild(i)};i||(i=document.createElement("input"),i.id="_capacitor-camera-input",i.type="file",i.hidden=!0,document.body.appendChild(i),i.addEventListener("change",a=>{const r=i.files[0];let o="jpeg";if("image/png"===r.type?o="png":"image/gif"===r.type&&(o="gif"),"dataUrl"===e.resultType||"base64"===e.resultType){const a=new FileReader;a.addEventListener("load",()=>{if("dataUrl"===e.resultType)t({dataUrl:a.result,format:o});else if("base64"===e.resultType){const e=a.result.split(",")[1];t({base64String:e,format:o})}n()}),a.readAsDataURL(r)}else t({webPath:URL.createObjectURL(r),format:o}),n()}),i.addEventListener("cancel",e=>{r(new a("User cancelled photos app")),n()})),i.accept="image/*",i.capture=!0,e.source===o.Photos||e.source===o.Prompt?i.removeAttribute("capture"):e.direction===l.Front?i.capture="user":e.direction===l.Rear&&(i.capture="environment"),i.click()}multipleFileInputExperience(e,t){let r=document.querySelector("#_capacitor-camera-input-multiple");const i=()=>{var e;null===(e=r.parentNode)||void 0===e||e.removeChild(r)};r||(r=document.createElement("input"),r.id="_capacitor-camera-input-multiple",r.type="file",r.hidden=!0,r.multiple=!0,document.body.appendChild(r),r.addEventListener("change",t=>{const a=[];for(let e=0;e<r.files.length;e++){const t=r.files[e];let i="jpeg";"image/png"===t.type?i="png":"image/gif"===t.type&&(i="gif"),a.push({webPath:URL.createObjectURL(t),format:i})}e({photos:a}),i()}),r.addEventListener("cancel",e=>{t(new a("User cancelled photos app")),i()})),r.accept="image/*",r.click()}_getCameraPhoto(e,t){return new Promise((a,r)=>{const i=new FileReader,n=e.type.split("/")[1];"uri"===t.resultType?a({webPath:URL.createObjectURL(e),format:n,saved:!1}):(i.readAsDataURL(e),i.onloadend=()=>{const e=i.result;"dataUrl"===t.resultType?a({dataUrl:e,format:n,saved:!1}):a({base64String:e.split(",")[1],format:n,saved:!1})},i.onerror=e=>{r(e)})})}async checkPermissions(){if("undefined"==typeof navigator||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch(e){throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}const u=r("Camera",{web:()=>new d});function h(){const[t,a]=e.useState(!1),{toast:r}=i(),s=n.isNativePlatform(),l=async(e={})=>{const{quality:t=80,allowEditing:i=!0,source:n="prompt",maxWidth:l=1920,maxHeight:c=1920}=e;a(!0);try{if(s){const e="camera"===n?o.Camera:"gallery"===n?o.Photos:o.Prompt,a=await u.getPhoto({quality:t,allowEditing:i,resultType:m.DataUrl,source:e,width:l,height:c,correctOrientation:!0});if(!a.dataUrl)throw new Error("Failed to capture image");const r=3*(a.dataUrl.split(",")[1]?.length||0)/4;return{dataUrl:a.dataUrl,format:a.format||"jpeg",fileName:`captured-image-${Date.now()}.${a.format||"jpeg"}`,fileSize:Math.round(r)}}return new Promise((e,t)=>{const a=document.createElement("input");a.type="file",a.accept="image/*","camera"===n&&a.setAttribute("capture","environment"),a.onchange=async a=>{const r=a.target.files?.[0];if(r)try{if(!r.type.startsWith("image/"))throw new Error("Please select an image file");if(r.size>10485760)throw new Error("Image size must be less than 10MB");const a=new FileReader;a.onload=()=>{const t=a.result,i=r.type.split("/")[1]||"jpeg";e({dataUrl:t,format:i,fileName:r.name,fileSize:r.size})},a.onerror=()=>t(new Error("Failed to read file")),a.readAsDataURL(r)}catch(i){t(i)}else e(null)},a.click()})}catch(p){return console.error("Camera capture error:",p),p.message?.includes("User cancelled")?null:(p.message?.includes("Camera not available")?r({title:"Camera Unavailable",description:"Camera is not available on this device. Please try selecting a file instead.",variant:"destructive"}):p.message?.includes("Permission denied")?r({title:"Permission Denied",description:"Camera permission is required. Please enable camera access in your device settings.",variant:"destructive"}):r({title:"Capture Failed",description:p.message||"Failed to capture image. Please try again.",variant:"destructive"}),null)}finally{a(!1)}};return{capturePhoto:l,captureFromCamera:()=>l({source:"camera"}),captureFromGallery:()=>l({source:"gallery"}),captureWithPrompt:()=>l({source:"prompt"}),convertToFile:e=>{const t=e.dataUrl.split(",")[1],a=atob(t),r=new Array(a.length);for(let o=0;o<a.length;o++)r[o]=a.charCodeAt(o);const i=new Uint8Array(r),n=new Blob([i],{type:`image/${e.format}`});return new File([n],e.fileName,{type:`image/${e.format}`,lastModified:Date.now()})},checkCameraAvailability:async()=>{if(!s)return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia);try{return!0}catch{return!1}},isCapturing:t,isNative:s}}export{h as u};
