import{j as e}from"./chunk-DsWtD-um.js";import{r as s}from"./chunk--CdJ9rTh.js";import{c as a,r as t,t as n,B as r,v as l,w as c,C as i,d,h as o,e as m}from"../assets/index-DhCC2x2k.js";import{B as x}from"./chunk-hdVtyTqo.js";import{aE as h,N as u,av as j,aK as N,au as p,k as f,M as b,a4 as g,e as v,am as w,aa as y,an as C}from"./chunk-CIO6T0Sb.js";import{A as k,a as $}from"./chunk-D9EDLkql.js";const L=s.forwardRef(({className:s,...t},n)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:n,className:a("w-full caption-bottom text-sm",s),...t})}));L.displayName="Table";const S=s.forwardRef(({className:s,...t},n)=>e.jsx("thead",{ref:n,className:a("[&_tr]:border-b",s),...t}));S.displayName="TableHeader";const M=s.forwardRef(({className:s,...t},n)=>e.jsx("tbody",{ref:n,className:a("[&_tr:last-child]:border-0",s),...t}));M.displayName="TableBody";s.forwardRef(({className:s,...t},n)=>e.jsx("tfoot",{ref:n,className:a("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...t})).displayName="TableFooter";const P=s.forwardRef(({className:s,...t},n)=>e.jsx("tr",{ref:n,className:a("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...t}));P.displayName="TableRow";const R=s.forwardRef(({className:s,...t},n)=>e.jsx("th",{ref:n,className:a("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...t}));R.displayName="TableHead";const T=s.forwardRef(({className:s,...t},n)=>e.jsx("td",{ref:n,className:a("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...t}));T.displayName="TableCell";s.forwardRef(({className:s,...t},n)=>e.jsx("caption",{ref:n,className:a("mt-4 text-sm text-muted-foreground",s),...t})).displayName="TableCaption";const _=(e,s)=>"function"==typeof s?s(e):e[s],A=s=>null==s?e.jsx("span",{className:"text-muted-foreground",children:"â€”"}):"boolean"==typeof s?e.jsx(x,{variant:s?"default":"secondary",children:s?"Yes":"No"}):s instanceof Date?e.jsx("span",{children:s.toLocaleDateString()}):"string"==typeof s&&s.includes("@")?e.jsx("span",{className:"font-mono text-sm",children:s}):"string"==typeof s&&(s.startsWith("http://")||s.startsWith("https://"))?e.jsx("a",{href:s,className:"text-blue-600 hover:underline",onClick:e=>{e.preventDefault(),window.location.replace(s)},children:s}):e.jsx("span",{children:String(s)}),D=({columns:s})=>e.jsxs("div",{className:"space-y-3",children:[[...Array(5)].map((a,t)=>e.jsx("div",{className:"hidden md:flex space-x-4",children:[...Array(s)].map((s,a)=>e.jsx("div",{className:"h-4 bg-muted rounded animate-pulse flex-1"},a))},t)),e.jsx("div",{className:"md:hidden space-y-3",children:[...Array(3)].map((s,a)=>e.jsxs(i,{className:"animate-pulse",children:[e.jsxs(d,{className:"pb-3",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/3"})]}),e.jsxs(o,{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-muted rounded w-full"}),e.jsx("div",{className:"h-3 bg-muted rounded w-3/4"})]})]},a))})]}),I=({message:s="No data available",icon:a=e.jsx(u,{className:"h-12 w-12"})})=>e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto text-muted-foreground mb-4",children:a}),e.jsx("p",{className:"text-muted-foreground",children:s})]}),O=({item:s,index:x,columns:h,actions:u,onRowClick:N,testIdPrefix:p,title:f,subtitle:b,className:g})=>{const v=h.filter(e=>!e.hiddenOnMobile);return e.jsxs(i,{className:a("transition-all duration-200",N&&"cursor-pointer hover:shadow-md hover:bg-muted/50",g),onClick:()=>N?.(s,x),"data-testid":p?`${p}-card-${x}`:void 0,children:[(f||b)&&e.jsxs(d,{className:"pb-3",children:[f&&e.jsx(m,{className:"text-lg",children:f}),b&&e.jsx("p",{className:"text-sm text-muted-foreground",children:b})]}),e.jsxs(o,{className:"space-y-3",children:[v.map((a,t)=>{const n=_(s,a.accessor),r=a.render?a.render(n,s,x):A(n),l=a.mobileLabel||a.header;return e.jsxs("div",{className:"flex justify-between items-start gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-muted-foreground min-w-0 flex-shrink-0",children:[l,":"]}),e.jsx("div",{className:"text-sm text-right min-w-0 flex-1",children:r})]},t)}),u&&u.length>0&&e.jsx("div",{className:"flex justify-end pt-2 border-t",children:e.jsxs(t,{children:[e.jsx(n,{asChild:!0,children:e.jsxs(r,{variant:"ghost",size:"sm","data-testid":p?`${p}-actions-${x}`:void 0,children:["Actions",e.jsx(j,{className:"h-4 w-4 ml-1"})]})}),e.jsx(l,{align:"end",children:u.map((t,n)=>{const r=t.disabled?.(s)||!1;return t.hidden?.(s)||!1?null:e.jsxs(c,{onClick:e=>{e.stopPropagation(),r||t.onClick(s,x)},disabled:r,"data-testid":p?`${p}-action-${n}-${x}`:void 0,className:a("destructive"===t.variant&&"text-destructive focus:text-destructive"),children:[t.icon&&e.jsx("span",{className:"mr-2",children:t.icon}),t.label]},n)})})]})})]})]})},U=({data:i,columns:d,loading:o=!1,emptyMessage:m="No data available",emptyIcon:x,actions:u,onRowClick:f,className:b,tableClassName:g,cardClassName:v,testIdPrefix:w="table",showHeader:y=!0,sortable:C=!0,mobileCardTitle:k,mobileCardSubtitle:$})=>{const[U,B]=s.useState({key:null,direction:"asc"}),E=s.useMemo(()=>U.key&&C?[...i].sort((e,s)=>{const a=d.find(e=>"string"==typeof e.accessor&&e.accessor===U.key);if(!a)return 0;const t=_(e,a.accessor),n=_(s,a.accessor);if(null==t&&null==n)return 0;if(null==t)return"asc"===U.direction?1:-1;if(null==n)return"asc"===U.direction?-1:1;let r=0;return r="string"==typeof t&&"string"==typeof n?t.toLowerCase().localeCompare(n.toLowerCase()):t instanceof Date&&n instanceof Date?t.getTime()-n.getTime():t<n?-1:t>n?1:0,"asc"===U.direction?r:-r}):i,[i,U,d,C]),H=s=>{if(!C||!s.sortable||"string"!=typeof s.accessor)return null;return U.key===s.accessor?"asc"===U.direction?e.jsx(p,{className:"h-4 w-4 ml-1"}):e.jsx(j,{className:"h-4 w-4 ml-1"}):e.jsx(N,{className:"h-4 w-4 ml-1 text-muted-foreground"})};return o?e.jsx("div",{className:a("space-y-4",b),children:e.jsx(D,{columns:d.length})}):0===i.length?e.jsx("div",{className:a("space-y-4",b),children:e.jsx(I,{message:m,icon:x})}):e.jsxs("div",{className:a("space-y-4",b),children:[e.jsx("div",{className:"hidden md:block",children:e.jsxs(L,{className:a("w-full",g),children:[y&&e.jsx(S,{children:e.jsxs(P,{children:[d.map((s,t)=>e.jsx(R,{className:a(s.headerClassName,s.sortable&&C&&"cursor-pointer select-none hover:bg-muted/50","transition-colors"),onClick:()=>{return s.sortable&&(e=s.accessor,void(C&&"string"==typeof e&&B(s=>({key:e,direction:s.key===e&&"asc"===s.direction?"desc":"asc"}))));var e},"data-testid":`${w}-header-${t}`,children:e.jsxs("div",{className:"flex items-center",children:[s.header,H(s)]})},t)),u&&u.length>0&&e.jsx(R,{className:"w-16",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx(M,{children:E.map((s,i)=>e.jsxs(P,{className:a(f&&"cursor-pointer hover:bg-muted/50","transition-colors"),onClick:()=>f?.(s,i),"data-testid":`${w}-row-${i}`,children:[d.map((a,t)=>{const n=_(s,a.accessor),r=a.render?a.render(n,s,i):A(n);return e.jsx(T,{className:a.className,"data-testid":`${w}-cell-${i}-${t}`,children:r},t)}),u&&u.length>0&&e.jsx(T,{children:e.jsxs(t,{children:[e.jsx(n,{asChild:!0,children:e.jsxs(r,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0","data-testid":`${w}-actions-${i}`,children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Actions"})]})}),e.jsx(l,{align:"end",children:u.map((t,n)=>{const r=t.disabled?.(s)||!1;return t.hidden?.(s)||!1?null:e.jsxs(c,{onClick:e=>{e.stopPropagation(),r||t.onClick(s,i)},disabled:r,"data-testid":`${w}-action-${n}-${i}`,className:a("destructive"===t.variant&&"text-destructive focus:text-destructive"),children:[t.icon&&e.jsx("span",{className:"mr-2",children:t.icon}),t.label]},n)})})]})})]},i))})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:E.map((s,a)=>e.jsx(O,{item:s,index:a,columns:d,actions:u,onRowClick:f,testIdPrefix:w,title:k?.(s),subtitle:$?.(s),className:v},a))})]})},B=({parents:s,loading:a,onMessage:t,onEdit:n,onViewStudents:r})=>{const l=[{header:"Parent",accessor:"full_name",sortable:!0,render:(s,a)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"h-8 w-8",children:e.jsx($,{children:s?.split(" ").map(e=>e[0]).join("").slice(0,2)||"P"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.email})]})]}),mobileLabel:"Parent"},{header:"Contact",accessor:"phone",render:(s,a)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-mono",children:a.email})]}),s&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-mono",children:s})]})]}),mobileLabel:"Contact",hiddenOnMobile:!0},{header:"Students",accessor:"students_count",sortable:!0,render:s=>e.jsxs(x,{variant:"secondary",children:[s||0," student",1!==s?"s":""]}),mobileLabel:"Students"},{header:"Status",accessor:"status",sortable:!0,render:s=>e.jsx(x,{variant:"active"===s?"default":"secondary",children:s}),mobileLabel:"Status"},{header:"Joined",accessor:"created_at",sortable:!0,render:s=>e.jsx("span",{className:"text-sm",children:new Date(s).toLocaleDateString()}),mobileLabel:"Joined",hiddenOnMobile:!0}],c=[{label:"Send Message",icon:e.jsx(b,{className:"h-4 w-4"}),onClick:e=>t?.(e)},{label:"View Students",icon:e.jsx(f,{className:"h-4 w-4"}),onClick:e=>r?.(e)},{label:"Edit",icon:e.jsx(w,{className:"h-4 w-4"}),onClick:e=>n?.(e)}];return e.jsx(U,{data:s,columns:l,actions:c,loading:a,emptyMessage:"No parents found",emptyIcon:e.jsx(f,{className:"h-12 w-12"}),testIdPrefix:"parent",mobileCardTitle:e=>e.full_name,mobileCardSubtitle:e=>e.email})},E=({conversations:s,loading:a,onOpenConversation:t,onArchive:n,onMarkUrgent:r})=>{const l=[{header:"Conversation",accessor:e=>e.advocate?.name||e.parent?.name||"Unknown",sortable:!0,render:(s,a)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"h-8 w-8",children:e.jsx($,{children:s?.split(" ").map(e=>e[0]).join("").slice(0,2)||"C"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium truncate",children:s}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:a.student?.name||"No student"})]})]}),mobileLabel:"Participant"},{header:"Latest Message",accessor:e=>e.latest_message?.content||"",render:(s,a)=>e.jsxs("div",{className:"max-w-xs",children:[e.jsx("div",{className:"text-sm truncate",children:s||"No messages yet"}),a.latest_message&&e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(a.latest_message.created_at).toLocaleDateString()})]}),mobileLabel:"Latest Message"},{header:"Status",accessor:"status",sortable:!0,render:(s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"active"===s?"default":"secondary",children:s}),a.unread_count>0&&e.jsx(x,{variant:"destructive",className:"text-xs",children:a.unread_count})]}),mobileLabel:"Status"},{header:"Priority",accessor:"priority",sortable:!0,render:s=>e.jsx(x,{variant:"urgent"===s?"destructive":"high"===s?"default":"secondary",children:s}),mobileLabel:"Priority"}],c=[{label:"Open",icon:e.jsx(b,{className:"h-4 w-4"}),onClick:e=>t?.(e)},{label:"Mark Urgent",icon:e.jsx(y,{className:"h-4 w-4"}),onClick:e=>r?.(e),hidden:e=>"urgent"===e.priority},{label:"Archive",icon:e.jsx(C,{className:"h-4 w-4"}),onClick:e=>n?.(e)}];return e.jsx(U,{data:s,columns:l,actions:c,loading:a,emptyMessage:"No conversations found",emptyIcon:e.jsx(b,{className:"h-12 w-12"}),testIdPrefix:"conversation",mobileCardTitle:e=>e.advocate?.name||e.parent?.name||"Unknown",mobileCardSubtitle:e=>e.student?.name||"No student assigned",onRowClick:t})};export{E as C,B as P};
